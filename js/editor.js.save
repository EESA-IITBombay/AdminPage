var v91=v91||{},vA1=function(){return js.Boot.__string_rec(this,'');};function vB1(from,fields){function inherit(){};inherit.prototype=from;var vC1=new inherit();for(var name in fields)vC1[name]=fields[name];return vC1;};var EReg=v91["EReg"]=function(r,opt){opt=opt.split("u").join("");this.r=new RegExp(r,opt);};EReg.__name__=["EReg"];EReg.prototype={customReplace:function(s,f){var buf=new StringBuf();while(true){if(!this.match(s))break;buf.b+=Std.string(this.matchedLeft());buf.b+=Std.string(f(this));s=this.matchedRight();};buf.b+=Std.string(s);return buf.b;},replace:function(s,vD1){return s.replace(this.r,vD1);},split:function(s){var d="#__delim__#";return s.replace(this.r,d).split(d);},matchedPos:function(){if(this.r.m==null)throw"No string matched";return{pos:this.r.m.index,len:this.r.m[0].length};},matchedRight:function(){if(this.r.m==null)throw"No string matched";var vE1=this.r.m.index+this.r.m[0].length;return this.r.s.substr(vE1,this.r.s.length-vE1);},matchedLeft:function(){if(this.r.m==null)throw"No string matched";return this.r.s.substr(0,this.r.m.index);},matched:function(n){return this.r.m!=null&&n>=0&&n<this.r.m.length?this.r.m[n]:(function(vF1){var vG1;throw"EReg::matched";return vG1;}(this));},match:function(s){if(this.r.vH1)this.r.vI1=0;this.r.m=this.r.exec(s);this.r.s=s;return this.r.m!=null;},r:null,__class__:EReg};var HaxeHash=v91["HaxeHash"]=function(){this.h={};};HaxeHash.__name__=["HaxeHash"];HaxeHash.prototype={toString:function(){var s=new StringBuf();s.b+=Std.string("{");var it=this.keys();while(it.hasNext()){var i=it.next();s.b+=Std.string(i);s.b+=Std.string(" => ");s.b+=Std.string(Std.string(this.get(i)));if(it.hasNext())s.b+=Std.string(", ");};s.b+=Std.string("}");return s.b;},iterator:function(){return{ref:this.h,it:this.keys(),hasNext:function(){return this.it.hasNext();},next:function(){var i=this.it.next();return this.ref["$"+i];}};},keys:function(){var a=[];for(var vJ1 in this.h){if(this.h.hasOwnProperty(vJ1))a.push(vJ1.substr(1));};return HxOverrides.iter(a);},remove:function(vJ1){vJ1="$"+vJ1;if(!this.h.hasOwnProperty(vJ1))return false;delete(this.h[vJ1]);return true;},exists:function(vJ1){return this.h.hasOwnProperty("$"+vJ1);},get:function(vJ1){return this.h["$"+vJ1];},set:function(vJ1,value){this.h["$"+vJ1]=value;},h:null,__class__:HaxeHash};var HxOverrides=v91["HxOverrides"]=function(){};HxOverrides.__name__=["HxOverrides"];HxOverrides.vK1=function(date){var m=date.getMonth()+1;var d=date.getDate();var h=date.getHours();var mi=date.getMinutes();var s=date.getSeconds();return date.getFullYear()+"-"+(m<10?"0"+m:""+m)+"-"+(d<10?"0"+d:""+d)+" "+(h<10?"0"+h:""+h)+":"+(mi<10?"0"+mi:""+mi)+":"+(s<10?"0"+s:""+s);};HxOverrides.vL1=function(s){switch(s.length){case 8:var k=s.split(":");var d=new Date();d.vM1(0);d.vN1(k[0]);d.vO1(k[1]);d.vP1(k[2]);return d;case 10:var k=s.split("-");return new Date(k[0],k[1]-1,k[2],0,0,0);case 19:var k=s.split(" ");var vQ1=k[0].split("-");var t=k[1].split(":");return new Date(vQ1[0],vQ1[1]-1,vQ1[2],t[0],t[1],t[2]);default:throw"Invalid date format : "+s;}};HxOverrides.cca=function(s,index){var x=s.charCodeAt(index);if(x!=x)return undefined;return x;};HxOverrides.substr=function(s,pos,len){if(pos!=null&&pos!=0&&len!=null&&len<0)return"";if(len==null)len=s.length;if(pos<0){pos=s.length+pos;if(pos<0)pos=0;}else if(len<0)len=s.length+len-pos;return s.substr(pos,len);};HxOverrides.remove=function(a,obj){var i=0;var l=a.length;while(i<l){if(a[i]==obj){a.splice(i,1);return true;};i++;};return false;};HxOverrides.iter=function(a){return{cur:0,arr:a,hasNext:function(){return this.cur<this.arr.length;},next:function(){return this.arr[this.cur++];}};};var IntHash=v91["IntHash"]=function(){this.h={};};IntHash.__name__=["IntHash"];IntHash.prototype={toString:function(){var s=new StringBuf();s.b+=Std.string("{");var it=this.keys();while(it.hasNext()){var i=it.next();s.b+=Std.string(i);s.b+=Std.string(" => ");s.b+=Std.string(Std.string(this.get(i)));if(it.hasNext())s.b+=Std.string(", ");};s.b+=Std.string("}");return s.b;},iterator:function(){return{ref:this.h,it:this.keys(),hasNext:function(){return this.it.hasNext();},next:function(){var i=this.it.next();return this.ref[i];}};},keys:function(){var a=[];for(var vJ1 in this.h){if(this.h.hasOwnProperty(vJ1))a.push(vJ1|0);};return HxOverrides.iter(a);},remove:function(vJ1){if(!this.h.hasOwnProperty(vJ1))return false;delete(this.h[vJ1]);return true;},exists:function(vJ1){return this.h.hasOwnProperty(vJ1);},get:function(vJ1){return this.h[vJ1];},set:function(vJ1,value){this.h[vJ1]=value;},h:null,__class__:IntHash};var IntIter=v91["IntIter"]=function(min,max){this.min=min;this.max=max;};IntIter.__name__=["IntIter"];IntIter.prototype={next:function(){return this.min++;},hasNext:function(){return this.min<this.max;},max:null,min:null,__class__:IntIter};var List=v91["List"]=function(){this.length=0;};List.__name__=["List"];List.prototype={map:function(f){var b=new List();var l=this.h;while(l!=null){var v=l[0];l=l[1];b.add(f(v));};return b;},filter:function(f){var vR1=new List();var l=this.h;while(l!=null){var v=l[0];l=l[1];if(f(v))vR1.add(v);};return vR1;},join:function(vS1){var s=new StringBuf();var first=true;var l=this.h;while(l!=null){if(first)first=false;else s.b+=Std.string(vS1);s.b+=Std.string(l[0]);l=l[1];};return s.b;},toString:function(){var s=new StringBuf();var first=true;var l=this.h;s.b+=Std.string("{");while(l!=null){if(first)first=false;else s.b+=Std.string(", ");s.b+=Std.string(Std.string(l[0]));l=l[1];};s.b+=Std.string("}");return s.b;},iterator:function(){return{h:this.h,hasNext:function(){return this.h!=null;},next:function(){if(this.h==null)return null;var x=this.h[0];this.h=this.h[1];return x;}};},remove:function(v){var vT1=null;var l=this.h;while(l!=null){if(l[0]==v){if(vT1==null)this.h=l[1];else vT1[1]=l[1];if(this.q==l)this.q=vT1;this.length--;return true;};vT1=l;l=l[1];};return false;},clear:function(){this.h=null;this.q=null;this.length=0;},isEmpty:function(){return this.h==null;},pop:function(){if(this.h==null)return null;var x=this.h[0];this.h=this.h[1];if(this.h==null)this.q=null;this.length--;return x;},last:function(){return this.q==null?null:this.q[0];},first:function(){return this.h==null?null:this.h[0];},push:function(item){var x=[item,this.h];this.h=x;if(this.q==null)this.q=x;this.length++;},add:function(item){var x=[item];if(this.h==null)this.h=x;else this.q[1]=x;this.q=x;this.length++;},length:null,q:null,h:null,__class__:List};var Reflect=v91["Reflect"]=function(){};Reflect.__name__=["Reflect"];Reflect.hasField=function(o,field){return Object.prototype.hasOwnProperty.call(o,field);};Reflect.field=function(o,field){var v=null;try{v=o[field];}catch(e){};return v;};Reflect.setField=function(o,field,value){o[field]=value;};Reflect.vU1=function(o,field){var vV1;return o==null?null:o.__properties__&&(vV1=o.__properties__["get_"+field])?o[vV1]():o[field];};Reflect.vW1=function(o,field,value){var vV1;if(o.__properties__&&(vV1=o.__properties__["set_"+field]))o[vV1](value);else o[field]=value;};Reflect.callMethod=function(o,vX1,args){return vX1.apply(o,args);};Reflect.fields=function(o){var a=[];if(o!=null){var hasOwnProperty=Object.prototype.hasOwnProperty;for(var f in o){if(hasOwnProperty.call(o,f))a.push(f);}};return a;};Reflect.isFunction=function(f){return typeof(f)=="function"&&!(f.__name__||f.vY1);};Reflect.compare=function(a,b){return a==b?0:a>b?1:-1;};Reflect.compareMethods=function(vZ1,va1){if(vZ1==va1)return true;if(!Reflect.isFunction(vZ1)||!Reflect.isFunction(va1))return false;return vZ1.scope==va1.scope&&vZ1.method==va1.method&&vZ1.method!=null;};Reflect.isObject=function(v){if(v==null)return false;var t=typeof(v);return t=="string"||t=="object"&&!v.vb1||t=="function"&&(v.__name__||v.vY1);};Reflect.deleteField=function(o,f){if(!Reflect.hasField(o,f))return false;delete(o[f]);return true;};Reflect.copy=function(o){var vc1={};var vd1=0,ve1=Reflect.fields(o);while(vd1<ve1.length){var f=ve1[vd1];++vd1;vc1[f]=Reflect.field(o,f);};return vc1;};Reflect.makeVarArgs=function(f){return function(){var a=Array.prototype.slice.call(arguments);return f(a);};};var Std=v91["Std"]=function(){};Std.__name__=["Std"];Std["is"]=function(v,t){return js.Boot.__instanceof(v,t);};Std.string=function(s){return js.Boot.__string_rec(s,"");};Std["int"]=function(x){return x|0;};Std.parseInt=function(x){var v=parseInt(x,10);if(v==0&&(HxOverrides.cca(x,1)==120||HxOverrides.cca(x,1)==88))v=parseInt(x);if(isNaN(v))return null;return v;};Std.parseFloat=function(x){return parseFloat(x);};Std.random=function(x){return Math.floor(Math.random()*x);};var StringBuf=v91["StringBuf"]=function(){this.b="";};StringBuf.__name__=["StringBuf"];StringBuf.prototype={toString:function(){return this.b;},addSub:function(s,pos,len){this.b+=HxOverrides.substr(s,pos,len);},addChar:function(c){this.b+=String.fromCharCode(c);},add:function(x){this.b+=Std.string(x);},b:null,__class__:StringBuf};var StringTools=v91["StringTools"]=function(){};StringTools.__name__=["StringTools"];StringTools.urlEncode=function(s){return encodeURIComponent(s);};StringTools.urlDecode=function(s){return decodeURIComponent(s.split("+").join(" "));};StringTools.htmlEscape=function(s){return s.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;");};StringTools.htmlUnescape=function(s){return s.split("&gt;").join(">").split("&lt;").join("<").split("&amp;").join("&");};StringTools.startsWith=function(s,start){return s.length>=start.length&&HxOverrides.substr(s,0,start.length)==start;};StringTools.endsWith=function(s,end){var vf1=end.length;var vg1=s.length;return vg1>=vf1&&HxOverrides.substr(s,vg1-vf1,vf1)==end;};StringTools.isSpace=function(s,pos){var c=HxOverrides.cca(s,pos);return c>=9&&c<=13||c==32;};StringTools.ltrim=function(s){var l=s.length;var r=0;while(r<l&&StringTools.isSpace(s,r))r++;if(r>0)return HxOverrides.substr(s,r,l-r);else return s;};StringTools.rtrim=function(s){var l=s.length;var r=0;while(r<l&&StringTools.isSpace(s,l-r-1))r++;if(r>0)return HxOverrides.substr(s,0,l-r);else return s;};StringTools.trim=function(s){return StringTools.ltrim(StringTools.rtrim(s));};StringTools.rpad=function(s,c,l){var vh1=s.length;var vi1=c.length;while(vh1<l)if(l-vh1<vi1){s+=HxOverrides.substr(c,0,l-vh1);vh1=l;}else{s+=c;vh1+=vi1;};return s;};StringTools.lpad=function(s,c,l){var vj1="";var vh1=s.length;if(vh1>=l)return s;var vi1=c.length;while(vh1<l)if(l-vh1<vi1){vj1+=HxOverrides.substr(c,0,l-vh1);vh1=l;}else{vj1+=c;vh1+=vi1;};return vj1+s;};StringTools.replace=function(s,sub,vD1){return s.split(sub).join(vD1);};StringTools.hex=function(n,vk1){var s="";var vl1="0123456789ABCDEF";do{s=vl1.charAt(n&15)+s;n>>>=4;}while(n>0);if(vk1!=null)while(s.length<vk1)s="0"+s;return s;};StringTools.vm1=function(s,index){return s.charCodeAt(index);};StringTools.vn1=function(c){return c!=c;};var ValueType=v91["ValueType"]={vY1:["ValueType"],vo1:["TNull","TInt","TFloat","TBool","TObject","TFunction","TClass","TEnum","TUnknown"]};ValueType.TNull=["TNull",0];ValueType.TNull.toString=vA1;ValueType.TNull.vb1=ValueType;ValueType.TInt=["TInt",1];ValueType.TInt.toString=vA1;ValueType.TInt.vb1=ValueType;ValueType.TFloat=["TFloat",2];ValueType.TFloat.toString=vA1;ValueType.TFloat.vb1=ValueType;ValueType.TBool=["TBool",3];ValueType.TBool.toString=vA1;ValueType.TBool.vb1=ValueType;ValueType.TObject=["TObject",4];ValueType.TObject.toString=vA1;ValueType.TObject.vb1=ValueType;ValueType.TFunction=["TFunction",5];ValueType.TFunction.toString=vA1;ValueType.TFunction.vb1=ValueType;ValueType.TClass=function(c){var vp1=["TClass",6,c];vp1.vb1=ValueType;vp1.toString=vA1;return vp1;};ValueType.TEnum=function(e){var vp1=["TEnum",7,e];vp1.vb1=ValueType;vp1.toString=vA1;return vp1;};ValueType.TUnknown=["TUnknown",8];ValueType.TUnknown.toString=vA1;ValueType.TUnknown.vb1=ValueType;var Type=v91["Type"]=function(){};Type.__name__=["Type"];Type.getClass=function(o){if(o==null)return null;return o.__class__;};Type.getEnum=function(o){if(o==null)return null;return o.vb1;};Type.getSuperClass=function(c){return c.__super__;};Type.getClassName=function(c){var a=c.__name__;return a.join(".");};Type.getEnumName=function(e){var a=e.vY1;return a.join(".");};Type.resolveClass=function(name){var vi1=v91[name];if(vi1==null||!vi1.__name__)return null;return vi1;};Type.resolveEnum=function(name){var e=v91[name];if(e==null||!e.vY1)return null;return e;};Type.createInstance=function(vi1,args){switch(args.length){case 0:return new vi1();case 1:return new vi1(args[0]);case 2:return new vi1(args[0],args[1]);case 3:return new vi1(args[0],args[1],args[2]);case 4:return new vi1(args[0],args[1],args[2],args[3]);case 5:return new vi1(args[0],args[1],args[2],args[3],args[4]);case 6:return new vi1(args[0],args[1],args[2],args[3],args[4],args[5]);case 7:return new vi1(args[0],args[1],args[2],args[3],args[4],args[5],args[6]);case 8:return new vi1(args[0],args[1],args[2],args[3],args[4],args[5],args[6],args[7]);default:throw"Too many arguments";};return null;};Type.createEmptyInstance=function(vi1){function empty(){};empty.prototype=vi1.prototype;return new empty();};Type.createEnum=function(e,vq1,params){var f=Reflect.field(e,vq1);if(f==null)throw"No such constructor "+vq1;if(Reflect.isFunction(f)){if(params==null)throw"Constructor "+vq1+" need parameters";return f.apply(e,params);};if(params!=null&&params.length!=0)throw"Constructor "+vq1+" does not need parameters";return f;};Type.createEnumIndex=function(e,index,params){var c=e.vo1[index];if(c==null)throw index+" is not a valid enum constructor index";return Type.createEnum(e,c,params);};Type.getInstanceFields=function(c){var a=[];for(var i in c.prototype)a.push(i);HxOverrides.remove(a,"__class__");HxOverrides.remove(a,"__properties__");return a;};Type.getClassFields=function(c){var a=Reflect.fields(c);HxOverrides.remove(a,"__name__");HxOverrides.remove(a,"__interfaces__");HxOverrides.remove(a,"__properties__");HxOverrides.remove(a,"__super__");HxOverrides.remove(a,"prototype");return a;};Type.getEnumConstructs=function(e){var a=e.vo1;return a.slice();};Type["typeof"]=function(v){switch(typeof(v)){case"boolean":return ValueType.TBool;case"string":return ValueType.TClass(String);case"number":if(Math.ceil(v)==v%2147483648.0)return ValueType.TInt;return ValueType.TFloat;case"object":if(v==null)return ValueType.TNull;var e=v.vb1;if(e!=null)return ValueType.TEnum(e);var c=v.__class__;if(c!=null)return ValueType.TClass(c);return ValueType.TObject;case"function":if(v.__name__||v.vY1)return ValueType.TObject;return ValueType.TFunction;case"undefined":return ValueType.TNull;default:return ValueType.TUnknown;}};Type.enumEq=function(a,b){if(a==b)return true;try{if(a[0]!=b[0])return false;var ve1=2,vd1=a.length;while(ve1<vd1){var i=ve1++;if(!Type.enumEq(a[i],b[i]))return false;};var e=a.vb1;if(e!=b.vb1||e==null)return false;}catch(e){return false;};return true;};Type.enumConstructor=function(e){return e[0];};Type.enumParameters=function(e){return e.slice(2);};Type.enumIndex=function(e){return e[1];};Type.vr1=function(e){var all=[];var vs1=e.vo1;var vd1=0;while(vd1<vs1.length){var c=vs1[vd1];++vd1;var v=Reflect.field(e,c);if(!Reflect.isFunction(v))all.push(v);};return all;};var Xml=v91["Xml"]=function(){};Xml.__name__=["Xml"];Xml.Element=null;Xml.PCData=null;Xml.CData=null;Xml.Comment=null;Xml.DocType=null;Xml.Prolog=null;Xml.Document=null;Xml.parse=function(str){return haxe.xml.Parser.parse(str);};Xml.createElement=function(name){var r=new Xml();r.nodeType=Xml.Element;r._children=new Array();r._attributes=new HaxeHash();r.setNodeName(name);return r;};Xml.createPCData=function(vt1){var r=new Xml();r.nodeType=Xml.PCData;r.setNodeValue(vt1);return r;};Xml.createCData=function(vt1){var r=new Xml();r.nodeType=Xml.CData;r.setNodeValue(vt1);return r;};Xml.createComment=function(vt1){var r=new Xml();r.nodeType=Xml.Comment;r.setNodeValue(vt1);return r;};Xml.createDocType=function(vt1){var r=new Xml();r.nodeType=Xml.DocType;r.setNodeValue(vt1);return r;};Xml.createProlog=function(vt1){var r=new Xml();r.nodeType=Xml.Prolog;r.setNodeValue(vt1);return r;};Xml.createDocument=function(){var r=new Xml();r.nodeType=Xml.Document;r._children=new Array();return r;};Xml.prototype={toString:function(){if(this.nodeType==Xml.PCData)return this._nodeValue;if(this.nodeType==Xml.CData)return"<![CDATA["+this._nodeValue+"]]>";if(this.nodeType==Xml.Comment)return"<!--"+this._nodeValue+"-->";if(this.nodeType==Xml.DocType)return"<!DOCTYPE "+this._nodeValue+">";if(this.nodeType==Xml.Prolog)return"<?"+this._nodeValue+"?>";var s=new StringBuf();if(this.nodeType==Xml.Element){s.b+=Std.string("<");s.b+=Std.string(this._nodeName);var vu1=this._attributes.keys();while(vu1.hasNext()){var k=vu1.next();s.b+=Std.string(" ");s.b+=Std.string(k);s.b+=Std.string("=\"");s.b+=Std.string(this._attributes.get(k));s.b+=Std.string("\"");};if(this._children.length==0){s.b+=Std.string("/>");return s.b;};s.b+=Std.string(">");};var vv1=this.iterator();while(vv1.hasNext()){var x=vv1.next();s.b+=Std.string(x.toString());};if(this.nodeType==Xml.Element){s.b+=Std.string("</");s.b+=Std.string(this._nodeName);s.b+=Std.string(">");};return s.b;},insertChild:function(x,pos){if(this._children==null)throw"bad nodetype";if(x._parent!=null)HxOverrides.remove(x._parent._children,x);x._parent=this;this._children.splice(pos,0,x);},removeChild:function(x){if(this._children==null)throw"bad nodetype";var b=HxOverrides.remove(this._children,x);if(b)x._parent=null;return b;},addChild:function(x){if(this._children==null)throw"bad nodetype";if(x._parent!=null)HxOverrides.remove(x._parent._children,x);x._parent=this;this._children.push(x);},firstElement:function(){if(this._children==null)throw"bad nodetype";var cur=0;var l=this._children.length;while(cur<l){var n=this._children[cur];if(n.nodeType==Xml.Element)return n;cur++;};return null;},firstChild:function(){if(this._children==null)throw"bad nodetype";return this._children[0];},elementsNamed:function(name){if(this._children==null)throw"bad nodetype";return{cur:0,x:this._children,hasNext:function(){var k=this.cur;var l=this.x.length;while(k<l){var n=this.x[k];if(n.nodeType==Xml.Element&&n._nodeName==name)break;k++;};this.cur=k;return k<l;},next:function(){var k=this.cur;var l=this.x.length;while(k<l){var n=this.x[k];k++;if(n.nodeType==Xml.Element&&n._nodeName==name){this.cur=k;return n;}};return null;}};},elements:function(){if(this._children==null)throw"bad nodetype";return{cur:0,x:this._children,hasNext:function(){var k=this.cur;var l=this.x.length;while(k<l){if(this.x[k].nodeType==Xml.Element)break;k+=1;};this.cur=k;return k<l;},next:function(){var k=this.cur;var l=this.x.length;while(k<l){var n=this.x[k];k+=1;if(n.nodeType==Xml.Element){this.cur=k;return n;}};return null;}};},iterator:function(){if(this._children==null)throw"bad nodetype";return{cur:0,x:this._children,hasNext:function(){return this.cur<this.x.length;},next:function(){return this.x[this.cur++];}};},attributes:function(){if(this.nodeType!=Xml.Element)throw"bad nodeType";return this._attributes.keys();},exists:function(att){if(this.nodeType!=Xml.Element)throw"bad nodeType";return this._attributes.exists(att);},remove:function(att){if(this.nodeType!=Xml.Element)throw"bad nodeType";this._attributes.remove(att);},set:function(att,value){if(this.nodeType!=Xml.Element)throw"bad nodeType";this._attributes.set(att,value);},get:function(att){if(this.nodeType!=Xml.Element)throw"bad nodeType";return this._attributes.get(att);},getParent:function(){return this._parent;},setNodeValue:function(v){if(this.nodeType==Xml.Element||this.nodeType==Xml.Document)throw"bad nodeType";return this._nodeValue=v;},getNodeValue:function(){if(this.nodeType==Xml.Element||this.nodeType==Xml.Document)throw"bad nodeType";return this._nodeValue;},setNodeName:function(n){if(this.nodeType!=Xml.Element)throw"bad nodeType";return this._nodeName=n;},getNodeName:function(){if(this.nodeType!=Xml.Element)throw"bad nodeType";return this._nodeName;},_parent:null,_children:null,_attributes:null,_nodeValue:null,_nodeName:null,parent:null,nodeValue:null,nodeName:null,nodeType:null,__class__:Xml,__properties__:{vw1:"setNodeName",vx1:"getNodeName",vy1:"setNodeValue",vz1:"getNodeValue",v02:"getParent"}};var com=com||{};if(!com.wiris)com.wiris={};if(!com.wiris.common)com.wiris.common={};com.wiris.common.WInteger=v91["com.wiris.common.WInteger"]=function(){};com.wiris.common.WInteger.__name__=["com","wiris","common","WInteger"];com.wiris.common.WInteger.max=function(x,vQ1){if(x>vQ1)return x;return vQ1;};com.wiris.common.WInteger.min=function(x,vQ1){if(x<vQ1)return x;return vQ1;};com.wiris.common.WInteger.v12=function(x,vk1){var s="";while(x!=0&&vk1-->0){var d=x&15;s=com.wiris.e1_51.v22(d+(d>=10?55:48))+s;x=x>>4;};while(vk1-->0)s="0"+s;return s;};com.wiris.common.WInteger.v32=function(str){return Std.parseInt("0x"+str);};com.wiris.common.WInteger.v42=function(str){str=StringTools.trim(str);var i=0;var n=str.length;if(StringTools.startsWith(str,"-"))i++;if(StringTools.startsWith(str,"+"))i++;var c;while(i<n){c=HxOverrides.cca(str,i);if(c<48||c>57)return false;i++;};return true;};if(!com.wiris.editor)com.wiris.editor={};com.wiris.e1_1=v91["com.wiris.e1_1"]=function(id,command){this.v52=1;this.command=command;this.content=null;this.contentRTL=null;this.description=null;this.icon=null;this.iconRTL=null;this.id=id;this.v62=true;this.v72=false;};com.wiris.e1_1.__name__=["com","wiris","e1_1"];com.wiris.e1_1.prototype={v72:null,v62:null,id:null,iconRTL:null,icon:null,description:null,v52:null,contentRTL:null,content:null,command:null,__class__:com.wiris.e1_1};com.wiris.editor.EditorBoxInterface=v91["com.wiris.editor.EditorBoxInterface"]=function(){};com.wiris.editor.EditorBoxInterface.__name__=["com","wiris","editor","EditorBoxInterface"];com.wiris.editor.EditorBoxInterface.prototype={isMultiLine:null,getParent:null,getTagName:null,setAttributes:null,getAttributes:null,getChild:null,getLength:null,__class__:com.wiris.editor.EditorBoxInterface};com.wiris.e1_2=v91["com.wiris.e1_2"]=function(){};com.wiris.e1_2.__name__=["com","wiris","e1_2"];com.wiris.e1_2.prototype={setAutosize:null,setParams:null,getVersion:null,setToolbarHidden:null,setMathML:null,isReady:null,isFormulaEmpty:null,getMathML:null,getEditorModel:null,focus:null,blur:null,actionWithParam:null,action:null,__class__:com.wiris.e1_2};com.wiris.editor.EditorListener=v91["com.wiris.editor.EditorListener"]=function(){};com.wiris.editor.EditorListener.__name__=["com","wiris","editor","EditorListener"];com.wiris.editor.EditorListener.prototype={transformationReceived:null,styleChanged:null,contentChanged:null,clipboardChanged:null,caretPositionChanged:null,__class__:com.wiris.editor.EditorListener};if(!com.wiris.system)com.wiris.system={};com.wiris.e1_3=v91["com.wiris.e1_3"]=function(){};com.wiris.e1_3.__name__=["com","wiris","e1_3"];com.wiris.e1_3.prototype={urlAnswerReceived:null,serviceAnswerReceived:null,__class__:com.wiris.e1_3};if(!com.wiris.editor.toolbar)com.wiris.editor.toolbar={};com.wiris.e1_4=v91["com.wiris.e1_4"]=function(){};com.wiris.e1_4.__name__=["com","wiris","e1_4"];com.wiris.e1_4.prototype={sectionUpdated:null,toolbarReseted:null,tabUpdated:null,tabRemoved:null,tabChanged:null,contextTabAdded:null,componentUpdated:null,componentFired:null,__class__:com.wiris.e1_4};com.wiris.editor.EditorModelInterface=v91["com.wiris.editor.EditorModelInterface"]=function(){};com.wiris.editor.EditorModelInterface.__name__=["com","wiris","editor","EditorModelInterface"];com.wiris.editor.EditorModelInterface.prototype={getTopEditorBox:null,getCurrentEditorBox:null,addValidator:null,getTransformation:null,setEmptyScriptBoxColor:null,getEmptyScriptBoxColor:null,setEmptyBoxColor:null,getEmptyBoxColor:null,isReady:null,getCurrentStyles:null,setSelectionStyles:null,getDesiredDefaultStyles:null,getDefaultStyles:null,setDefaultStyles:null,getCaretLength:null,getCaret:null,insertMathML:null,setMathML:null,reset:null,isFormulaEmpty:null,getMathML:null,getFormulaWidth:null,getFormulaHeight:null,getFormulaBaseline:null,removeEditorListener:null,addEditorListener:null,actionWithParam:null,action:null,__class__:com.wiris.editor.EditorModelInterface};com.wiris.editor.EditorModelPrivateInterface=v91["com.wiris.editor.EditorModelPrivateInterface"]=function(){};com.wiris.editor.EditorModelPrivateInterface.__name__=["com","wiris","editor","EditorModelPrivateInterface"];com.wiris.editor.EditorModelPrivateInterface.__interfaces__=[com.wiris.editor.EditorModelInterface];com.wiris.editor.EditorModelPrivateInterface.prototype={getFormulaModel:null,getSelectionMathML:null,deleteSelection:null,getFormulaLength:null,insertText:null,getErrorRectangles:null,updateBounds:null,getParam:null,setParams:null,standardToFormula:null,setCaret:null,selectWord:null,recalcClient:null,recalc:null,paintClient:null,paint:null,isRecalcNeeded:null,keyEventIsHandled:null,handleKeyEvent:null,getToolbarModel:null,getSelectionRectangles:null,getPositionFromPoint:null,getInverseCaretRectangle:null,getCaretRectangle:null,formulaToStandard:null,clearMetricsCache:null,endEventTransaction:null,beginEventTransaction:null,__class__:com.wiris.editor.EditorModelPrivateInterface};com.wiris.editor.EditorModel=v91["com.wiris.editor.EditorModel"]=function(v82,actions,v92,parameters){this.actions=actions;this.eventTransactionSemaphore=0;this.listeners=new Array();this.remainingCalls=0;this.toolbar=new com.wiris.e1_v();this.registeredToolbars=new HaxeHash();this.registeredToolbars.set("general",v82);this.formulaModel=new com.wiris.editor.formula.FormulaModel();var vA2=true;this.setDefaultStyles(this.getDesiredDefaultStyles());this.transformationGrammarURL=null;this.transformationGrammarResource=null;this.temporalMathML=null;this.validators=null;this.rtlLanguages=com.wiris.editor.EditorModel.RTL_LANGUAGES;this.ltrLanguages=com.wiris.editor.EditorModel.LTR_LANGUAGES;this.arabicIndicLanguages=com.wiris.editor.EditorModel.ARABIC_INDIC_LANGUAGES;this.easternArabicIndicLanguages=com.wiris.editor.EditorModel.EASTERN_ARABIC_INDIC_LANGUAGES;this.europeanLanguages=com.wiris.editor.EditorModel.EUROPEAN_LANGUAGES;this.initParameters=new HaxeHash();this.template=null;if(parameters!=null){if(parameters.get("toolbar")!=null)vA2=false;this.setParams(parameters);};if(vA2)this.toolbar.vB2(v82);this.toolbar.vC2(this);var vD2=new com.wiris.e1_7(this,v92);this.addEditorListener(vD2);this.toolbar.vC2(vD2);this.transformationReceived=null;this.transformer=new com.wiris.e1_E(this,this.formulaModel);};com.wiris.editor.EditorModel.__name__=["com","wiris","editor","EditorModel"];com.wiris.editor.EditorModel.__interfaces__=[com.wiris.e1_3,com.wiris.e1_4,com.wiris.editor.EditorModelPrivateInterface];com.wiris.editor.EditorModel.getNewInstance=function(){var vE2=com.wiris.editor.EditorModel.getNewInstanceWithParams(null);com.wiris.system.ServiceProvider.addObject(vE2);return vE2;};com.wiris.editor.EditorModel.getNewInstanceWithParams=function(parameters){var vF2=null;if(parameters==null||!("false"==parameters.get("loadEditorDefinition"))){var resourceLoader=new com.wiris.system.ResourceLoader();vF2=resourceLoader.loadResource("editor_definition.xml");};if(vF2==null)return new com.wiris.editor.EditorModel(new com.wiris.e1_v(),new HaxeHash(),null,parameters);if(StringTools.startsWith(vF2,"{"))return com.wiris.editor.EditorModel.getNewInstanceFromJSON(vF2,parameters);var editorDefinition=com.wiris.util.xml.WXmlUtils.vG2(vF2);return com.wiris.editor.EditorModel.getNewInstanceFromXML(editorDefinition,parameters);};com.wiris.editor.EditorModel.getNewInstanceFromXML=function(editorDefinition,parameters){if(editorDefinition==null)return new com.wiris.editor.EditorModel(new com.wiris.e1_v(),new HaxeHash(),null,parameters);editorDefinition=editorDefinition.firstChild();var vH2=com.wiris.util.xml.WXmlUtils.getElementsByTagName(editorDefinition.iterator(),"toolbar");if(vH2.length==0)throw"There is not a \"toolbar\" node in the editor definition.";var vI2=com.wiris.util.xml.WXmlUtils.getElementsByTagName(editorDefinition.iterator(),"images");if(vI2.length==0)throw"There is not an \"images\" node in the editor definition.";var v92=com.wiris.e1_o.getNewInstanceFromXML(vI2[0]);var vJ2=com.wiris.util.xml.WXmlUtils.getElementsByTagName(editorDefinition.iterator(),"actions");if(vJ2.length==0)throw"There is not a \"actions\" node in the editor definition.";var vK2=vJ2[0];var actions=com.wiris.editor.ModelFactory.vL2(vK2,v92);var toolbar=com.wiris.editor.ModelFactory.vM2(vH2[0],actions,v92,parameters);return new com.wiris.editor.EditorModel(toolbar,actions,v92,parameters);};com.wiris.editor.EditorModel.getNewInstanceFromJSON=function(vF2,parameters){var vN2=com.wiris.system.JSONUtils.vO2(vF2);var vP2=js.Boot.vQ2(com.wiris.system.JSONUtils.serialize(vN2),HaxeHash);var i=HxOverrides.iter(js.Boot.vQ2(vP2.get("childs"),Array));var v92=null;var vR2=null;var vS2=null;while(i.hasNext()){var node=js.Boot.vQ2(i.next(),HaxeHash);var nodeName=js.Boot.vQ2(node.get("name"),String);if(nodeName=="images")v92=new com.wiris.e1_o(node);else if(nodeName=="actions")vR2=node;else if(nodeName=="toolbar")vS2=node;};var actions=com.wiris.editor.ModelFactory.vT2(vR2,v92);var toolbar=com.wiris.editor.ModelFactory.vU2(vS2,actions,v92,parameters);return new com.wiris.editor.EditorModel(toolbar,actions,v92,parameters);};com.wiris.editor.EditorModel.prototype={getDefaultStylesProvider:function(){return this.formulaModel;},sectionUpdated:function(vV2,tabIndex,vW2){},setAttributes:function(box,vX2){this.formulaModel.setAttributes(box.vY2(),vX2);this.dispatchEvents();},getFormulaModel:function(){return this.formulaModel;},getTopEditorBox:function(){return new com.wiris.e1_C(this,this.formulaModel.vY2());},getCurrentEditorBox:function(){var box=this.formulaModel.vZ2().vY2();return new com.wiris.e1_C(this,box);},addValidator:function(va2){if(this.validators==null)this.validators=new Array();this.validators.push(va2);},pasteMathML:function(vb2){this.formulaModel.pasteMathML(vb2);this.dispatchEvents();},getSelectionMathML:function(){return this.formulaModel.getSelectionMathML();},deleteSelection:function(){this.formulaModel.deleteSelection();this.dispatchEvents();},getFormulaLength:function(){return this.formulaModel.getLength();},notifyTransformation:function(vc2){this.transformationReceived=vc2;this.dispatchEvents();},getErrorRectangles:function(){return this.formulaModel.getErrorRectangles();},setTransformationGrammarResource:function(vd2){this.transformationGrammarResource=vd2;},setTransformationGrammarURL:function(url){this.transformationGrammarURL=url;},getTransformation:function(){this.transformer.getTransformation(this.transformationGrammarURL,this.transformationGrammarResource);},setEmptyScriptBoxColor:function(c){this.formulaModel.setEmptyScriptBoxColor(c);},getEmptyScriptBoxColor:function(){return this.formulaModel.getEmptyScriptBoxColor();},setEmptyBoxColor:function(c){this.formulaModel.setEmptyBoxColor(c);},getEmptyBoxColor:function(){return this.formulaModel.getEmptyBoxColor();},updateBounds:function(x,vQ1,width,height,margin,ve2){x-=margin;vQ1-=margin;var vf2=new Array();vf2[0]=x;vf2[1]=vQ1;var vg2=this.getCaretRectangle();if(vg2==null)return vf2;if(vg2.x<x+margin){vf2[0]=vg2.x-margin;if(ve2)vf2[0]-=Math.floor(width/4);}else if(vg2.x+vg2.width>x+width-margin){vf2[0]=vg2.x+vg2.width-width+margin;if(ve2)vf2[0]+=Math.floor(width/4);};if(vg2.vQ1<vQ1+margin)vf2[1]=vg2.vQ1-margin;else if(vg2.vQ1+vg2.height>vQ1+height-margin)vf2[1]=vg2.vQ1+vg2.height-height+margin;vf2[0]+=margin;vf2[1]+=margin;return vf2;},toolbarReseted:function(vV2){},isReady:function(){return this.remainingCalls==0;},setToolbar:function(vh2){if(vh2==null)throw"Toolbar modification XML is empty.";var vi2=HxOverrides.substr(vh2,0,1);if("<"==vi2)com.wiris.editor.ModelFactory.vj2(this,this.toolbar,vh2);else if(this.toolbarExists(vh2)){this.toolbar.vk2=false;this.toolbar.empty();this.toolbar.vB2(this.registeredToolbars.get(vh2));this.toolbar.vk2=true;this.toolbar.vl2();}else throw"Toolbar \""+vh2+"\" does not exist.";},urlAnswerReceived:function(url,parameters,vm2){},serviceAnswerReceived:function(serviceName,parameters,vm2){this.formulaModel.vn2(false);this.formulaModel.vo2(com.wiris.util.xml.WXmlUtils.vG2(vm2));--this.remainingCalls;this.dispatchEvents();},registerToolbar:function(name,xml){var toolbar=new com.wiris.e1_v();com.wiris.editor.ModelFactory.vj2(this,toolbar,xml);this.registeredToolbars.set(name,toolbar);},toolbarExists:function(name){if(this.registeredToolbars.exists(name))return true;var resourceLoader=new com.wiris.system.ResourceLoader();var xml=resourceLoader.loadResource("toolbar_"+name);if(xml==null)return false;this.registerToolbar(name,xml);return true;},setMode:function(mode){if("visualization"==mode)this.formulaModel.setMode(com.wiris.editor.formula.FormulaModel.vp2);else if("icons"==mode)this.formulaModel.setMode(com.wiris.editor.formula.FormulaModel.vq2);else if("fullIcons"==mode)this.formulaModel.setMode(com.wiris.editor.formula.FormulaModel.vr2);else this.formulaModel.setMode(com.wiris.editor.formula.FormulaModel.vs2);this.dispatchEvents();},setDisplay:function(display){if("inline"==display)this.formulaModel.setDisplay(com.wiris.editor.formula.FormulaModel.vt2);else this.formulaModel.setDisplay(com.wiris.editor.formula.FormulaModel.vu2);this.dispatchEvents();},normalizeLanguage:function(language){if(language==null)return"en";language=language.toLowerCase();language=StringTools.replace(language,"-","_");if(language.length>2&&language.length!=5)language=HxOverrides.substr(language,0,2);return language;},commaSeparatedValuesToArrobaSeparatedValues:function(vv2,vw2){var i=HxOverrides.iter(vv2.split(","));var vx2="@";while(i.hasNext()){var value=StringTools.trim(i.next());if(vw2)value=this.normalizeLanguage(value);vx2+=value+"@";};return vx2;},listContainsLanguage:function(list,language,vy2){if(vy2.indexOf("@"+language+"@")>=0)return false;if(list.indexOf("@"+language+"@")>=0)return true;if(language.length>2&&list.indexOf("@"+HxOverrides.substr(language,0,2)+"@")>=0)return true;return false;},setParam:function(vJ1,value){this.initParameters.set(vJ1,value);var vz2=vJ1.toLowerCase();if("mml"==vJ1)this.setMathML(value);else if("toolbar"==vJ1)this.setToolbar(value);else if("mode"==vJ1)this.setMode(value);else if("display"==vJ1)this.setDisplay(value);else if("grammarURL"==vJ1)this.setTransformationGrammarURL(value);else if("grammarResource"==vJ1)this.setTransformationGrammarResource(value);else if("reservedWords"==vJ1)this.formulaModel.v03(value);else if("forceReservedWords"==vJ1){this.formulaModel.v13("true"==value);this.formulaModel.v23("true"==value);}else if("reservedWordsColor"==vJ1)this.formulaModel.v33(value);else if("language"==vJ1){value=this.normalizeLanguage(value);if(this.formulaModel.isEmpty()){if(this.listContainsLanguage(this.rtlLanguages,value,this.ltrLanguages))this.formulaModel.v43(true);else this.formulaModel.v43(false);};if(this.listContainsLanguage(this.arabicIndicLanguages,value,this.europeanLanguages))this.formulaModel.v53(com.wiris.editor.formula.FormulaModel.v63,true);else if(this.listContainsLanguage(this.easternArabicIndicLanguages,value,this.europeanLanguages))this.formulaModel.v53(com.wiris.editor.formula.FormulaModel.v73,true);else this.formulaModel.v53(com.wiris.editor.formula.FormulaModel.v83,true);}else if("rtlLanguages"==vJ1)this.rtlLanguages=this.commaSeparatedValuesToArrobaSeparatedValues(value,true);else if("ltrLanguages"==vJ1)this.ltrLanguages=this.commaSeparatedValuesToArrobaSeparatedValues(value,true);else if("arabicIndicLanguages"==vJ1)this.arabicIndicLanguages=this.commaSeparatedValuesToArrobaSeparatedValues(value,true);else if("easternArabicIndicLanguages"==vJ1)this.easternArabicIndicLanguages=this.commaSeparatedValuesToArrobaSeparatedValues(value,true);else if("europeanLanguages"==vJ1)this.europeanLanguages=this.commaSeparatedValuesToArrobaSeparatedValues(value,true);else if("allowInnerNewLines"==vJ1)this.formulaModel.v93("true"==value);else if("styles"==vJ1){var vA3=js.Boot.vQ2(com.wiris.e1_81.decode(value),HaxeHash);var vB3=new HaxeHash();var i=vA3.keys();while(i.hasNext()){var selector=i.next();if(selector=="math"){var styles=js.Boot.vQ2(vA3.get(selector),HaxeHash);var vC3=new HaxeHash();var vD3=styles.keys();while(vD3.hasNext()){var vE3=vD3.next();var vF3=js.Boot.vQ2(styles.get(vE3),String);vC3.set(vE3,vF3);};this.formulaModel.vG3(vC3);}else{var styles=js.Boot.vQ2(vA3.get(selector),HaxeHash);var vH3=new com.wiris.e1_61();var vI3=new HaxeHash();var vD3=styles.keys();while(vD3.hasNext()){var vE3=vD3.next();var vF3=js.Boot.vQ2(styles.get(vE3),String);if(com.wiris.editor.EditorModel.ALLOWED_STYLE_PARAMS.indexOf("@"+vE3+"@")>=0)vI3.set(com.wiris.util.css.CSSUtils.vJ3(vE3),vF3);};vH3.setParams(vI3);vB3.set(selector,vH3);}};this.formulaModel.vK3(vB3);}else if("globalStyles"==vJ1)this.formulaModel.vL3("true"==value);else if("defaultstretchy"==vz2)this.formulaModel.vM3("true"==value);},getParam:function(vJ1){if(this.initParameters.exists(vJ1))return this.initParameters.get(vJ1);return null;},setParams:function(parameters){if(parameters.exists("template"))this.template=parameters.get("template");if("blackboardReservedVariables"==this.template)com.wiris.editor.ext.BlackboardReservedVariablesTemplate.vN3(parameters);com.wiris.e1_8.parse(parameters);var style=com.wiris.e1_61.vO3(this.getDefaultStyles());style.setParams(parameters);this.setDefaultStyles(style);if(parameters.exists("language")){if(parameters.exists("rtlLanguages"))this.setParam("rtlLanguages",parameters.get("rtlLanguages"));if(parameters.exists("ltrLanguages"))this.setParam("ltrLanguages",parameters.get("ltrLanguages"));if(parameters.exists("arabicIndicLanguages"))this.setParam("arabicIndicLanguages",parameters.get("arabicIndicLanguages"));if(parameters.exists("easternArabicIndicLanguages"))this.setParam("easternArabicIndicLanguages",parameters.get("easternArabicIndicLanguages"));if(parameters.exists("europeanLanguages"))this.setParam("europeanLanguages",parameters.get("europeanLanguages"));};var i=parameters.keys();while(i.hasNext()){var vJ1=i.next();var value=parameters.get(vJ1);this.setParam(vJ1,value);};this.dispatchEvents();},getCurrentActualStyles:function(){return this.formulaModel.getCurrentActualStyles();},getCurrentStyles:function(){return this.formulaModel.getCurrentStyles();},setSelectionStyles:function(s){var vP3=com.wiris.e1_61.vO3(s);this.formulaModel.vQ3(vP3);this.dispatchEvents();},getDesiredDefaultStyles:function(){return this.formulaModel.getDesiredDefaultStyles();},getDefaultStyles:function(){return this.formulaModel.getDefaultStyles();},setDefaultStyles:function(c){this.formulaModel.setDefaultStyles(c);this.dispatchEvents();},getCaretLength:function(){return this.formulaModel.getCaretLength();},getCaret:function(){return this.formulaModel.getCaret();},tabUpdated:function(vV2,index){},tabRemoved:function(vV2,index){},tabChanged:function(vV2,from,to){},standardToFormula:function(vR3){var vS3=new com.wiris.e1_I();var vT3=com.wiris.util.xml.WXmlUtils.vG2(vR3);return vS3.standardToFormula(vT3).toString();},setMathML:function(vb2){this.temporalMathML=vb2;this.formulaModel.vn2(true);++this.remainingCalls;var parameters=new HaxeHash();parameters.set("mml",vb2);com.wiris.system.ServiceProvider.vU3("mathml2internal",parameters,this);},setCaret:function(vV3,length){this.formulaModel.setCaret(vV3,length);this.formulaModel.vW3(false);this.dispatchEvents();},selectWord:function(vX3){this.formulaModel.selectWord(vX3);this.dispatchEvents();},reset:function(){this.formulaModel.reset();this.dispatchEvents();},registerAction:function(action){this.actions.set(action.id,action);},recalcClient:function(vY3){this.formulaModel.recalcClient(vY3);},recalc:function(vY3){this.formulaModel.recalc(vY3);},paintClient:function(vY3){this.formulaModel.paintClient(vY3);this.dispatchEvents();},paint:function(vY3){this.formulaModel.paint(vY3);this.dispatchEvents();},isRecalcNeeded:function(){return this.formulaModel.isRecalcNeeded();},isFormulaEmpty:function(){return this.formulaModel.isEmpty();},insertText:function(text){this.formulaModel.insertText(text);this.dispatchEvents();},insertMathML:function(vb2,v52){this.formulaModel.insertMathML(vb2,v52);this.dispatchEvents();},keyEventIsHandled:function(keyCode,shiftKey,ctrlKey,altKey){return ctrlKey&&!altKey||shiftKey&&keyCode==32;},handleKeyEvent:function(keyCode,shiftKey,ctrlKey,altKey){var vZ3=false;if(keyCode==32&&shiftKey){this.action("thinSpace");vZ3=true;}else if(keyCode==38&&ctrlKey&&!altKey){this.action("superscript");vZ3=true;}else if(keyCode==40&&ctrlKey&&!altKey){this.action("subscript");vZ3=true;}else if(keyCode==111&&ctrlKey&&!altKey){this.action("fraction");vZ3=true;}else if(keyCode==66&&ctrlKey&&!altKey){this.action("bold");vZ3=true;}else if(keyCode==73&&ctrlKey&&!altKey){this.action("italic");vZ3=true;}else vZ3=this.formulaModel.handleKeyEvent(keyCode,shiftKey,ctrlKey,altKey);this.dispatchEvents();return vZ3;},getToolbarModel:function(){return this.toolbar;},getSelectionRectangles:function(){var va3=this.formulaModel.getSelectionRectangles();return va3;},getPositionFromPoint:function(x,vQ1){var position=this.formulaModel.getPositionFromPoint(x,vQ1);return position;},getMathML:function(){if(this.temporalMathML!=null)return this.temporalMathML;var vb2=com.wiris.util.xml.WXmlUtils.vb3(this.formulaModel.vc3());return vb2;},getFormulaWidth:function(){return this.formulaModel.getWidth();},getFormulaHeight:function(){return this.formulaModel.getHeight();},getFormulaBaseline:function(){return this.formulaModel.getBaseline();},getInverseCaretRectangle:function(){var vd3=this.formulaModel.getInverseCaretRectangle();return vd3;},getCaretRectangle:function(){var vd3=this.formulaModel.getCaretRectangle();return vd3;},formulaToStandard:function(formula){var vS3=new com.wiris.e1_I();var ve3=com.wiris.util.xml.WXmlUtils.vG2(formula);return vS3.formulaToStandard(ve3,true).toString();},endEventTransaction:function(){--this.eventTransactionSemaphore;if(this.eventTransactionSemaphore<0)this.eventTransactionSemaphore=0;this.dispatchEvents();},dispatchEvents:function(){if(this.eventTransactionSemaphore==0){var vf3=this.formulaModel.vf3();var vg3=this.formulaModel.vg3();var vh3=this.formulaModel.vh3();var vi3=this.formulaModel.vi3();this.formulaModel.vj3();if(vf3){var i=HxOverrides.iter(this.listeners);while(i.hasNext())i.next().caretPositionChanged(this);};if(vg3){var i=HxOverrides.iter(this.listeners);while(i.hasNext())i.next().clipboardChanged(this);};if(vh3){this.temporalMathML=null;var i=HxOverrides.iter(this.listeners);while(i.hasNext())i.next().contentChanged(this);if(this.validators!=null){var vD3=HxOverrides.iter(this.validators);while(vD3.hasNext())if(!vD3.next().validate(this.formulaModel.vY2())){this.formulaModel.undo();this.formulaModel.vk3();this.dispatchEvents();break;}}};if(vi3){this.temporalMathML=null;var i=HxOverrides.iter(this.listeners);while(i.hasNext())i.next().styleChanged(this);};if(this.transformationReceived!=null){var vc2=this.transformationReceived;this.transformationReceived=null;var i=HxOverrides.iter(this.listeners);while(i.hasNext()){var listener=i.next();listener.transformationReceived(this,vc2);}}}},contextTabAdded:function(vV2,tab){},componentUpdated:function(vV2,vl3){},componentFired:function(vV2,vl3){if(js.Boot.__instanceof(vl3,com.wiris.e1_p)){var matrixButton=js.Boot.vQ2(vl3,com.wiris.e1_p);if(matrixButton.action!=null)this.actionWithParam(matrixButton.action.id,matrixButton.value);}else if(js.Boot.__instanceof(vl3,com.wiris.e1_k)){var button=js.Boot.vQ2(vl3,com.wiris.e1_k);if(button.action!=null){if(button.action.id==null){if(button.action.v62)this.insertMathML(button.action.content,button.action.v52);else this.insertText(button.action.content);}else this.action(button.action.id);}}else if(js.Boot.__instanceof(vl3,com.wiris.e1_s)){var select=js.Boot.vQ2(vl3,com.wiris.e1_s);if(select.action!=null)this.actionWithParam(select.action.id,select.value);}else if(js.Boot.__instanceof(vl3,com.wiris.e1_l)){var colorChooser=js.Boot.vQ2(vl3,com.wiris.e1_l);if(colorChooser.action!=null)this.actionWithParam(colorChooser.action.id,colorChooser.value);}},clearMetricsCache:function(){this.formulaModel.vm3();},beginEventTransaction:function(){++this.eventTransactionSemaphore;},removeEditorListener:function(listener){HxOverrides.remove(this.listeners,listener);},addEditorListener:function(listener){this.listeners.push(listener);},actionWithParam:function(vn3,vo3){if(vn3=="setFontFamily"){this.formulaModel.setFontFamily(vo3);this.dispatchEvents();}else if(vn3=="setFontSize"){var vp3=vo3=="inherit"?-1:com.wiris.util.css.CSSUtils.vq3(vo3);this.formulaModel.setFontSize(vp3);this.dispatchEvents();}else if(vn3=="setColor"){this.formulaModel.setColor(vo3);this.dispatchEvents();}else if(vn3=="setMaxWidth"){this.formulaModel.setMaxWidth(vo3);this.dispatchEvents();}else if(vn3=="setClassType"){this.formulaModel.setClassType(vo3);this.dispatchEvents();}else if(vn3=="setMatrixLineColor"){this.formulaModel.setMatrixLineColor(vo3);this.dispatchEvents();}else if(vn3=="setColumnSpacing"){this.formulaModel.vr3(true,vo3);this.dispatchEvents();}else if(vn3=="setRowSpacing"){this.formulaModel.vr3(false,vo3);this.dispatchEvents();}else{var action=this.actions.get(vn3);if(action!=null&&action.v72){this.formulaModel.vs3();try{this.action(vn3);var vt3=vo3.split(":");var rows=Std.parseInt(vt3[0]);var vu3=Std.parseInt(vt3[1]);while(rows>1){this.formulaModel.prependRow();--rows;};while(vu3>1){this.formulaModel.prependColumn();--vu3;};this.dispatchEvents();}catch(e){};this.formulaModel.vv3();}}},action:function(vn3){if(vn3=="undo")this.formulaModel.undo();else if(vn3=="redo")this.formulaModel.redo();else if(vn3=="bold")this.formulaModel.vw3();else if(vn3=="italic")this.formulaModel.vx3();else if(vn3=="autoItalic")this.formulaModel.vy3();else if(vn3=="forceLigature")this.formulaModel.vz3();else if(vn3=="mtext")this.formulaModel.v04();else if(vn3=="rtl")this.formulaModel.v43(!this.formulaModel.vY2().styles.isFlag(com.wiris.e1_61.v14));else if(vn3=="copy")this.formulaModel.copy();else if(vn3=="paste")this.formulaModel.paste();else if(vn3=="cut")this.formulaModel.cut();else if(vn3=="appendRow")this.formulaModel.appendRow();else if(vn3=="prependRow")this.formulaModel.prependRow();else if(vn3=="removeRow")this.formulaModel.removeRow();else if(vn3=="appendColumn")this.formulaModel.appendColumn();else if(vn3=="prependColumn")this.formulaModel.prependColumn();else if(vn3=="removeColumn")this.formulaModel.removeColumn();else if(vn3=="addFrame")this.formulaModel.addFrame(-1);else if(vn3=="removeFrame")this.formulaModel.removeFrame();else if(vn3=="addFrameTop")this.formulaModel.addFrame(0);else if(vn3=="addFrameBottom")this.formulaModel.addFrame(2);else if(vn3=="addFrameLeft")this.formulaModel.addFrame(3);else if(vn3=="addFrameRight")this.formulaModel.addFrame(1);else if(vn3=="addLineBelow")this.formulaModel.addLineBelow();else if(vn3=="removeLineBelow")this.formulaModel.removeLineBelow();else if(vn3=="addLineRight")this.formulaModel.addLineRight();else if(vn3=="removeLineRight")this.formulaModel.removeLineRight();else if(vn3=="arabicIndicNumbers")this.formulaModel.v53(com.wiris.editor.formula.FormulaModel.v63,false);else if(vn3=="easternArabicIndicNumbers")this.formulaModel.v53(com.wiris.editor.formula.FormulaModel.v73,false);else if(vn3=="alignLeft")this.formulaModel.v24(com.wiris.e1_61.v34);else if(vn3=="alignRight")this.formulaModel.v24(com.wiris.e1_61.v44);else if(vn3=="alignCenter")this.formulaModel.v24(com.wiris.e1_61.v54);else if(vn3=="alignDecimal")this.formulaModel.v24(com.wiris.e1_61.v64);else if(vn3=="alignRelation")this.formulaModel.v24(com.wiris.e1_61.v74);else if(vn3=="alignAuto")this.formulaModel.v24(com.wiris.e1_61.v84);else if(vn3=="equalRowHeight")this.formulaModel.equalRowHeight();else if(vn3=="equalColWidth")this.formulaModel.equalColWidth();else if(vn3=="alignRowsTop")this.formulaModel.v94(com.wiris.editor.formula.Styles.vA4);else if(vn3=="alignRowsBottom")this.formulaModel.v94(com.wiris.editor.formula.Styles.vB4);else if(vn3=="alignRowsCenter")this.formulaModel.v94(com.wiris.editor.formula.Styles.vC4);else if(vn3=="alignRowsAxis")this.formulaModel.v94(com.wiris.editor.formula.Styles.vD4);else if(vn3=="alignRowsBaseline")this.formulaModel.v94(com.wiris.editor.formula.Styles.vE4);else if(vn3=="matrixSolidLine")this.formulaModel.matrixSolidLine();else if(vn3=="matrixThickLine")this.formulaModel.matrixThickLine();else if(vn3=="matrixDashLine")this.formulaModel.matrixDashLine();else if(vn3=="matrixDotLine")this.formulaModel.matrixDotLine();else if(vn3=="turnToLatin"){this.formulaModel.turnToLatin();this.formulaModel.vW3(false);}else if(vn3=="turnToGreek")this.formulaModel.turnToGreek();else if(vn3=="typeInGreek")this.formulaModel.vW3(true);else if(vn3=="clearStyles")this.formulaModel.clearStyles();else if(vn3=="removeAccents")this.formulaModel.removeAccents();else{var action=this.actions.get(vn3);if(action!=null){if(action.command=="insertion"){if(action.v62){if(action.contentRTL!=null&&this.formulaModel.vY2().styles.isFlag(com.wiris.e1_61.v14))this.insertMathML(action.contentRTL,action.v52);else this.insertMathML(action.content,action.v52);}else this.insertText(action.content);}else this.action(action.command);}};this.dispatchEvents();},template:null,initParameters:null,europeanLanguages:null,easternArabicIndicLanguages:null,arabicIndicLanguages:null,ltrLanguages:null,rtlLanguages:null,validators:null,temporalMathML:null,transformationReceived:null,transformer:null,transformationGrammarResource:null,transformationGrammarURL:null,registeredToolbars:null,toolbar:null,remainingCalls:null,listeners:null,formulaModel:null,eventTransactionSemaphore:null,actions:null,__class__:com.wiris.editor.EditorModel};com.wiris.editor.GraphicsContext=v91["com.wiris.editor.GraphicsContext"]=function(){};com.wiris.editor.GraphicsContext.__name__=["com","wiris","editor","GraphicsContext"];com.wiris.editor.GraphicsContext.prototype={getDefaultStyles:null,setFormat:null,getItalicExtraSpace:null,getXHeight:null,getZoom:null,fillRect:null,getLineWidth:null,drawArc:null,setStyle:null,setLineWidth:null,setColor:null,setBracketsSmaller:null,getWidths:null,getWidth:null,getStyle:null,getMiddle:null,getLength:null,getHeight:null,getColor:null,getBaseline:null,endTranslate:null,drawLine:null,drawVerticalLineWithType:null,drawHorizontalLineWithType:null,drawVerticalLine:null,drawHorizontalLine:null,drawText2:null,drawText:null,beginTranslate:null,__class__:com.wiris.editor.GraphicsContext};com.wiris.editor.ModelFactory=v91["com.wiris.editor.ModelFactory"]=function(){};com.wiris.editor.ModelFactory.__name__=["com","wiris","editor","ModelFactory"];com.wiris.editor.ModelFactory.vF4=function(vG4){if(vG4==null)return new Array();return js.Boot.vQ2(vG4,Array);};com.wiris.editor.ModelFactory.vH4=function(vG4){if(vG4==null)return new HaxeHash();return js.Boot.vQ2(vG4,HaxeHash);};com.wiris.editor.ModelFactory.vI4=function(vG4){if(vG4==null)return null;return js.Boot.vQ2(vG4,String);};com.wiris.editor.ModelFactory.vJ4=function(i,vK4,vL4){var elements=new Array();while(i.hasNext()){var node=com.wiris.editor.ModelFactory.vH4(i.next());var attributes=com.wiris.editor.ModelFactory.vH4(node.get("attrs"));if(vL4==attributes.get(vK4))elements.push(node);};return elements;};com.wiris.editor.ModelFactory.getElementsByName=function(i,name){var elements=new Array();while(i.hasNext()){var node=com.wiris.editor.ModelFactory.vH4(i.next());if(name==node.get("name"))elements.push(node);};return elements;};com.wiris.editor.ModelFactory.vM4=function(toolbar,vN4,vO4,v92,vP4){var vQ4=com.wiris.editor.ModelFactory.vH4(vN4.get("attrs"));var vR4=com.wiris.editor.ModelFactory.vI4(vQ4.get("action"));var icon=null;var iconRTL=null;var action=null;var vS4=null;if(vR4!=null){action=vO4.get(vR4);if(action==null)action=new com.wiris.e1_1(vR4,vR4);vS4=com.wiris.editor.ModelFactory.vI4(vQ4.get("description"));if(vS4==null)vS4=action.description!=null?action.description:vR4;vS4=com.wiris.editor.ModelFactory.vT4(vS4,vP4);var vU4=com.wiris.editor.ModelFactory.vF4(vN4.get("childs"));var icons=com.wiris.editor.ModelFactory.getElementsByName(HxOverrides.iter(vU4),"icon");if(icons.length>0)icon=com.wiris.editor.ModelFactory.vV4(com.wiris.editor.ModelFactory.vH4(icons[0]),v92,true,false);else if(action.icon!=null)icon=action.icon;else{var vW4=new HaxeHash();vW4.set("name","icon");var vX4=new HaxeHash();vX4.set("src",vR4);vW4.set("attrs",vX4);icon=com.wiris.editor.ModelFactory.vV4(vW4,v92,true,false);};var vY4=com.wiris.editor.ModelFactory.getElementsByName(HxOverrides.iter(vU4),"iconRTL");if(vY4.length>0)iconRTL=com.wiris.editor.ModelFactory.vV4(com.wiris.editor.ModelFactory.vH4(vY4[0]),v92,false,false);else if(action.iconRTL!=null)iconRTL=action.iconRTL;if(iconRTL==null&&icon!=null)iconRTL=v92.vZ4("rtl_"+vR4,true);}else{vS4=com.wiris.editor.ModelFactory.vI4(vQ4.get("description"));var content=com.wiris.editor.ModelFactory.vI4(vQ4.get("content"));var v62=true;var vU4=com.wiris.editor.ModelFactory.vF4(vN4.get("childs"));if(content==null){var va4=com.wiris.editor.ModelFactory.getElementsByName(HxOverrides.iter(vU4),"content");if(va4.length==0)throw"There is not content associated with the button with description \""+vS4+"\".";content=com.wiris.editor.ModelFactory.vI4(com.wiris.editor.ModelFactory.vH4(va4[0]).get("mml"));}else v62=false;action=new com.wiris.e1_1(content,"insertion");vO4.set(content,action);action.content=content;action.v62=v62;if(vS4!=null)vS4=com.wiris.editor.ModelFactory.vT4(vS4,vP4);else if(vP4.exists(content))vS4=com.wiris.editor.ModelFactory.vT4(content,vP4);action.description=vS4;var vb4=com.wiris.editor.ModelFactory.vI4(vQ4.get("offset"));if(vb4!=null)action.v52=Std.parseInt(vb4);var icons=com.wiris.editor.ModelFactory.getElementsByName(HxOverrides.iter(vU4),"icon");if(icons.length==0)throw"There is not icon associated with the button with description \""+vS4+"\".";icon=com.wiris.editor.ModelFactory.vV4(com.wiris.editor.ModelFactory.vH4(icons[0]),v92,true,false);iconRTL=com.wiris.editor.ModelFactory.vV4(com.wiris.editor.ModelFactory.vH4(icons[0]),v92,false,true);};var button=new com.wiris.e1_k(toolbar,vS4,icon);button.iconRTL=iconRTL;button.action=action;if(com.wiris.editor.ModelFactory.vc4.indexOf(action.command)>=0)button.vd4=true;return button;};com.wiris.editor.ModelFactory.ve4=function(toolbar,vf4,vO4,v92,vP4){var vg4=com.wiris.editor.ModelFactory.vH4(vf4.get("attrs"));var vR4=com.wiris.editor.ModelFactory.vI4(vg4.get("action"));if(vR4==null)throw"There is a matrix button widget without an \"action\" attribute.";var action=vO4.get(vR4);if(action==null)action=new com.wiris.e1_1(vR4,vR4);action.v72=true;var vS4=com.wiris.editor.ModelFactory.vI4(vg4.get("description"));if(vS4==null)vS4=vR4;vS4=com.wiris.editor.ModelFactory.vT4(vS4,vP4);var icon=null;var iconRTL=null;var vh4=com.wiris.editor.ModelFactory.vF4(vf4.get("childs"));var icons=com.wiris.editor.ModelFactory.getElementsByName(HxOverrides.iter(vh4),"icon");if(icons.length==0){if(action.icon==null){var vW4=new HaxeHash();vW4.set("name","icon");var vX4=new HaxeHash();vX4.set("src",vR4);vW4.set("attrs",vX4);icon=com.wiris.editor.ModelFactory.vV4(vW4,v92,true,false);iconRTL=com.wiris.editor.ModelFactory.vV4(vW4,v92,false,true);}else{icon=action.icon;iconRTL=action.iconRTL;}}else{icon=com.wiris.editor.ModelFactory.vV4(com.wiris.editor.ModelFactory.vH4(icons[0]),v92,true,false);iconRTL=com.wiris.editor.ModelFactory.vV4(com.wiris.editor.ModelFactory.vH4(icons[0]),v92,false,true);};var matrixButton=new com.wiris.e1_p(toolbar,action,vS4,icon);return matrixButton;};com.wiris.editor.ModelFactory.vi4=function(toolbar,vj4,vO4,vP4){var vk4=com.wiris.editor.ModelFactory.vH4(vj4.get("attrs"));var vR4=com.wiris.editor.ModelFactory.vI4(vk4.get("action"));if(vR4==null)throw"There is a color chooser widget without an \"action\" attribute.";var action=vO4.get(vR4);if(action==null)action=new com.wiris.e1_1(vR4,vR4);var vS4=com.wiris.editor.ModelFactory.vI4(vk4.get("description"));if(vS4==null)vS4=vR4;vS4=com.wiris.editor.ModelFactory.vT4(vS4,vP4);var vl4=com.wiris.editor.ModelFactory.vI4(vk4.get("default"));if(vl4==null)vl4="#000000";var colorChooser=new com.wiris.e1_l(toolbar,action,vS4,vl4);return colorChooser;};com.wiris.editor.ModelFactory.vm4=function(vn4,v92,vP4){var icon=null;var vo4=com.wiris.editor.ModelFactory.vH4(vn4.get("attrs"));var description=com.wiris.editor.ModelFactory.vI4(vo4.get("description"));description=com.wiris.editor.ModelFactory.vT4(description,vP4);var url=com.wiris.editor.ModelFactory.vI4(vo4.get("url"));if(url==null)throw"The link with description \""+description+"\" has not an URL.";var vp4=com.wiris.editor.ModelFactory.vF4(vn4.get("childs"));var icons=com.wiris.editor.ModelFactory.getElementsByName(HxOverrides.iter(vp4),"icon");if(icons.length==0)throw"There is not icon associated with the button with description \""+Std.string(vn4)+"\".";icon=com.wiris.editor.ModelFactory.vV4(com.wiris.editor.ModelFactory.vH4(icons[0]),v92,true,false);var link=new HaxeHash();link.set("description",description);link.set("url",url);link.set("icon",icon);return link;};com.wiris.editor.ModelFactory.vq4=function(toolbar,vr4,vO4,v92,vP4){var vs4=com.wiris.editor.ModelFactory.vH4(vr4.get("attrs"));var vR4=com.wiris.editor.ModelFactory.vI4(vs4.get("action"));if(vR4==null)throw"There is a select widget without an \"action\" attribute.";var action=vO4.get(vR4);if(action==null)action=new com.wiris.e1_1(vR4,vR4);var vS4=com.wiris.editor.ModelFactory.vI4(vs4.get("description"));if(vS4==null)vS4=vR4;vS4=com.wiris.editor.ModelFactory.vT4(vS4,vP4);var vt4=com.wiris.editor.ModelFactory.vI4(vs4.get("icon"));var icon=null;if(vt4!=null){var vW4=new HaxeHash();vW4.set("name","icon");var vX4=new HaxeHash();vX4.set("src",vt4);vW4.set("attrs",vX4);icon=com.wiris.editor.ModelFactory.vV4(vW4,v92,true,false);};var vu4=com.wiris.editor.ModelFactory.vI4(vs4.get("selected"));var options=new HaxeHash();var i=HxOverrides.iter(com.wiris.editor.ModelFactory.vF4(vr4.get("childs")));if(!i.hasNext())throw"There is a select node with no options.";while(i.hasNext()){var node=com.wiris.editor.ModelFactory.vH4(i.next());var nodeName=com.wiris.editor.ModelFactory.vI4(node.get("name"));if(nodeName=="option"){var vv4=com.wiris.editor.ModelFactory.vH4(node.get("attrs"));var id=com.wiris.editor.ModelFactory.vI4(vv4.get("id"));if(id==null)throw"There is an option node without the \"id\" attribute.";var label=com.wiris.editor.ModelFactory.vI4(vv4.get("label"));if(label==null)label=id;options.set(id,label);}else throw"Unknown node \""+nodeName+"\".";};var select=new com.wiris.e1_s(toolbar,action,vS4,icon,options,vu4);return select;};com.wiris.editor.ModelFactory.vU2=function(vw4,vO4,v92,parameters){var language="en";if(parameters!=null&&parameters.exists("language"))language=parameters.get("language");var vP4=com.wiris.editor.ModelFactory.vx4(language);var toolbar=new com.wiris.e1_v();com.wiris.editor.ModelFactory.vy4(toolbar,vw4,vO4,v92,vP4);return toolbar;};com.wiris.editor.ModelFactory.vM2=function(vz4,vO4,v92,parameters){var vw4=com.wiris.editor.ModelFactory.v05(vz4);return com.wiris.editor.ModelFactory.vU2(vw4,vO4,v92,parameters);};com.wiris.editor.ModelFactory.vV4=function(vW4,v92,ltr,v15){var src=com.wiris.editor.ModelFactory.vI4(com.wiris.editor.ModelFactory.vH4(vW4.get("attrs")).get("src"));var vb2=com.wiris.editor.ModelFactory.vI4(vW4.get("mml"));if(vb2!=null){vb2=StringTools.trim(vb2);if(vb2.length==0)vb2=null;};if(!ltr){if(vb2!=null&&StringTools.startsWith(vb2,"<")){var v25=vb2.indexOf(">");if(v25!=-1&&HxOverrides.substr(vb2,0,v25).indexOf(" dir=\"")<0)vb2=HxOverrides.substr(vb2,0,v25)+" dir=\"rtl\""+HxOverrides.substr(vb2,v25,null);};if(src!=null&&!StringTools.startsWith(src,"rtl_"))src="rtl_"+src;};if(src!=null){var img=v92.vZ4(src,v15);if(img!=null)img.vb2=vb2;return img;};return v92.v35(vb2);};com.wiris.editor.ModelFactory.vx4=function(language){var vP4=new HaxeHash();var resourceLoader=new com.wiris.system.ResourceLoader();var v45=resourceLoader.loadResource("lang/"+language+".xml");if(v45==null){if(language=="en")return vP4;return com.wiris.editor.ModelFactory.vx4("en");};var v55=com.wiris.util.xml.WXmlUtils.vG2(v45);var i=com.wiris.util.xml.WXmlUtils.v65(v55).elements();while(i.hasNext()){var node=i.next();if(node.getNodeName()=="t")vP4.set(com.wiris.util.xml.WXmlUtils.getAttribute(node,"k"),com.wiris.util.xml.WXmlUtils.getAttribute(node,"v"));};return vP4;};com.wiris.editor.ModelFactory.vT2=function(vK2,v92){var vO4=new HaxeHash();var i=HxOverrides.iter(com.wiris.editor.ModelFactory.vF4(vK2.get("childs")));while(i.hasNext()){var v75=com.wiris.editor.ModelFactory.vH4(i.next());if(v75.get("name")=="action"){var v85=com.wiris.editor.ModelFactory.vH4(v75.get("attrs"));var id=com.wiris.editor.ModelFactory.vI4(v85.get("id"));if(id==null)throw"There is an action without the \"id\" attribute.";var description=com.wiris.editor.ModelFactory.vI4(v85.get("description"));var content=null;var contentRTL=null;var icon=null;var iconRTL=null;var vD3=HxOverrides.iter(com.wiris.editor.ModelFactory.vF4(v75.get("childs")));while(vD3.hasNext()){var node=com.wiris.editor.ModelFactory.vH4(vD3.next());var nodeName=com.wiris.editor.ModelFactory.vI4(node.get("name"));if(nodeName=="content")content=com.wiris.editor.ModelFactory.vI4(node.get("mml"));else if(nodeName=="contentRTL")contentRTL=com.wiris.editor.ModelFactory.vI4(node.get("mml"));else if(nodeName=="icon")icon=com.wiris.editor.ModelFactory.vV4(node,v92,true,false);else if(nodeName=="iconRTL")iconRTL=com.wiris.editor.ModelFactory.vV4(node,v92,false,false);};var command=com.wiris.editor.ModelFactory.vI4(v85.get("command"));if(command==null){if(content!=null)command="insertion";else command=id;};var action=new com.wiris.e1_1(id,command);action.description=description;action.icon=icon;action.iconRTL=iconRTL;if(command=="insertion"){if(content==null)throw"There is no content associated to the action \""+Std.string(v85.get("id"))+"\".";action.content=content;action.contentRTL=contentRTL;var vb4=com.wiris.editor.ModelFactory.vI4(v85.get("offset"));if(vb4!=null)action.v52=Std.parseInt(vb4);};vO4.set(id,action);}};return vO4;};com.wiris.editor.ModelFactory.vL2=function(v95,v92){var vK2=com.wiris.editor.ModelFactory.v05(v95);return com.wiris.editor.ModelFactory.vT2(vK2,v92);};com.wiris.editor.ModelFactory.vA5=function(toolbar,section,vB5,vO4,vC5,extra,showDisabled,vP4){var i=HxOverrides.iter(com.wiris.editor.ModelFactory.vF4(vB5.get("childs")));while(i.hasNext()){var node=com.wiris.editor.ModelFactory.vH4(i.next());var vv4=com.wiris.editor.ModelFactory.vH4(node.get("attrs"));var nodeName=com.wiris.editor.ModelFactory.vI4(node.get("name"));var vD5=showDisabled||!("false"==vv4.get("enabled"));if(nodeName=="button"){var button=com.wiris.editor.ModelFactory.vM4(toolbar,node,vO4,vC5,vP4);button.vD5=vD5;section.vE5(button,extra);}else if(nodeName=="select"){var select=com.wiris.editor.ModelFactory.vq4(toolbar,node,vO4,vC5,vP4);select.vD5=vD5;section.vE5(select,extra);}else if(nodeName=="colorChooser"){var colorChooser=com.wiris.editor.ModelFactory.vi4(toolbar,node,vO4,vP4);colorChooser.vD5=vD5;section.vE5(colorChooser,extra);}else if(nodeName=="matrixButton"){var matrixButton=com.wiris.editor.ModelFactory.ve4(toolbar,node,vO4,vC5,vP4);matrixButton.vD5=vD5;section.vE5(matrixButton,extra);}else if(!extra&&nodeName=="extra"){var extraLayout=vv4.get("layout");if(extraLayout!=null)section.extraLayout="horizontal"==extraLayout?com.wiris.e1_r.vF5:com.wiris.e1_r.vG5;com.wiris.editor.ModelFactory.vA5(toolbar,section,node,vO4,vC5,true,showDisabled,vP4);}else throw"Unknown node \""+nodeName+"\".";}};com.wiris.editor.ModelFactory.vH5=function(toolbar,vw4,vI5,vO4,v92,enabled,showDisabled,vP4){var vJ5=com.wiris.editor.ModelFactory.vH4(vI5.get("attrs"));var vK5=com.wiris.editor.ModelFactory.vF4(vI5.get("childs"));var id=com.wiris.editor.ModelFactory.vI4(vJ5.get("id"));if(id==null)throw"There is a tab without an \"id\" attribute.";var description=com.wiris.editor.ModelFactory.vI4(vJ5.get("description"));if(description==null)description=id;description=com.wiris.editor.ModelFactory.vT4(description,vP4);var icons=com.wiris.editor.ModelFactory.getElementsByName(HxOverrides.iter(vK5),"icon");var vL5=null;var vM5=null;if(icons.length>0){vL5=com.wiris.editor.ModelFactory.vV4(com.wiris.editor.ModelFactory.vH4(icons[0]),v92,true,false);if(icons.length>1)vM5=com.wiris.editor.ModelFactory.vV4(com.wiris.editor.ModelFactory.vH4(icons[1]),v92,true,false);else vM5=vL5;};var vY4=com.wiris.editor.ModelFactory.getElementsByName(HxOverrides.iter(vK5),"iconRTL");var vN5=null;var vO5=null;if(vY4.length>0){vN5=com.wiris.editor.ModelFactory.vV4(com.wiris.editor.ModelFactory.vH4(vY4[0]),v92,true,false);if(vY4.length>1)vO5=com.wiris.editor.ModelFactory.vV4(com.wiris.editor.ModelFactory.vH4(vY4[1]),v92,true,false);else vO5=vN5;};var vP5=com.wiris.editor.ModelFactory.vI4(vJ5.get("panel"));if(vP5==null)throw"There is not panel associated with the tab \""+description+"\".";var vQ5=com.wiris.editor.ModelFactory.vF4(vw4.get("childs"));var vR5=com.wiris.editor.ModelFactory.vJ4(HxOverrides.iter(com.wiris.editor.ModelFactory.getElementsByName(HxOverrides.iter(vQ5),"panel")),"id",vP5);if(vR5.length==0)throw"Panel \""+vP5+"\" does not exist.";var vS5=com.wiris.editor.ModelFactory.vH4(vR5[0]);var tab=new com.wiris.e1_t(toolbar,id,description,vL5,vM5);if(vN5!=null)tab.vN5=vN5;if(vO5!=null)tab.vO5=vO5;tab.vD5=enabled;toolbar.vT5(tab);com.wiris.editor.ModelFactory.vU5(toolbar,tab.panel,vS5,vO4,v92,showDisabled,vP4);};com.wiris.editor.ModelFactory.vU5=function(toolbar,panel,vS5,vO4,vC5,showDisabled,vP4){var rowsPerSection=2;var vV5=com.wiris.editor.ModelFactory.vH4(vS5.get("attrs"));var vW5=com.wiris.editor.ModelFactory.vI4(vV5.get("rowsPerSection"));if(vW5!=null)rowsPerSection=Std.parseInt(vW5);var i=HxOverrides.iter(com.wiris.editor.ModelFactory.vF4(vS5.get("childs")));while(i.hasNext()){var node=com.wiris.editor.ModelFactory.vH4(i.next());var nodeName=com.wiris.editor.ModelFactory.vI4(node.get("name"));if(nodeName=="disabled")continue;if(!(nodeName=="section"))throw"Uknown node \""+nodeName+"\".";var vv4=com.wiris.editor.ModelFactory.vH4(node.get("attrs"));var layout="horizontal"==vv4.get("layout")?com.wiris.e1_r.vF5:com.wiris.e1_r.vG5;var rows=rowsPerSection;var vX5=com.wiris.editor.ModelFactory.vI4(vv4.get("rows"));if(vX5!=null)rows=Std.parseInt(vX5);var section=new com.wiris.e1_r(layout,layout,rows);section.vD5=showDisabled||!("false"==vv4.get("enabled"));section.context=com.wiris.editor.ModelFactory.vI4(vv4.get("context"));panel.vY5(section);com.wiris.editor.ModelFactory.vA5(toolbar,section,node,vO4,vC5,false,showDisabled,vP4);}};com.wiris.editor.ModelFactory.vy4=function(toolbar,vw4,vO4,v92,vP4){var showDisabled="true"==vw4.get("showDisabled");var i=HxOverrides.iter(com.wiris.editor.ModelFactory.vF4(vw4.get("childs")));while(i.hasNext()){var node=com.wiris.editor.ModelFactory.vH4(i.next());var nodeName=com.wiris.editor.ModelFactory.vI4(node.get("name"));var vv4=com.wiris.editor.ModelFactory.vH4(node.get("attrs"));if(nodeName=="tab")com.wiris.editor.ModelFactory.vH5(toolbar,vw4,node,vO4,v92,showDisabled||!("false"==vv4.get("enabled")),showDisabled,vP4);else if(nodeName=="link"){var link=com.wiris.editor.ModelFactory.vm4(node,v92,vP4);toolbar.vZ5(link);}}};com.wiris.editor.ModelFactory.vT4=function(vJ1,vP4){if(vJ1==null)return null;var value=vP4.get(vJ1);if(value==null)return vJ1;return value;};com.wiris.editor.ModelFactory.v05=function(element){var hash=new HaxeHash();hash.set("name",element.getNodeName());var attributes=new HaxeHash();var i=element.attributes();while(i.hasNext()){var name=i.next();attributes.set(name,com.wiris.util.xml.WXmlUtils.getAttribute(element,name));};hash.set("attrs",attributes);if(element.getNodeName()=="content"||element.getNodeName()=="contentRTL"||element.getNodeName()=="icon"||element.getNodeName()=="iconRTL")hash.set("mml",com.wiris.util.xml.WXmlUtils.va5(element));else{var childNodes=new Array();var vD3=element.elements();while(vD3.hasNext())childNodes.push(com.wiris.editor.ModelFactory.v05(vD3.next()));hash.set("childs",childNodes);};return hash;};com.wiris.editor.ModelFactory.vj2=function(editorModel,toolbar,vh2){toolbar.vk2=false;var vb5=com.wiris.util.xml.WXmlUtils.vG2(vh2).firstElement();toolbar.empty();var vc5=false;var vd5=vb5.get("ref");var v82=editorModel.registeredToolbars.get("general");if(vd5!=null&&editorModel.toolbarExists(vd5)){vc5=true;toolbar.vB2(editorModel.registeredToolbars.get(vd5));if("true"==vb5.get("removeLinks"))toolbar.removeLinks();}else if(!("true"==vb5.get("removeLinks")))toolbar.ve5(v82);var i=vb5.elements();var vf5=false;while(i.hasNext()){var node=i.next();if("removeTab"==node.getNodeName()){var vg5=com.wiris.util.xml.WXmlUtils.getAttribute(node,"ref");if(vg5==null)throw"\"removeTab\" node without \"ref\" attribute.";if(vg5=="contextual")vf5=true;com.wiris.editor.ModelFactory.removeTab(toolbar,vg5);}else if("tab"==node.getNodeName()){var vh5=false;var vg5=com.wiris.util.xml.WXmlUtils.getAttribute(node,"ref");if(vg5==null){vh5=true;vg5=com.wiris.util.xml.WXmlUtils.getAttribute(node,"name");if(vg5==null)throw"\"tab\" node without \"ref\" or \"name\" attribute.";}else if(vg5=="contextual")vf5=true;var tab=com.wiris.editor.ModelFactory.vT5(toolbar,vg5,"true"==node.get("empty"),com.wiris.util.xml.WXmlUtils.getAttribute(node,"before"),v82,vh5);var rows=2;var vX5=node.get("rows");if(vX5!=null)rows=Std.parseInt(vX5);var extraRows=2;vX5=node.get("extraRows");if(vX5!=null)extraRows=Std.parseInt(vX5);com.wiris.editor.ModelFactory.vi5(toolbar,tab,node,rows,extraRows,v82);}else throw"Unknown node \""+node.getNodeName()+"\".";};var showTabs=vb5.get("showTabs");if(showTabs!=null)toolbar.vj5=showTabs=="true"?true:false;else toolbar.vj5=toolbar.vk5().length>1;if(!vc5&&!vf5&&toolbar.vj5)com.wiris.editor.ModelFactory.vT5(toolbar,"contextual",false,null,v82,false);toolbar.vk2=true;toolbar.vl2();toolbar.vl5(0);};com.wiris.editor.ModelFactory.vi5=function(toolbar,tab,vm5,rows,extraRows,v82){var i=vm5.elements();while(i.hasNext()){var node=i.next();if(node.getNodeName()=="removeItem"){var vn5=com.wiris.util.xml.WXmlUtils.getAttribute(node,"ref");if(vn5==null)throw"\"removeItem\" node without \"ref\" attribute.";com.wiris.editor.ModelFactory.vo5(tab,vn5);}else if(node.getNodeName()=="item"){var vn5=com.wiris.util.xml.WXmlUtils.getAttribute(node,"ref");if(vn5==null)throw"\"item\" node without \"ref\" attribute.";com.wiris.editor.ModelFactory.vE5(toolbar,tab,vn5,"true"==node.get("extra"),com.wiris.util.xml.WXmlUtils.getAttribute(node,"before"),null,rows,extraRows,v82);}else if(node.getNodeName()=="section"){var layout="horizontal"==node.get("layout")?com.wiris.e1_r.vF5:com.wiris.e1_r.vG5;var vp5=node.get("extraLayout");var extraLayout=layout;if(vp5!=null)extraLayout=vp5=="horizontal"?com.wiris.e1_r.vF5:com.wiris.e1_r.vG5;var vq5=rows;var vX5=node.get("rows");if(vX5!=null)vq5=Std.parseInt(vX5);var vr5=extraRows;vX5=node.get("extraRows");if(vX5!=null)vr5=Std.parseInt(vX5);var section=new com.wiris.e1_r(layout,extraLayout,vq5);section.extraRows=vr5;var vs5=node.get("position");if(vs5==null)tab.panel.vY5(section);else{var position=Std.parseInt(vs5);if(position<0||position>=tab.panel.vt5())throw"Wrong position "+position;tab.panel.vu5(section,position);};com.wiris.editor.ModelFactory.vv5(toolbar,tab,section,node,v82);}else throw"Unknown node \""+node.getNodeName()+"\".";}};com.wiris.editor.ModelFactory.vv5=function(toolbar,tab,section,vB5,v82){var i=vB5.elements();while(i.hasNext()){var node=i.next();if(node.getNodeName()=="item"){var vn5=com.wiris.util.xml.WXmlUtils.getAttribute(node,"ref");if(vn5==null)throw"\"item\" node without \"ref\" attribute.";com.wiris.editor.ModelFactory.vE5(toolbar,tab,vn5,"true"==node.get("extra"),null,section,section.rows,section.extraRows,v82);}else throw"Unknown node \""+node.getNodeName()+"\".";}};com.wiris.editor.ModelFactory.vE5=function(toolbar,tab,vw5,extra,before,section,vx5,vy5,v82){var vz5=null;var i=HxOverrides.iter(v82.vk5());while(i.hasNext()&&vz5==null){var v06=i.next();var vD3=v06.panel.vt5()-1;while(vD3>=0&&vz5==null){var v16=v06.panel.v26(vD3);vz5=com.wiris.editor.ModelFactory.v36(v16,vw5,false);if(vz5==null)vz5=com.wiris.editor.ModelFactory.v36(v16,vw5,true);--vD3;}};if(vz5==null)throw"Component with id \""+vw5+"\" not found.";var v46=vz5.copy();v46.vD5=true;v46.v56=toolbar;if(before==null){if(section==null){var v66=tab.panel.vt5();if(v66==0){section=new com.wiris.e1_r(com.wiris.e1_r.vG5,com.wiris.e1_r.vG5,vx5);section.extraRows=vy5;tab.panel.vY5(section);}else section=tab.panel.v26(tab.panel.vt5()-1);};section.vE5(v46,extra);}else{var v76=null;var v86=0;var vD3=tab.panel.vt5()-1;while(vD3>=0&&v76==null){section=tab.panel.v26(vD3);var k=section.v96(extra)-1;while(k>=0&&v76==null){var vl3=section.vA6(k,extra);if(vl3.action!=null&&vl3.action.id==before){v76=section;v86=k;};--k;};--vD3;};if(v76==null)throw"Referenced component \""+before+"\" not found.";v76.vB6(v46,v86,extra);}};com.wiris.editor.ModelFactory.v36=function(section,vR4,extra){var i=section.v96(extra)-1;while(i>=0){var vl3=section.vA6(i,extra);if(vl3.action!=null&&vl3.action.id==vR4)return vl3;--i;};return null;};com.wiris.editor.ModelFactory.vo5=function(tab,vR4){var i=tab.panel.vt5()-1;var vC6=false;var section=null;while(i>=0&&!vC6){section=tab.panel.v26(i);vC6=com.wiris.editor.ModelFactory.vD6(section,vR4,false)||com.wiris.editor.ModelFactory.vD6(section,vR4,true);if(!vC6)--i;};if(vC6&&section.v96(false)+section.v96(true)==0)tab.panel.vE6(i);};com.wiris.editor.ModelFactory.vD6=function(section,vR4,extra){var i=section.v96(extra)-1;while(i>=0){var vl3=section.vA6(i,extra);if(vl3.action!=null&&vl3.action.id==vR4){section.vo5(i,extra);return true;};--i;};return false;};com.wiris.editor.ModelFactory.vT5=function(toolbar,id,empty,before,v82,vh5){var vF6=null;var i=HxOverrides.iter(toolbar.vk5());while(i.hasNext()&&vF6==null){var vG6=i.next();if(vG6.id==id){vF6=vG6;if(empty)vF6.empty();}};if(vF6==null){if(vh5)vF6=new com.wiris.e1_t(toolbar,id,id,null,null);else{i=HxOverrides.iter(v82.vk5());while(i.hasNext()&&vF6==null){var v06=i.next();if(v06.id==id){if(empty)vF6=new com.wiris.e1_t(toolbar,id,v06.title,v06.vH6,v06.vI6);else vF6=com.wiris.e1_t.getNewInstance(v06,toolbar);vF6.vN5=v06.vN5;vF6.vO5=v06.vO5;}};if(vF6==null)throw"Tab \""+id+"\" not found in the general toolbar specification.";};if(before!=null){var index=0;i=HxOverrides.iter(toolbar.vk5());while(i.hasNext()&&index==-1){var vG6=i.next();if(vG6.id==before)break;++index;};if(index==-1)throw"Referenced tab \""+before+"\" does not exist.";toolbar.vJ6(vF6,index);}else toolbar.vT5(vF6);};return vF6;};com.wiris.editor.ModelFactory.removeTab=function(toolbar,vg5){var i=HxOverrides.iter(toolbar.vk5());while(i.hasNext()){var tab=i.next();if(tab.id==vg5)HxOverrides.remove(toolbar.vk5(),tab);}};com.wiris.e1_5=v91["com.wiris.e1_5"]=function(){};com.wiris.e1_5.__name__=["com","wiris","e1_5"];com.wiris.e1_5.vK6=function(x,vQ1){var p;p=new com.wiris.e1_5();p.x=x;p.vQ1=vQ1;return p;};com.wiris.e1_5.prototype={vQ1:null,x:null,__class__:com.wiris.e1_5};com.wiris.e1_6=v91["com.wiris.e1_6"]=function(){};com.wiris.e1_6.__name__=["com","wiris","e1_6"];com.wiris.e1_6.vL6=function(x,vQ1,width,height){var r;r=new com.wiris.e1_6();r.x=x;r.vQ1=vQ1;r.width=width;r.height=height;return r;};com.wiris.e1_6.prototype={height:null,width:null,vQ1:null,x:null,__class__:com.wiris.e1_6};com.wiris.e1_7=v91["com.wiris.e1_7"]=function(editorModel,v92){this.editorModel=editorModel;this.v92=v92;this.vM6();};com.wiris.e1_7.__name__=["com","wiris","e1_7"];com.wiris.e1_7.__interfaces__=[com.wiris.e1_4,com.wiris.editor.EditorListener];com.wiris.e1_7.prototype={sectionUpdated:function(vV2,tabIndex,vW2){},toolbarReseted:function(vV2){this.vM6();},tabUpdated:function(vV2,index){},tabRemoved:function(vV2,index){},tabChanged:function(vV2,from,to){},contextTabAdded:function(vV2,tab){this.vM6();},componentUpdated:function(vV2,vl3){},componentFired:function(vV2,vl3){},vN6:function(){var formulaModel=this.editorModel.getFormulaModel();var vO6=js.Boot.vQ2(this.editorModel.getToolbarModel(),com.wiris.e1_v);var vP6=formulaModel.vP6();if(vP6!=this.vQ6){vO6.vR6("redo",vP6);this.vQ6=vP6;};var vS6=formulaModel.vS6();if(vS6!=this.vT6){vO6.vR6("undo",vS6);this.vT6=vS6;}},vU6:function(style,vV6){if(style==null)return;var formulaModel=this.editorModel.getFormulaModel();var vO6=js.Boot.vQ2(this.editorModel.getToolbarModel(),com.wiris.e1_v);var bold=style.isFlag(com.wiris.e1_61.vW6);if(vV6||bold!=this.vX6){vO6.vY6("bold",bold);this.vX6=bold;};var italic=style.isFlag(com.wiris.e1_61.vZ6);if(vV6||italic!=this.va6){vO6.vY6("italic",italic);this.va6=italic;};var autoItalic=!style.isFlagMask(com.wiris.e1_61.vZ6);if(vV6||autoItalic!=this.vb6){vO6.vY6("autoItalic",autoItalic);this.vb6=autoItalic;};var mtext=style.isFlag(com.wiris.e1_61.vc6);if(vV6||mtext!=this.vd6){vO6.vY6("mtext",mtext);this.vd6=mtext;};var rtl=formulaModel.vY2().styles.isFlag(com.wiris.e1_61.v14);if(vV6||rtl!=this.ve6){vO6.vf6(!rtl);vO6.vY6("rtl",rtl);this.ve6=rtl;};var vg6=style.isFlag(com.wiris.e1_61.vh6);if(vV6||vg6!=this.vi6){vO6.vY6("forceLigature",vg6);this.vi6=vg6;};var vj6=formulaModel.vk6();if(vV6||vj6!=this.vl6){vO6.vY6("arabicIndicNumbers",vj6==com.wiris.editor.formula.FormulaModel.v63);vO6.vY6("easternArabicIndicNumbers",vj6==com.wiris.editor.formula.FormulaModel.v73);};var color=style.getColor();if(vV6||color!=this.vm6){vO6.vn6("setColor",com.wiris.util.css.CSSUtils.vo6(color));this.vm6=color;};var fontFamily=style.getFontFamily();if(vV6||!(fontFamily==this.vp6)){vO6.vn6("setFontFamily",fontFamily);this.vp6=fontFamily;};var fontSize;if(style.isFlagMask(com.wiris.e1_61.vq6))fontSize=style.getFontSize()+"px";else fontSize="inherit";if(vV6||!(fontSize==this.vr6)){vO6.vn6("setFontSize",fontSize);this.vr6=fontSize;};var vs6=js.Boot.vQ2(this.editorModel.getCurrentEditorBox(),com.wiris.e1_C);var vt6=false;var vu6=vs6.isMultiLine();var vv6=com.wiris.e1_61.v84;var vw6=null;var vx6=null;var vy6=null;var vz6=null;var v07=0;while(vs6!=null&&!vt6)if(vs6.getTagName()=="mtable"){vt6=true;var attributes=com.wiris.system.PropertiesTools.v17(vs6.getAttributes());var v27=Std.parseInt(attributes.get("#columns"));var v37=Math.floor(Math.floor(v07/js.Boot.vQ2(v27,Float)));var v47=v07%v27;var v57=attributes.get("rowalign");if(v57==null)v57=com.wiris.editor.formula.Styles.v67;var vt3=v57.split(" ");var v77=v37>=vt3.length?vt3.length-1:v37;vw6=vt3[v77];if(vV6||vw6!=this.v87){vO6.vY6("alignRowsCenter",vw6==com.wiris.editor.formula.Styles.vC4);vO6.vY6("alignRowsTop",vw6==com.wiris.editor.formula.Styles.vA4);vO6.vY6("alignRowsBottom",vw6==com.wiris.editor.formula.Styles.vB4);vO6.vY6("alignRowsAxis",vw6==com.wiris.editor.formula.Styles.vD4);vO6.vY6("alignRowsBaseline",vw6==com.wiris.editor.formula.Styles.vE4||vw6==com.wiris.editor.formula.Styles.v67);this.v87=vw6;};var v97=attributes.get("columnalign");if(v97==null)v97=com.wiris.editor.formula.Styles.v67;vt3=v97.split(" ");var vA7=v47>=vt3.length?vt3.length-1:v47;vx6=vt3[vA7];if(vx6==com.wiris.editor.formula.Styles.vB7)vv6=com.wiris.e1_61.v34;else if(vx6==com.wiris.editor.formula.Styles.vC7)vv6=com.wiris.e1_61.v44;else vv6=com.wiris.e1_61.v54;vy6=attributes.get("rowspacing");if(vy6==null)vy6="default";vt3=vy6.split(" ");v77=v37>=vt3.length?vt3.length-1:v37;vy6=vt3[v77];vz6=attributes.get("columnspacing");if(vz6==null)vz6="default";vt3=vz6.split(" ");vA7=v47;if(rtl){--vA7;if(vA7<0)vA7=vt3.length-1;};if(vA7>=vt3.length)vA7=vt3.length-1;vz6=vt3[vA7];}else{if(vv6==com.wiris.e1_61.v84)vv6=vs6.vY2().vD7.getAlign();var parent=vs6.getParent();if(parent==null)vs6=null;else{if(parent.getTagName()=="mtable")v07=vs6.vY2().v07;vs6=js.Boot.vQ2(parent,com.wiris.e1_C);}};if(vV6||vt6!=this.vE7||vu6!=this.vF7){vO6.vR6("alignLeft",vt6||vu6);vO6.vR6("alignRight",vt6||vu6);vO6.vR6("alignCenter",vt6||vu6);vO6.vR6("alignDecimal",vt6||vu6);vO6.vR6("alignRelation",vt6||vu6);};if(vV6||vt6!=this.vE7){vO6.vG7("matrix",vt6);vO6.vR6("prependRow",vt6);vO6.vR6("appendRow",vt6);vO6.vR6("prependColumn",vt6);vO6.vR6("appendColumn",vt6);vO6.vR6("removeRow",vt6);vO6.vR6("removeColumn",vt6);vO6.vR6("addFrame",vt6);vO6.vR6("removeFrame",vt6);vO6.vR6("addFrameTop",vt6);vO6.vR6("addFrameBottom",vt6);vO6.vR6("addFrameRight",vt6);vO6.vR6("addFrameLeft",vt6);vO6.vR6("addLineBelow",vt6);vO6.vR6("removeLineBelow",vt6);vO6.vR6("addLineRight",vt6);vO6.vR6("removeLineRight",vt6);vO6.vR6("alignRowsAxis",vt6);vO6.vR6("alignRowsBaseline",vt6);vO6.vR6("alignRowsTop",vt6);vO6.vR6("alignRowsCenter",vt6);vO6.vR6("alignRowsBottom",vt6);vO6.vR6("equalColWidth",vt6);vO6.vR6("equalRowHeight",vt6);vO6.vR6("matrixSolidLine",vt6);vO6.vR6("matrixThickLine",vt6);vO6.vR6("matrixDotLine",vt6);vO6.vR6("matrixDashLine",vt6);vO6.vR6("setColumnSpacing",vt6);vO6.vR6("setRowSpacing",vt6);this.vE7=vt6;};if(vV6||vu6!=this.vF7){vO6.vG7("multiline",vu6);this.vF7=vu6;};if(vv6==com.wiris.e1_61.v84)vv6=rtl?com.wiris.e1_61.v44:com.wiris.e1_61.v34;if(vV6||vv6!=this.vH7){vO6.vY6("alignLeft",vv6==com.wiris.e1_61.v34);vO6.vY6("alignCenter",vv6==com.wiris.e1_61.v54);vO6.vY6("alignRight",vv6==com.wiris.e1_61.v44);this.vH7=vv6;};var vI7=null;if(vt6){vI7=com.wiris.system.PropertiesTools.v17(vs6.getAttributes());var vJ7=vI7.get("#currentlinetype");if(vV6||!(vJ7==this.vK7)){vO6.vY6("matrixSolidLine",vJ7=="solid");vO6.vY6("matrixDashLine",vJ7=="dashed");this.vK7=vJ7;};var vL7="true"==vI7.get("equalrows");if(vV6||vL7!=this.vM7){vO6.vY6("equalRowHeight",vL7);this.vM7=vL7;};var vN7="true"==vI7.get("equalcolumns");if(vV6||vN7!=this.vO7){vO6.vY6("equalColWidth",vN7);this.vO7=vN7;};if(vV6||!(vz6==this.vP7)){vO6.vn6("setColumnSpacing",vz6);this.vP7=vz6;};if(vV6||!(vy6==this.vQ7)){vO6.vn6("setRowSpacing",vy6);this.vQ7=vy6;}}},vR7:function(){var vS7=this.editorModel.getFormulaModel().vS7();if(vS7!=this.vT7){var vO6=js.Boot.vQ2(this.editorModel.getToolbarModel(),com.wiris.e1_v);vO6.vR6("paste",vS7);this.vT7=vS7;}},vU7:function(){var vV7=this.editorModel.getFormulaModel().vV7();if(vV7!=this.vW7){var vO6=js.Boot.vQ2(this.editorModel.getToolbarModel(),com.wiris.e1_v);vO6.vR6("copy",vV7);vO6.vR6("cut",vV7);this.vW7=vV7;}},vM6:function(){var formulaModel=this.editorModel.getFormulaModel();this.vW7=!formulaModel.vV7();this.vT7=!formulaModel.vS7();this.vQ6=!formulaModel.vP6();this.vT6=!formulaModel.vS6();this.vm6=-1;this.vr6="inherit";this.vp6=null;var style=formulaModel.getCurrentStyles();this.vX6=!style.isFlag(com.wiris.e1_61.vW6);this.va6=!style.isFlag(com.wiris.e1_61.vZ6);this.vb6=style.isFlagMask(com.wiris.e1_61.vZ6);this.vd6=style.isFlag(com.wiris.e1_61.vc6);this.ve6=!formulaModel.vY2().styles.isFlag(com.wiris.e1_61.v14);this.vl6=-1;this.vE7=false;this.vF7=false;this.vK7=null;this.vM7=false;this.vO7=false;this.vH7=-1;this.v87=null;this.vP7=null;this.vQ7=null;this.vi6=!style.isFlag(com.wiris.e1_61.vh6);this.vU7();this.vR7();this.vN6();this.vU6(formulaModel.getCurrentStyles(),true);},transformationReceived:function(vV2,vc2){},styleChanged:function(vV2){this.vU6(this.editorModel.getFormulaModel().getCurrentStyles(),false);},contentChanged:function(vV2){this.vN6();},clipboardChanged:function(vV2){this.vR7();},caretPositionChanged:function(vV2){this.vU7();this.vU6(this.editorModel.getFormulaModel().getCurrentStyles(),false);},editorModel:null,vi6:null,vQ7:null,vP7:null,v87:null,vH7:null,vO7:null,vM7:null,vK7:null,vF7:null,vE7:null,vl6:null,vr6:null,vp6:null,vm6:null,ve6:null,va6:null,vT6:null,vQ6:null,vT7:null,vW7:null,vd6:null,vX6:null,vb6:null,v92:null,__class__:com.wiris.e1_7};com.wiris.editor.Validator=v91["com.wiris.editor.Validator"]=function(){};com.wiris.editor.Validator.__name__=["com","wiris","editor","Validator"];com.wiris.editor.Validator.prototype={validate:null,__class__:com.wiris.editor.Validator};com.wiris.editor.WordValidator=v91["com.wiris.editor.WordValidator"]=function(){this.bannedWords=new Array();};com.wiris.editor.WordValidator.__name__=["com","wiris","editor","WordValidator"];com.wiris.editor.WordValidator.__interfaces__=[com.wiris.editor.Validator];com.wiris.editor.WordValidator.prototype={validate:function(box){if(box.vX7()){var vY7=js.Boot.vQ2(box,com.wiris.e1_e);var text=vY7.vZ7();var i=HxOverrides.iter(this.bannedWords);while(i.hasNext())if(text.indexOf(i.next())>=0)return false;return true;};var vD3=box.va7()-1;while(vD3>=0){if(!this.validate(box.getChild(vD3)))return false;--vD3;};return true;},banWord:function(word){this.bannedWords.push(word);},bannedWords:null,__class__:com.wiris.editor.WordValidator};if(!com.wiris.editor.ext)com.wiris.editor.ext={};com.wiris.editor.ext.BlackboardReservedVariablesTemplate=v91["com.wiris.editor.ext.BlackboardReservedVariablesTemplate"]=function(){};com.wiris.editor.ext.BlackboardReservedVariablesTemplate.__name__=["com","wiris","editor","ext","BlackboardReservedVariablesTemplate"];com.wiris.editor.ext.BlackboardReservedVariablesTemplate.vN3=function(parameters){if(!parameters.exists("grammarResource"))parameters.set("grammarResource","grammar_eval_content.txt");if(!parameters.exists("styles"))parameters.set("styles","{'mi[mathvariant=\"normal\"]': {'color': '#0000ff'}, 'mi:length(>1)': {'color': '#0000ff'}}");if(!parameters.exists("forceReservedWords"))parameters.set("forceReservedWords","true");var vb7=parameters.get("reservedWords");if(vb7!=null){var vc7=vb7.split(",");var i=0;while(i<vc7.length){var vd7=StringTools.trim(vc7[i]);if(vd7.length<=1)vc7.splice(i,1);else++i;};parameters.set("reservedWords","sin,cos,tan,asin,acos,atan,csc,sec,cot,log,exp,ln,round,e,"+com.wiris.e1_51.v22(960)+","+vc7.join(","));}};com.wiris.e1_8=v91["com.wiris.e1_8"]=function(){};com.wiris.e1_8.__name__=["com","wiris","e1_8"];com.wiris.e1_8.parse=function(parameters){var eInstructionStyles=parameters.get("eInstructionStyles");if(eInstructionStyles==null)eInstructionStyles=parameters.get("einstructionstyles");if(eInstructionStyles!=null){var styles=parameters.get("styles");var vA3=styles!=null?js.Boot.vQ2(com.wiris.e1_81.decode(styles),HaxeHash):new HaxeHash();var ve7=js.Boot.vQ2(com.wiris.e1_81.decode(eInstructionStyles),HaxeHash);var i=ve7.keys();while(i.hasNext()){var selector=i.next();vA3.set(selector,ve7.get(selector));};if(ve7.exists(".vector")){var style=js.Boot.vQ2(ve7.get(".vector"),HaxeHash);vA3.set("mi.vector",style);vA3.set("mo.vector",style);vA3.set("mn.vector",style);};var vf7=0;var vg7=0;if(ve7.exists(".script")){var style=js.Boot.vQ2(ve7.get(".script"),HaxeHash);var vh7=js.Boot.vQ2(style.get("font-size"),String);if(vh7!=null){vf7=com.wiris.e1_8.round(com.wiris.util.css.CSSUtils.vi7(vh7));style.set("font-size",vf7+"%");};vA3.set(":scriptlevel(1)",style);};if(ve7.exists(".smallScript")){var vj7=js.Boot.vQ2(ve7.get(".smallScript"),HaxeHash);var vk7=new HaxeHash();var vh7=js.Boot.vQ2(vj7.get("font-size"),String);if(vh7!=null){vg7=com.wiris.e1_8.round(100*com.wiris.util.css.CSSUtils.vi7(vh7)/vf7);vj7.set("font-size",vg7+"%");vk7.set("font-size","100%");};vA3.set(":scriptlevel(2)",vj7);vA3.set(":scriptlevel(3)",vk7);};if(ve7.exists(".bigOp")){var vl7=new HaxeHash();vl7.set("font-size","100%");vA3.set(".bigOp :largeop",vl7);vA3.set(".bigOp .bigOp",vl7);};if(ve7.exists(".smallBigOp")){var vm7=js.Boot.vQ2(ve7.get(".smallBigOp"),HaxeHash);var vn7=new HaxeHash();var vo7=new HaxeHash();var vp7=new HaxeHash();var vq7=new HaxeHash();var vh7=js.Boot.vQ2(vm7.get("font-size"),String);if(vh7!=null){var vr7=com.wiris.e1_8.round(100*com.wiris.util.css.CSSUtils.vi7(vh7)/vf7);var vs7=com.wiris.e1_8.round(10000*com.wiris.util.css.CSSUtils.vi7(vh7)/(vf7*vg7));var vt7=vr7;var vu7=vs7;vn7.set("font-size",vr7+"%");vo7.set("font-size",vs7+"%");vp7.set("font-size",vt7+"%");vq7.set("font-size",vu7+"%");};vA3.set(".bigOp:scriptlevel(1)",vm7);vA3.set(".bigOp:scriptlevel(2)",vn7);vA3.set(".bigOp:scriptlevel(>2)",vo7);vA3.set(":scriptlevel(1) .bigOp",vp7);vA3.set(":scriptlevel(2) .bigOp",vq7);};parameters.set("styles",com.wiris.e1_81.encode(vA3));}};com.wiris.e1_8.round=function(x){return Math.round(x);};com.wiris.e1_8.prototype={__class__:com.wiris.e1_8};if(!com.wiris.editor.formula)com.wiris.editor.formula={};com.wiris.editor.formula.WCharacter=v91["com.wiris.editor.formula.WCharacter"]=function(){};com.wiris.editor.formula.WCharacter.__name__=["com","wiris","editor","formula","WCharacter"];com.wiris.editor.formula.WCharacter.vv7=function(c){if(48<=c&&c<=57)return true;if(1632<=c&&c<=1641)return true;if(1776<=c&&c<=1785)return true;return false;};com.wiris.editor.formula.WCharacter.vw7=function(c){return com.wiris.editor.formula.WCharacter.vx7(c)||c==95;};com.wiris.editor.formula.WCharacter.vy7=function(c){return com.wiris.editor.formula.WCharacter.vz7(com.wiris.editor.formula.WCharacter.v08,c);};com.wiris.editor.formula.WCharacter.v18=function(c){return com.wiris.editor.formula.WCharacter.vz7(com.wiris.editor.formula.WCharacter.v28,c);};com.wiris.editor.formula.WCharacter.v38=function(c){return com.wiris.editor.formula.WCharacter.vz7(com.wiris.editor.formula.WCharacter.v48,c);};com.wiris.editor.formula.WCharacter.v58=function(c){return com.wiris.editor.formula.WCharacter.vz7(com.wiris.editor.formula.WCharacter.v68,c);};com.wiris.editor.formula.WCharacter.vz7=function(v,c){var min=0;var max=v.length-1;do{var v78=Math.floor((min+max)/2);var v88=v[v78];if(c==v88)return true;else if(c<v88)max=v78-1;else min=v78+1;}while(min<=max);return false;};com.wiris.editor.formula.WCharacter.v98=function(str){var vA8="";var i=0;while(i<str.length){var c=HxOverrides.cca(str,i);var vD3=0;while(vD3<com.wiris.editor.formula.WCharacter.vB8.length){if(c==com.wiris.editor.formula.WCharacter.vB8[vD3]){c=com.wiris.editor.formula.WCharacter.vB8[vD3+1];break;};vD3+=2;};vA8+=com.wiris.e1_51.v22(c);++i;};return vA8;};com.wiris.editor.formula.WCharacter.vC8=function(c){var i=0;while(i<com.wiris.editor.formula.WCharacter.vD8.length){if(c==com.wiris.editor.formula.WCharacter.vD8[i])return true;++i;};return false;};com.wiris.editor.formula.WCharacter.vE8=function(c){var i=0;while(i<com.wiris.editor.formula.WCharacter.vF8.length){if(com.wiris.editor.formula.WCharacter.vF8[i]==c)return com.wiris.editor.formula.WCharacter.vF8[i+1];i+=2;};return-1;};com.wiris.editor.formula.WCharacter.vG8=function(c){var i=1;while(i<com.wiris.editor.formula.WCharacter.vF8.length){if(com.wiris.editor.formula.WCharacter.vF8[i]==c)return com.wiris.editor.formula.WCharacter.vF8[i-1];i+=2;};return-1;};com.wiris.editor.formula.WCharacter.vx7=function(c){if(com.wiris.editor.formula.WCharacter.vv7(c))return false;if(65<=c&&c<=90)return true;if(97<=c&&c<=122)return true;if(192<=c&&c<=696&&c!=215&&c!=247)return true;if(867<=c&&c<=1521)return true;if(1552<=c&&c<=8188)return true;if(c==8450||c==8461||c==8469||c==8472||c==8473||c==8474||c==8477||c==8484)return true;if(com.wiris.editor.formula.WCharacter.vH8(c))return true;return false;};com.wiris.editor.formula.WCharacter.vI8=function(c){return c>=97&&c<=122||c>=224&&c<=255||c>=591&&c>=659||c>=661&&c<=687||c>=940&&c<=974;};com.wiris.editor.formula.WCharacter.vJ8=function(c){if(com.wiris.editor.formula.WCharacter.vK8(c)||com.wiris.editor.formula.WCharacter.vH8(c)||com.wiris.editor.formula.WCharacter.vL8(c))return true;return false;};com.wiris.editor.formula.WCharacter.vM8=function(s){var i=s.length-1;while(i>=0){if(!com.wiris.editor.formula.WCharacter.vN8(HxOverrides.cca(s,i)))return false;--i;};return true;};com.wiris.editor.formula.WCharacter.vN8=function(c){if(c>=1536&&c<=1791&&!com.wiris.editor.formula.WCharacter.vv7(c))return true;return false;};com.wiris.editor.formula.WCharacter.vL8=function(c){if(c>=1424&&c<=1535)return true;return false;};com.wiris.editor.formula.WCharacter.vH8=function(c){if(c>=13312&&c<=40959)return true;return false;};com.wiris.editor.formula.WCharacter.vO8=function(c){if(c>=945&&c<=969)return true;else if(c>=913&&c<=937&&c!=930)return true;else if(c==977||c==981||c==982)return true;return false;};com.wiris.editor.formula.WCharacter.vK8=function(c){if(c>=2304&&c<2431)return true;return false;};com.wiris.editor.formula.WCharacter.vP8=function(s){var i=s.length-1;while(i>=0){if(!com.wiris.editor.formula.WCharacter.vK8(HxOverrides.cca(s,i)))return false;--i;};return true;};com.wiris.editor.formula.WCharacter.vQ8=function(c){if(com.wiris.editor.formula.WCharacter.vL8(c)||com.wiris.editor.formula.WCharacter.vN8(c))return true;return false;};com.wiris.editor.formula.WCharacter.vR8=function(c){if(97<=c&&c<=122||945<=c&&c<=969)return com.wiris.editor.formula.WCharacter.vz7(com.wiris.editor.formula.WCharacter.vS8,c);return true;};com.wiris.editor.formula.WCharacter.vT8=function(c){if(97<=c&&c<=122||945<=c&&c<=969)return com.wiris.editor.formula.WCharacter.vz7(com.wiris.editor.formula.WCharacter.vU8,c);else if(65<=c&&c<=90)return false;return true;};com.wiris.editor.formula.WCharacter.vV8=function(c){return com.wiris.editor.formula.WCharacter.vz7(com.wiris.editor.formula.WCharacter.vW8,c);};com.wiris.editor.formula.WCharacter.vX8=function(c){return com.wiris.editor.formula.WCharacter.vz7(com.wiris.editor.formula.WCharacter.vY8,c);};com.wiris.editor.formula.WCharacter.vZ8=function(l){var index=-1;if(l<100)index=com.wiris.editor.formula.WCharacter.va8.indexOf("@00"+l+"@");else if(l<1000)index=com.wiris.editor.formula.WCharacter.va8.indexOf("@0"+l+"@");else index=com.wiris.editor.formula.WCharacter.va8.indexOf("@"+l+"@");if(index!=-1){var s=com.wiris.editor.formula.WCharacter.vb8.substring(index+1,index+5);return Std.parseInt(s);};return l;};com.wiris.editor.formula.WCharacter.vc8=function(vd8){var index=-1;if(vd8<100)index=com.wiris.editor.formula.WCharacter.vb8.indexOf("@00"+vd8+"@");else if(vd8<1000)index=com.wiris.editor.formula.WCharacter.vb8.indexOf("@0"+vd8+"@");else index=com.wiris.editor.formula.WCharacter.vb8.indexOf("@"+vd8+"@");if(index!=-1){var s=com.wiris.editor.formula.WCharacter.va8.substring(index+1,index+5);return Std.parseInt(s);};return vd8;};com.wiris.e1_9=v91["com.wiris.e1_9"]=function(){this.rtl=false;};com.wiris.e1_9.__name__=["com","wiris","e1_9"];com.wiris.e1_9.prototype={ve8:function(vd8,vf8){var vg8=vd8.getLength(0.65);var vh8=2;var h=Math.floor(Math.round((14+vf8*vh8)*vd8.getZoom()));var m=[vg8,h,h-vd8.getLength(0.1)];return m;},vi8:function(vd8,x,vQ1,vj8){var vk8=[[1,0.95],[1.0,1.0],[0.27,0.6]];var vl8=[0.09,0.65];if(this.rtl){vk8[0][0]=1.0-vk8[0][0];vk8[1][0]=1.0-vk8[1][0];vk8[2][0]=1.0-vk8[2][0];vl8[0]=1.0-vl8[0];};var m=this.ve8(vd8,31);var vg8=m[0]-1;var h=m[1]-1;var b=m[2];var px=new Array();var vm8=new Array();var i;var ve1=0,vd1=vk8.length;while(ve1<vd1){var vn8=ve1++;px[vn8]=Math.floor(Math.round(vk8[vn8][0]*vg8));vm8[vn8]=Math.floor(Math.round(vk8[vn8][1]*h)-b);};vd8.drawPolyline(x,vQ1,px,vm8,3);var vo8=Math.floor(Math.floor(vd8.getLineWidth()*0.5*0.70711));var vp8=[Math.round(px[1]+vo8),Math.round(px[2]+vo8),js.Boot.vQ2(Math.round(vl8[0]*vg8),Int)];var vq8=[Math.round(vm8[1]-vo8),Math.round(vm8[2]-vo8),js.Boot.vQ2(Math.round(vl8[1]*h)-b,Int)];vd8.drawPolyline(x,vQ1,vp8,vq8,vj8?3:2);},vr8:function(vd8,x,vQ1,size,vj8){var vk8=[[1.0,0.0],[0.52,0.99],[0.19,0.60]];var vl8=[0.09,0.65];if(this.rtl){vk8[0][0]=1.0-vk8[0][0];vk8[1][0]=1.0-vk8[1][0];vk8[2][0]=1.0-vk8[2][0];vl8[0]=1.0-vl8[0];};var m=this.ve8(vd8,size);var vg8=m[0]-1;var h=m[1]-1;var b=m[2];var px=new Array();var vm8=new Array();var i;var ve1=0,vd1=vk8.length;while(ve1<vd1){var vn8=ve1++;px[vn8]=Math.floor(Math.round(vk8[vn8][0]*vg8));vm8[vn8]=Math.floor(Math.round(vk8[vn8][1]*h)-b);};vd8.drawPolyline(x,vQ1,px,vm8,3);var vo8=Math.floor(Math.floor(vd8.getLineWidth()*0.5*0.70711));var vp8=[px[1]+vo8,px[2]+vo8,js.Boot.vQ2(Math.round(vl8[0]*vg8),Int)];var vq8=[vm8[1]-vo8,vm8[2]-vo8,js.Boot.vQ2(Math.round(vl8[1]*h)-b,Int)];vd8.drawPolyline(x,vQ1,vp8,vq8,vj8?3:2);},vs8:function(vd8,c){if(c>=com.wiris.editor.formula.WCharacter.vt8&&c<com.wiris.editor.formula.WCharacter.vu8)return this.ve8(vd8,c-com.wiris.editor.formula.WCharacter.vt8);if(c==com.wiris.editor.formula.WCharacter.vu8)return this.ve8(vd8,c-com.wiris.editor.formula.WCharacter.vt8);if(c>=com.wiris.editor.formula.WCharacter.vv8&&c<com.wiris.editor.formula.WCharacter.vw8)return this.ve8(vd8,c-com.wiris.editor.formula.WCharacter.vv8);if(c==com.wiris.editor.formula.WCharacter.vw8)return this.ve8(vd8,c-com.wiris.editor.formula.WCharacter.vv8);if(c==com.wiris.editor.formula.WCharacter.vx8)return[com.wiris.common.WInteger.max(vd8.getLength(0.1),1),vd8.getLength(0.5),vd8.getLength(0.5)];if(c==com.wiris.editor.formula.WCharacter.vy8)return[1,vd8.getLength(0.5),vd8.getLength(0.5)];if(c==com.wiris.editor.formula.WCharacter.vz8||c==com.wiris.editor.formula.WCharacter.v09)return[vd8.getLength(0.5),vd8.getLength(1.0),vd8.getBaseline("x")];if(this.v19(c,com.wiris.e1_9.v29)!=-1){var s=new com.wiris.e1_J();var v39=vd8.getWidth("x");var v49=vd8.getHeight("x");return[s.v59(vd8,v39,v49,c,com.wiris.e1_J.v69),s.v79(vd8,v39,v49,c,com.wiris.e1_J.v69),vd8.getBaseline("x")];};if(com.wiris.editor.formula.WCharacter.vV8(c))return[0,vd8.getHeight("x"),vd8.getBaseline("x")];var index;if((index=this.v89(c,com.wiris.e1_9.v99))!=-1){var text=com.wiris.e1_51.v22(com.wiris.e1_9.v99[index][1]);return[vd8.getWidth(text),vd8.getHeight(text),vd8.getBaseline(text)];};if((index=this.v89(c,com.wiris.e1_9.vA9))!=-1){var width=0;var size=com.wiris.e1_9.vA9[index][1];if(size>=0)width=vd8.getLength(size/1024.0);else if(c==com.wiris.editor.formula.WCharacter.vB9)width=-vd8.getLength(0.2);else if(c==com.wiris.editor.formula.WCharacter.vC9)width=vd8.getWidth("0");else if(c==com.wiris.editor.formula.WCharacter.vD9)width=vd8.getWidth(".");return[width,vd8.getLength(1.0),vd8.getBaseline("x")];};return null;},vE9:function(vd8,c,x,vQ1,b){var s=js.Boot.vQ2(vd8.getStyle(),com.wiris.e1_61);var rtl=s.isFlag(com.wiris.e1_61.v14);s.vF9(com.wiris.e1_61.v14,false);if(c>=com.wiris.editor.formula.WCharacter.vt8&&c<com.wiris.editor.formula.WCharacter.vu8)this.vr8(vd8,x,vQ1+b,c-com.wiris.editor.formula.WCharacter.vt8,true);if(c==com.wiris.editor.formula.WCharacter.vu8)this.vi8(vd8,x,vQ1+b,true);if(c>=com.wiris.editor.formula.WCharacter.vv8&&c<com.wiris.editor.formula.WCharacter.vw8)this.vr8(vd8,x,vQ1+b,c-com.wiris.editor.formula.WCharacter.vv8,false);if(c==com.wiris.editor.formula.WCharacter.vw8)this.vi8(vd8,x,vQ1+b,false);if(c==com.wiris.editor.formula.WCharacter.vx8)vd8.drawHorizontalLine(0,x,vQ1+b-1,vd8.getWidth(com.wiris.e1_51.v22(c)));if(c==com.wiris.editor.formula.WCharacter.vy8)vd8.drawVerticalLine(0,x,vQ1+b-vd8.getBaseline(com.wiris.e1_51.v22(c)),vd8.getHeight(com.wiris.e1_51.v22(c)));if(this.v19(c,com.wiris.e1_9.v29)!=-1)new com.wiris.e1_J().vG9(vd8,c,x,vQ1,b,vd8.getLength(0.5),vd8.getLength(1.0));var index;if((index=this.v89(c,com.wiris.e1_9.v99))!=-1){var text=com.wiris.e1_51.v22(com.wiris.e1_9.v99[index][1]);vd8.drawText(0,text,x,vQ1,b);};(js.Boot.vQ2(vd8.getStyle(),com.wiris.e1_61)).vF9(com.wiris.e1_61.v14,rtl);},v19:function(v,a){var i;var ve1=0,vd1=a.length;while(ve1<vd1){var vn8=ve1++;if(a[vn8]==v)return vn8;};return-1;},v89:function(c,vH9){var i;var ve1=0,vd1=vH9.length;while(ve1<vd1){var vn8=ve1++;if(vH9[vn8][0]==c)return vn8;};return-1;},canDisplay:function(c,vI9){if(vI9)return c>=com.wiris.editor.formula.WCharacter.vt8&&c<=com.wiris.editor.formula.WCharacter.vy8;if(com.wiris.editor.formula.WCharacter.vV8(c))return true;if(c==57344)return true;if(this.v89(c,com.wiris.e1_9.v99)!=-1)return true;if(this.v89(c,com.wiris.e1_9.vA9)!=-1)return true;return this.v19(c,com.wiris.e1_9.v29)!=-1;},getMetrics:function(vJ9,str){return this.vs8(vJ9,HxOverrides.cca(str,0));},drawText:function(vJ9,id,str,x,vQ1,b){this.vE9(vJ9,HxOverrides.cca(str,0),x,vQ1,b);return 0;},v43:function(rtl){this.rtl=rtl;},rtl:null,__class__:com.wiris.e1_9};com.wiris.e1_A=v91["com.wiris.e1_A"]=function(vK9){this.vK9=vK9;this.vL9=new Array();this.vM9=new Array();this.vN9=new com.wiris.e1_D();this.vN9.vO9(vK9.getFonts());this.s=new com.wiris.e1_61();this.zoom=1;this.vP9=new HaxeHash();this.vQ9("sans-serif","Arial");this.vQ9("sans-serif","Lucida Sans");this.vQ9("sans-serif","Helvetica");this.vQ9("monospace","Courier New");this.vQ9("monospace","FreeMono");this.vQ9("monospace","Courier");this.vQ9("serif","Times New Roman");this.vQ9("serif","FreeSerif");this.vQ9("serif","Times");this.vQ9("Arial","Arial");this.vQ9("Arial","Lucida Sans");this.vQ9("Arial","Helvetica");this.vQ9("Arial","sans-serif");this.vQ9("Courier New","Courier New");this.vQ9("Courier New","FreeMono");this.vQ9("Courier New","Courier");this.vQ9("Courier New","monospace");this.vQ9("Tahoma","Tahoma");this.vQ9("Tahoma","DejaVu LGC Sans");this.vQ9("Tahoma","Geneva");this.vQ9("Tahoma","sans-serif");this.vQ9("Times New Roman","Times New Roman");this.vQ9("Times New Roman","FreeSerif");this.vQ9("Times New Roman","Times");this.vQ9("Times New Roman","serif");this.vQ9("Verdana","Verdana");this.vQ9("Verdana","DejaVu LGC Sans");this.vQ9("Verdana","Geneva");this.vQ9("Verdana","sans-serif");if(com.wiris.e1_A.vR9==null){com.wiris.e1_A.vR9=new HaxeHash();com.wiris.e1_A.vS9=new HaxeHash();com.wiris.e1_A.italicExtraSpace=new HaxeHash();var resourceLoader=new com.wiris.system.ResourceLoader();var vT9=resourceLoader.loadResource("font_adjust.xml");if(vT9!=null)this.vU9(vT9,vK9);}};com.wiris.e1_A.__name__=["com","wiris","e1_A"];com.wiris.e1_A.__interfaces__=[com.wiris.editor.GraphicsContext];com.wiris.e1_A.prototype={getDefaultStyles:function(){return this.styles;},setFormat:function(vV9){this.styles=vV9;},drawPolyline:function(vW9,vX9,px,vm8,length){if(this.s.isFlag(com.wiris.e1_61.v14)){var vY9=vW9;var vZ9=vW9;var i=0;while(i<length){if(px[i]<vY9)vY9=px[i];if(px[i]>vZ9)vZ9=px[i];++i;};var width=vZ9-vY9;vW9=this.vL9[this.vL9.length-1]-vW9-width;i=0;while(i<length){px[i]=this.vL9[this.vL9.length-1]-px[i]-width;++i;}};this.vK9.drawPolyline(vW9,vX9,px,vm8,length);},va9:function(){var n=this.vN9.vb9(this.vK9,this.s,"x",true);var i;var vc9=this.vN9.vd9(0);if(this.vP9.exists(vc9))vc9=this.vP9.get(vc9);return vc9;},getItalicExtraSpace:function(){var vc9=this.va9();var ve9=com.wiris.e1_A.italicExtraSpace.get(vc9.toLowerCase());if(ve9!=null)return Std.parseFloat(ve9);return 0.05;},getXHeight:function(){var vc9=this.va9();var vf9=com.wiris.e1_A.vS9.get(vc9.toLowerCase());if(vf9!=null)return Std.parseFloat(vf9);return 0.4;},getZoom:function(){return this.zoom;},fillRect:function(x,vQ1,width,height){if(this.s.isFlag(com.wiris.e1_61.v14))x=this.vL9[this.vL9.length-1]-x-width;this.vK9.fillRect(x,vQ1,width,height);},drawArc:function(x,vQ1,width,height,vg9,vh9){if(this.s.isFlag(com.wiris.e1_61.v14)){x=this.vL9[this.vL9.length-1]-x-width;vg9=180-vg9-vh9;};this.vK9.drawArc(x,vQ1,width,height,vg9,vh9);},getLineWidth:function(){return this.vK9.getLineWidth();},setStyle:function(s){var c=com.wiris.e1_61.vi9(s,this.s);this.s=s;this.vK9.setStyle(s,c);if(c.isFlagMask(com.wiris.e1_61.vj9))this.zoom=c.getZoom();},setLineWidth:function(vg8){var vk9=com.wiris.e1_61.vO3(this.s);vk9.setLineWidth(vg8);this.setStyle(vk9);},setColor:function(c){var vk9=com.wiris.e1_61.vO3(this.s);vk9.setColor(c);this.setStyle(vk9);},setBracketsSmaller:function(b){this.vN9.setBracketsSmaller(b);},vl9:function(i,n){var k;k=0;i++;while(i<n){k+=this.vN9.vm9(i).length;i++;};return k;},vn9:function(n){var i;var vo9=new Array();var vp9=0;var vd1=0;while(vd1<n){var vn8=vd1++;vo9.push(vp9);var sub=this.vN9.vm9(vn8);var vc9=this.vN9.vd9(vn8);vp9+=this.vs8(vc9,sub)[0];};return vo9;},vq9:function(vr9,vs9){if(vs9)return!vr9&&(this.s.isFlag(com.wiris.e1_61.vh6)||this.s.isFlag(com.wiris.e1_61.vc6));return vr9&&(!this.s.isFlag(com.wiris.e1_61.vZ6)||this.s.isFlag(com.wiris.e1_61.vc6));},getWidths:function(str,vt9){var vu9=new Array();var vv9=this.s.isFlag(com.wiris.e1_61.v14);var vw9=this.vN9.vb9(this.vK9,this.s,str,!vv9);var vx9=null;var sub;if(vv9){vx9=this.vn9(vw9);sub=this.vN9.vm9(vw9-1);}else sub=this.vN9.vm9(0);var vy9=0;var vz9=vt9&&this.vq9(vv9,com.wiris.e1_D.vQ8(sub,!vv9));var width;if(vz9==vv9)width=0;else if(vv9)width=this.vs8(this.vN9.vd9(vw9-1),sub)[0];else width=this.vs8(this.vN9.vd9(0),sub)[0];if(vv9)width+=vx9[vw9-1];vu9.push(width);var i=0;while(i<vw9){var v0A=0;var v1A;var v2A=null;var v3A=null;if(vv9){v1A=vw9-i-1;v0A=vx9[v1A];if(v1A>0){v2A=this.vN9.vm9(v1A-1);v3A=this.vN9.vd9(v1A-1);}}else{v1A=i;if(v1A<vw9-1){v2A=this.vN9.vm9(v1A+1);v3A=this.vN9.vd9(v1A+1);}};var vc9=this.vN9.vd9(v1A);sub=this.vN9.vm9(v1A);var v4A=sub.length;var v5A=this.vs8(vc9,sub)[0];var v6A=com.wiris.e1_D.vQ8(sub,!vv9);var vD3=0;while(vD3<v4A){if((vD3!=v4A-1||vt9)&&this.vq9(vv9,v6A)){var v7A;if(vv9)v7A=HxOverrides.substr(sub,0,vD3+1);else v7A=HxOverrides.substr(sub,vD3+1,v4A-vD3-1);width=this.vs8(vc9,v7A)[0];}else if(vt9&&vD3==v4A-1&&v2A!=null&&this.vq9(vv9,com.wiris.e1_D.vQ8(v2A,!vv9))){if(vv9)width=-this.vs8(v3A,v2A)[0];else width=v5A+this.vs8(v3A,v2A)[0];}else{var v7A;if(vv9)v7A=HxOverrides.substr(sub,vD3+1,v4A-vD3-1);else v7A=HxOverrides.substr(sub,0,vD3+1);width=this.vs8(vc9,v7A)[0];};if(vv9)vu9.push(v0A+width);else vu9.push(vy9+width);++vD3;};vy9+=v5A;++i;};return vu9;},getWidth:function(str){return this.getMetrics(str)[0];},getStyle:function(){return this.s;},getLength:function(x){return Math.floor(Math.round(this.getHeight("x")*x));},getMiddle:function(){return this.getLength(0.3);},getHeight:function(str){return this.getMetrics(str)[1];},getColor:function(){return this.s.getColor();},getBaseline:function(str){return this.getMetrics(str)[2];},endTranslate:function(x,vQ1,width,height){this.vM9.pop();this.vL9.pop();this.vK9.endTranslate(x,vQ1,width,height);},drawLine:function(v8A,v9A,vAA,vBA){if(this.s.isFlag(com.wiris.e1_61.v14)){var vCA=this.vL9[this.vL9.length-1];v8A=vCA-v8A-1;vAA=vCA-vAA-1;};this.vK9.drawLine(v8A,v9A,vAA,vBA);},drawVerticalLineWithType:function(id,x,vQ1,h,type){if(this.s.isFlag(com.wiris.e1_61.v14))x=this.vL9[this.vL9.length-1]-x-1;this.vK9.drawVerticalLineWithType(id,x,vQ1,h,type);},drawHorizontalLineWithType:function(id,x,vQ1,vg8,type){if(this.s.isFlag(com.wiris.e1_61.v14))x=this.vL9[this.vL9.length-1]-x-vg8;this.vK9.drawHorizontalLineWithType(id,x,vQ1,vg8,type);},drawVerticalLine:function(id,x,vQ1,h){if(this.s.isFlag(com.wiris.e1_61.v14))x=this.vL9[this.vL9.length-1]-x-1;this.vK9.drawVerticalLine(id,x,vQ1,h);},drawHorizontalLine:function(id,x,vQ1,vg8){if(this.s.isFlag(com.wiris.e1_61.v14))x=this.vL9[this.vL9.length-1]-x-vg8;this.vK9.drawHorizontalLine(id,x,vQ1,vg8);},vDA:function(vEA,vFA){if(vFA!=null){vEA[0]+=Math.floor((vFA[0]+vFA[2])*this.s.getFontSize());vEA[1]+=Math.floor((vFA[1]+vFA[3])*this.s.getFontSize());vEA[2]+=Math.floor(vFA[1]*this.s.getFontSize());};return vEA;},vs8:function(vc9,str){if(this.s.isFlag(com.wiris.e1_61.vZ6)&&com.wiris.editor.formula.WCharacter.vM8(str)){var vGA=this.s;var vk9=com.wiris.e1_61.vO3(this.s);vk9.vF9(com.wiris.e1_61.vZ6,false);this.setStyle(vk9);var m=this.vs8(vc9,str);this.setStyle(vGA);return m;};if(vc9!=null&&this.vP9.exists(vc9))vc9=this.vP9.get(vc9);if(vc9!=null&&(vc9=="drawFont"||vc9=="rootFont")){var vHA=new com.wiris.e1_9();return vHA.getMetrics(this,str);};var vEA=this.vK9.getMetrics(vc9,str);var vIA=[vEA[0],vEA[1],vEA[2]];var vJA=com.wiris.e1_A.vR9.get(vc9.toLowerCase());if(vJA!=null){vIA=this.vDA(vIA,vJA.get(str));vIA=this.vDA(vIA,vJA.get("all"));};return vIA;},getMetrics:function(t){var m=null;var vKA=null;var n=this.vN9.vb9(this.vK9,this.s,t,!this.s.isFlag(com.wiris.e1_61.v14));var i;var vd1=0;while(vd1<n){var vn8=vd1++;var sub=this.vN9.vm9(vn8);var vc9=this.vN9.vd9(vn8);vKA=this.vs8(vc9,sub);m=com.wiris.e1_D.vLA(m,vKA);};return m;},vMA:function(position,vFA){if(vFA!=null)position[0]+=Math.floor(vFA[0]*this.s.getFontSize());return position;},vNA:function(id,vc9,str,x,vQ1,b){if(vc9!=null&&(vc9=="drawFont"||vc9=="rootFont")){var vHA=new com.wiris.e1_9();vHA.v43(this.s.isFlag(com.wiris.e1_61.v14));vHA.drawText(this,id,str,x,vQ1,b);}else if(vc9!=null&&vc9=="negationFont"){var vOA=com.wiris.editor.formula.WCharacter.vG8(HxOverrides.cca(str,0));var vPA=com.wiris.e1_51.v22(vOA);this.vK9.drawText(id,"math1",vPA,x,vQ1,b);var vEA=this.getMetrics(vPA);var vQA=Math.floor(4*vEA[0]/10);var vRA=Math.floor(vEA[2]/6);if(this.s.isFlag(com.wiris.e1_61.v14))this.vK9.drawLine(x+vQA,vQ1+vRA,x+vEA[0]-vQA,vQ1+vEA[2]+vRA);else this.vK9.drawLine(x+vEA[0]-vQA,vQ1+vRA,x+vQA,vQ1+vEA[2]+vRA);}else{if(this.vP9.exists(vc9))vc9=this.vP9.get(vc9);var position=[x,vQ1,b];var vJA=com.wiris.e1_A.vR9.get(vc9.toLowerCase());if(vJA!=null){position=this.vMA(position,vJA.get(str));position=this.vMA(position,vJA.get("all"));};this.vK9.drawText(id,vc9,str,position[0],position[1],position[2]);}},drawText2:function(id,t,x,vQ1,b){if(this.s.isFlag(com.wiris.e1_61.vZ6)&&com.wiris.editor.formula.WCharacter.vM8(t)){var vGA=this.s;var vk9=com.wiris.e1_61.vO3(this.s);vk9.vF9(com.wiris.e1_61.vZ6,false);this.setStyle(vk9);this.drawText2(id,t,x,vQ1,b);this.setStyle(vGA);return;};var rtl=false;if(this.s.isFlag(com.wiris.e1_61.v14)){rtl=true;x=this.vL9[this.vL9.length-1]-x;};var n=this.vN9.vb9(this.vK9,this.s,t,!rtl);var i;var vSA=new Array();var vTA=new Array();var vu9=new Array();i=0;while(i<n){var sub=this.vN9.vm9(i);var vc9=this.vN9.vd9(i);var width=this.vs8(vc9,sub)[0];vSA.push(sub);vTA.push(vc9);vu9.push(width);if(rtl)x-=width;++i;};var vd1=0;while(vd1<n){var vn8=vd1++;this.vNA(id,vTA[vn8],vSA[vn8],x,vQ1,b);x+=vu9[vn8];}},drawText:function(id,t,x,vQ1,b){this.drawText2(id,t,x,vQ1,b);},beginTranslate:function(x,vQ1,width,height){this.vK9.beginTranslate(x,vQ1,width,height);this.vL9.push(width);this.vM9.push(this.s.isFlag(com.wiris.e1_61.v14)?1:0);},vQ9:function(fontFamily,vUA){if(this.vP9.exists(fontFamily))return;if(this.vK9.fontExists(vUA))this.vP9.set(fontFamily,vUA);},vVA:function(vt1,vWA,vXA){if(vWA!=null){var vt3=vWA.split(",");if(vt3.length!=4)throw"Unknown dimensions format \""+vWA+"\".";if(vXA){vt1[0]=vt1[0]+Std.parseFloat(StringTools.trim(vt3[0]));vt1[1]=vt1[1]+Std.parseFloat(StringTools.trim(vt3[1]));vt1[2]=vt1[2]+Std.parseFloat(StringTools.trim(vt3[2]));vt1[3]=vt1[3]+Std.parseFloat(StringTools.trim(vt3[3]));}else{vt1[4]=Std.parseFloat(StringTools.trim(vt3[0]));vt1[5]=Std.parseFloat(StringTools.trim(vt3[1]));vt1[6]=Std.parseFloat(StringTools.trim(vt3[2]));vt1[7]=Std.parseFloat(StringTools.trim(vt3[3]));}}},vYA:function(vJ1,node,vJA){var vZA=true;var selector=com.wiris.util.xml.WXmlUtils.getAttribute(node,"selector");if(selector!=null)vZA=this.vK9.selects(selector);if(vZA){var vt1=vJA.get(vJ1);if(vt1==null){vt1=new Array();var k=0;while(k<8){vt1[k]=0.0;++k;};vJA.set(vJ1,vt1);};var margin=com.wiris.util.xml.WXmlUtils.getAttribute(node,"margin");this.vVA(vt1,margin,true);var fitbox=com.wiris.util.xml.WXmlUtils.getAttribute(node,"fitbox");this.vVA(vt1,fitbox,false);}},vU9:function(vaA,vK9){var i=HxOverrides.iter(com.wiris.util.xml.WXmlUtils.getElements(com.wiris.util.xml.WXmlUtils.vG2(vaA).firstChild()));while(i.hasNext()){var vbA=i.next();var vc9=com.wiris.util.xml.WXmlUtils.getAttribute(vbA,"name");if(vc9==null)throw"Attribute \"name\" is missing on font node.";var vJA=new HaxeHash();com.wiris.e1_A.vR9.set(vc9.toLowerCase(),vJA);var vD3=HxOverrides.iter(com.wiris.util.xml.WXmlUtils.getElements(vbA));while(vD3.hasNext()){var node=vD3.next();if(node.getNodeName()=="glyph"){var vcA=com.wiris.util.xml.WXmlUtils.getAttribute(node,"char");if(vcA!=null){if(vcA.length!=1)throw"Attribute \"char\" with value \""+vcA+"\" must contain one and only one character.";this.vYA(vcA,node,vJA);}else{var vdA=com.wiris.util.xml.WXmlUtils.getAttribute(node,"code");if(vdA!=null){if(vdA=="*")this.vYA("all",node,vJA);else{var charCode=Std.parseInt(vdA);if(charCode<0)throw"Unknown char code "+charCode+".";this.vYA(com.wiris.e1_51.v22(charCode),node,vJA);}}else{var veA=com.wiris.util.xml.WXmlUtils.getAttribute(node,"from");var vfA=com.wiris.util.xml.WXmlUtils.getAttribute(node,"to");if(veA==null||vfA==null)throw"Expected attribute \"char\", \"code\" or \"from\" and \"to\" is missing on a glyph node.";var from=Std.parseInt(veA);if(from<0)throw"Unknown char code "+from+".";var to=Std.parseInt(vfA);if(to<0)throw"Unknown char code "+to+".";while(from<=to){this.vYA(com.wiris.e1_51.v22(from),node,vJA);++from;}}}}else if(node.getNodeName()=="property"){var name=com.wiris.util.xml.WXmlUtils.getAttribute(node,"name");if(name==null)throw"Expected attribute \"name\" is missing on a property node.";var value=com.wiris.util.xml.WXmlUtils.getAttribute(node,"value");if(value==null)throw"Expected attribute \"value\" is missing on a property node.";var vZA=true;var selector=com.wiris.util.xml.WXmlUtils.getAttribute(node,"selector");if(selector!=null)vZA=vK9.selects(selector);if(vZA){if(name=="xHeight")com.wiris.e1_A.vS9.set(vc9.toLowerCase(),value);else if(name=="italicExtraSpace")com.wiris.e1_A.italicExtraSpace.set(vc9.toLowerCase(),value);}}else throw"Unknown node \""+node.getNodeName()+"\".";}}},styles:null,vM9:null,vL9:null,vP9:null,zoom:null,s:null,vN9:null,vK9:null,__class__:com.wiris.e1_A};com.wiris.e1_B=v91["com.wiris.e1_B"]=function(){};com.wiris.e1_B.__name__=["com","wiris","e1_B"];com.wiris.e1_B.prototype={vgA:null,vhA:null,viA:null,getDesiredDefaultStyles:null,setDefaultStyles:null,getDefaultStyles:null,vjA:null,__class__:com.wiris.e1_B};com.wiris.e1_C=v91["com.wiris.e1_C"]=function(editor,box){this.editor=editor;this.vkA=box;this.vlA=false;this.vmA=null;};com.wiris.e1_C.__name__=["com","wiris","e1_C"];com.wiris.e1_C.__interfaces__=[com.wiris.editor.EditorBoxInterface];com.wiris.e1_C.prototype={isMultiLine:function(){if(!this.vlA){if(this.vkA.vnA()){var i=this.vkA.va7()-1;this.voA=false;while(i>=0&&!this.vlA){var vpA=this.vkA.getChild(i);if(vpA.vX7()){var vqA=js.Boot.vQ2(vpA,com.wiris.e1_e);if(vqA.vrA())this.voA=true;};--i;}}else if(this.getParent()!=null)this.voA=this.getParent().isMultiLine();this.vlA=true;};return this.voA;},vY2:function(){return this.vkA;},setAttributes:function(p){var h=com.wiris.system.PropertiesTools.v17(p);this.editor.setAttributes(this,h);},getParent:function(){var p=this.vkA.getParent();if(p==null)return null;return new com.wiris.e1_C(this.editor,p);},getTagName:function(){if(this.vmA==null)this.vmA=com.wiris.editor.formula.box.BoxUtils.vsA(this.vkA,this.editor.getDefaultStylesProvider());return this.vmA;},getAttributes:function(){return com.wiris.system.PropertiesTools.vtA(com.wiris.editor.formula.box.BoxUtils.getAttributes(this.vkA,this.editor.getDefaultStylesProvider()));},getChild:function(i){return new com.wiris.e1_C(this.editor,this.vkA.getChild(i));},getLength:function(){return this.vkA.va7();},vmA:null,vlA:null,voA:null,vkA:null,editor:null,__class__:com.wiris.e1_C};com.wiris.e1_D=v91["com.wiris.e1_D"]=function(){this.vTA=new Array();this.vuA=new Array();this.vvA=new Array();};com.wiris.e1_D.__name__=["com","wiris","e1_D"];com.wiris.e1_D.vLA=function(m,vwA){if(m==null){m=new Array();m[0]=vwA[0];m[1]=vwA[1];m[2]=vwA[2];return m;};m[0]+=vwA[0];var b=com.wiris.common.WInteger.max(m[2],vwA[2]);var u=com.wiris.common.WInteger.max(m[1]-m[2],vwA[1]-vwA[2]);m[1]=b+u;m[2]=b;return m;};com.wiris.e1_D.vQ8=function(text,vxA){var n=text.length;var i;var vd1=0;while(vd1<n){var vn8=vd1++;var c=HxOverrides.cca(text,vn8);if(com.wiris.editor.formula.WCharacter.vQ8(c)||!com.wiris.editor.formula.WCharacter.vw7(c)&&!com.wiris.editor.formula.WCharacter.vv7(c)&&!vxA)return true;};return false;};com.wiris.e1_D.prototype={vd9:function(i){return this.vuA[i];},vm9:function(i){return this.vvA[i];},reverse:function(ar,n){var i;var m=n>>1;var vd1=0;while(vd1<m){var vn8=vd1++;var s=ar[vn8];var d=ar[n-vn8-1];ar[vn8]=d;ar[n-vn8-1]=s;}},vyA:function(font,s,pos){if(pos>=this.vuA.length){this.vuA.push(font);this.vvA.push(s);}else{this.vuA[pos]=font;this.vvA[pos]=s;}},vb9:function(vK9,s,str,vzA){var n;var v0B;var m;n=str.length;if(n==0){this.vyA(this.v1B(vK9,s,120,vzA),"",0);return 1;};var i=0;v0B=0;var v2B=null;var v3B=true;m=0;if(!vzA)str=com.wiris.editor.formula.WCharacter.v98(str);var v4B=0;var vd1=0;while(vd1<n){var vn8=vd1++;var c=HxOverrides.cca(str,vn8);var v5B=this.v1B(vK9,s,c,vzA);var v6B=com.wiris.editor.formula.WCharacter.vQ8(c);var v7B=true;if(vn8==0){v2B=v5B;v3B=v6B;}else if(v5B!=null&&v2B!=null)v7B=v5B==v2B&&v3B==v6B;else v7B=v5B==v2B&&v3B==v6B;if(!v7B){var v8B=HxOverrides.substr(str,v0B,vn8-v0B);this.vyA(v2B,v8B,m);v2B=v5B;v3B=v6B;v0B=vn8;m++;};v4B=c;};var v9B=HxOverrides.substr(str,v0B,n-v0B);this.vyA(v2B,v9B,m);m++;if(!vzA){this.reverse(this.vuA,m);this.reverse(this.vvA,m);};return m;},vO9:function(vAB){var i;var ve1=0,vd1=vAB.length;while(ve1<vd1){var vn8=ve1++;this.vTA.push(vAB[vn8]);if(vAB[vn8]=="brackets")this.vBB="brackets";if(vAB[vn8]=="brack_sm")this.vCB="brack_sm";if(vAB[vn8]=="Brackets full size")this.vBB="Brackets full size";if(vAB[vn8]=="Brackets small size")this.vCB="Brackets small size";}},setBracketsSmaller:function(b){this.vDB=b;},vEB:function(vK9,c){var vFB=this.vCB!=null?vK9.canDisplay(this.vCB,c):false;var vGB=this.vBB!=null?vK9.canDisplay(this.vBB,c):false;if(vFB&&(this.vDB||!vGB))return this.vCB;if(vGB)return this.vBB;return null;},v1B:function(vK9,s,c,vzA){var vHB=this.vEB(vK9,c);if(vHB!=null)return vHB;var i;var n;n=this.vTA.length;var vd1=0;while(vd1<n){var vn8=vd1++;var vc9=this.vTA[vn8];if(vc9=="drawFont"){var vHA=new com.wiris.e1_9();if(vHA.canDisplay(c,false))return vc9;}else if(vc9=="rootFont"){var vHA=new com.wiris.e1_9();if(vHA.canDisplay(c,true))return vc9;}else if(vc9=="negationFont"){var vOA=com.wiris.editor.formula.WCharacter.vG8(c);if(vOA!=-1&&vK9.canDisplay("math1",vOA))return vc9;}else if(vc9=="math1_rtl"){if(!vzA&&vK9.canDisplay("math1_rtl",c))return vc9;}else if(vK9.canDisplay(vc9,c))return vc9;};return s.getFontFamily();},vvA:null,vuA:null,vDB:null,vCB:null,vBB:null,vTA:null,__class__:com.wiris.e1_D};com.wiris.editor.formula.FormulaModel=v91["com.wiris.editor.formula.FormulaModel"]=function(){var s;s=new com.wiris.e1_H(this);s.setMode(com.wiris.e1_H.vIB);new com.wiris.e1_U().vJB(s);new com.wiris.e1_e().vJB(s);new com.wiris.e1_g().vJB(s);new com.wiris.e1_h().vJB(s);new com.wiris.e1_Z().vJB(s);new com.wiris.e1_c().vJB(s);new com.wiris.e1_R().vJB(s);new com.wiris.e1_W().vJB(s);new com.wiris.e1_i().vJB(s);new com.wiris.e1_O().vJB(s);new com.wiris.e1_S().vJB(s);new com.wiris.e1_a().vJB(s);new com.wiris.e1_T().vJB(s);new com.wiris.e1_d().vJB(s);new com.wiris.e1_b().vJB(s);var vKB="";vKB+=com.wiris.e1_51.v22(1580);vKB+=com.wiris.e1_51.v22(1575);vKB+=",";vKB+=com.wiris.e1_51.v22(1580);vKB+=com.wiris.e1_51.v22(1578);vKB+=com.wiris.e1_51.v22(1575);vKB+=",";vKB+=com.wiris.e1_51.v22(1592);vKB+=com.wiris.e1_51.v22(1575);this.v03("sin,cos,tan,log,ln,"+vKB);this.vLB=null;this.mode=com.wiris.editor.formula.FormulaModel.vs2;this.display=com.wiris.editor.formula.FormulaModel.vu2;this.setEmptyBoxColor(com.wiris.editor.formula.FormulaModel.vMB);this.setEmptyScriptBoxColor(com.wiris.editor.formula.FormulaModel.vNB);this.readOnly=false;this.vOB=null;this.forceReservedWords=false;this.vPB=false;this.reservedWordsColor="#0000ff";this.vj6=com.wiris.editor.formula.FormulaModel.v83;this.vQB=com.wiris.editor.formula.FormulaModel.vRB;this.allowInnerNewLines=false;this.vSB=false;this.vTB=true;this.vUB=false;this.vVB=new com.wiris.e1_I();this.vWB=new HaxeHash();this.vXB=new com.wiris.e1_61();this.vXB.vYB(100);this.vZB=new com.wiris.e1_61();this.vZB.vYB(100);this.vZB.setFontSize(16);this.vZB.setLineWidth(1);this.vZB.vaB(1.0);this.vZB.setColor(0);this.vZB.setFontFamily("Arial");this.vZB.vF9(com.wiris.e1_61.vZ6,false);this.vZB.vF9(com.wiris.e1_61.vW6,false);this.vZB.vF9(com.wiris.e1_61.vc6,false);this.vZB.vF9(com.wiris.e1_61.vh6,false);this.vZB.vF9(com.wiris.e1_61.vbB,false);this.vZB.vF9(com.wiris.e1_61.vcB,true);this.vZB.vF9(com.wiris.e1_61.vdB,false);this.vZB.veB(com.wiris.e1_61.v84);this.vZB.vF9(com.wiris.e1_61.vfB,true);this.vZB.setClassType("");this.vgB=0;this.reset();};com.wiris.editor.formula.FormulaModel.__name__=["com","wiris","editor","formula","FormulaModel"];com.wiris.editor.formula.FormulaModel.__interfaces__=[com.wiris.e1_B];com.wiris.editor.formula.FormulaModel.prototype={vgA:function(){return this.vUB;},vM3:function(vUB){this.vUB=vUB;},replaceChild:function(parent,position,vhB){this.vs3();this.viB(parent.getChild(position));parent.replace(position,vhB);this.viA(vhB);this.vv3();this.vjB();this.vkB();},vL3:function(enabled){this.vTB=enabled;},removeAccents:function(){var vlB=this.deleteSelection();if(vlB!=null){vlB=this.vmB(vlB.vnB());this.voB(vlB,true,null,com.wiris.editor.formula.FormulaModel.vpB);}},vmB:function(box){var i;var ve1=0,vd1=box.va7();while(ve1<vd1){var vn8=ve1++;var vpA=box.getChild(vn8);var vUA=this.vmB(box.getChild(vn8));if(vpA!=vUA)box.replace(vpA.v07,vUA);};if(box.vqB()){var vrB=js.Boot.vQ2(box,com.wiris.e1_i);if((vrB.type==com.wiris.e1_i.vsB||vrB.type==com.wiris.e1_i.vtB)&&vrB.getChild(0).getChild(0)!=null){var vuB=vrB.getChild(0).getChild(0);if(vuB.vX7()){var vvB=js.Boot.vQ2(vuB,com.wiris.e1_e);if(vvB.vwB(this)!=null&&vvB.vwB(this).accent){var content=box.getChild(1);content.styles=com.wiris.e1_61.join(box.styles,content.styles);return box.getChild(1);}}}};return box;},vxB:function(root){if(root!=null){root.styles=this.vjA(root);var i;var ve1=0,vd1=root.va7();while(ve1<vd1){var vn8=ve1++;this.vxB(root.getChild(vn8));}}},setAttributes:function(vyB,h){var vzB=new com.wiris.e1_H(this);vzB.setAttributes(h);vzB.setMode(com.wiris.e1_H.v0C);vzB.v1C(vyB);vyB.v2C();this.vjB();},vhA:function(vJ1,v3C,vJ9){var value=this.vWB.get(vJ1);if(value!=null&&com.wiris.common.WInteger.v42(value))return Std.parseInt(value);var k=com.wiris.editor.formula.Styles.v4C(vJ9,value,v3C);if(vJ1!=null&&(vJ1=="fraction-linethickness"||vJ1=="fraction-linethickness-small")){if(value!=null&&value.indexOf("px")>=0)k=js.Boot.vQ2(Math.round(k/vJ9.getZoom()),Int);};return k;},vK3:function(v5C){this.vA3=v5C;this.vm3();this.viA(this.box);this.v6C();this.vjB();},vG3:function(vWB){this.vWB=vWB;this.vm3();this.v6C();},v93:function(v7C){this.allowInnerNewLines=v7C;},v8C:function(str){if(this.vSB){var v9C="";var i;var ve1=0,vd1=str.length;while(ve1<vd1){var vn8=ve1++;v9C=v9C+com.wiris.e1_51.v22(com.wiris.editor.formula.WCharacter.vZ8(HxOverrides.cca(str,vn8)));};str=v9C;v9C=null;};return str;},vAC:function(str){if(this.vj6==com.wiris.editor.formula.FormulaModel.v83)return str;var i=0;while(i<=9){if(this.vj6==com.wiris.editor.formula.FormulaModel.v63)str=StringTools.replace(str,""+i,com.wiris.e1_51.v22(1632+i));else if(this.vj6==com.wiris.editor.formula.FormulaModel.v73)str=StringTools.replace(str,""+i,com.wiris.e1_51.v22(1776+i));++i;};return str;},vk6:function(){return this.vj6;},v53:function(mode,vV6){if(this.vj6==mode&&!vV6)this.vj6=com.wiris.editor.formula.FormulaModel.v83;else this.vj6=mode;this.v6C();},v03:function(vBC){this.reservedWords=vBC.split(",");var i=0;while(i<this.reservedWords.length){var word=StringTools.trim(this.reservedWords[i]);if(word.length==0)this.reservedWords.splice(i,1);else{this.reservedWords[i]=word;++i;}};var vCC=false;while(!vCC){vCC=true;i=1;while(i<this.reservedWords.length){var a=this.reservedWords[i-1];var b=this.reservedWords[i];if(a.length>b.length){vCC=false;this.reservedWords[i-1]=b;this.reservedWords[i]=a;};++i;}};i=1;while(i<this.reservedWords.length){var a=this.reservedWords[i];var b=this.reservedWords[i-1];if(a==b)this.reservedWords.splice(i,1);else++i;};this.v13(this.forceReservedWords);this.v23(this.vPB);this.v6C();this.vjB();if(this.box!=null){this.vm3();this.viA(this.box);}},v33:function(color){this.reservedWordsColor=color;},v23:function(enabled){this.vPB=enabled;if(enabled){var vDC=new com.wiris.e1_V(this,this.reservedWords,this.allowInnerNewLines);vDC.vPB(this.vY2(),true);}},v13:function(enabled){this.forceReservedWords=enabled;if(enabled){var vDC=new com.wiris.e1_V(this,this.reservedWords,this.allowInnerNewLines);vDC.forceReservedWords(this.vY2(),true);}},vk3:function(){this.vEC=new Array();},vFC:function(){var vGC=this.vZ2().vHC(this);var vIC=new com.wiris.e1_h();vIC.vJC(this.vY2().styles,true,false);vIC.vKC(vGC);return vIC;},getSelectionMathML:function(){if(this.vLC==0)return null;var vIC=this.vFC();var xml=this.vMC(vIC);var vb2=com.wiris.util.xml.WXmlUtils.vb3(xml);return vb2;},getLength:function(){return com.wiris.editor.formula.box.BoxUtils.vNC(this.box);},vn2:function(readOnly){this.readOnly=readOnly;},vOC:function(){return this.display;},getErrorRectangles:function(){if(this.vPC!=null){var va3=this.vPC.vQC(false);var i=HxOverrides.iter(va3);while(i.hasNext()){var vd3=i.next();if(vd3.width<4){vd3.x-=2;vd3.width=4;}};return va3;};return null;},vRC:function(){if(this.vPC!=null){this.vPC=null;this.vkB();}},vSC:function(vTC,vUC){this.vPC=this.vVC(vTC,vUC-vTC);this.vkB();},setEmptyScriptBoxColor:function(vWC){this.vWC=vWC;},getEmptyScriptBoxColor:function(){return this.vWC;},setEmptyBoxColor:function(vXC){this.vXC=vXC;},getEmptyBoxColor:function(){return this.vXC;},setMode:function(mode){this.mode=mode;},setDisplay:function(display){this.display=display;this.box.vYC();this.viA(this.box);},vZC:function(){this.vaC();var vDC=new com.wiris.e1_V(this,this.reservedWords,this.allowInnerNewLines);var top=this.vY2();var box;box=vDC.vbC(top,this.vcC());if(box==null)box=top;var b=this.vjA(box);this.vdC=com.wiris.e1_61.join(b,this.veC);},getCurrentActualStyles:function(){this.vZC();return this.vdC;},vaC:function(){if(this.veC!=null)return;var vDC=new com.wiris.e1_V(this,this.reservedWords,this.allowInnerNewLines);this.veC=vDC.vfC(this.vY2(),this.vcC()).vgC();this.vdC=null;},vhC:function(styles){var viC=this.getCurrentStyles();var vjC=com.wiris.e1_61.join(viC,styles);this.veC=vjC;this.vkB();this.veC=vjC;},vcC:function(){var c;if(this.vLC>0)c=this.vV3+this.vLC;else c=this.vV3;return c;},getCurrentStyles:function(){this.vaC();return this.veC;},getDesiredDefaultStyles:function(){return this.vZB;},setDefaultStyles:function(styles){this.vXB=com.wiris.e1_61.vO3(styles);this.vm3();this.viA(this.box);this.v6C();this.vjB();},getDefaultStyles:function(){return this.vXB;},isRecalcNeeded:function(){return!this.box.vkC;},vlC:function(){if(this.isRecalcNeeded())throw"Formula needs recalc.";},reset:function(){this.vmC(new com.wiris.e1_g());this.vjB();},vnC:function(){this.vV3=0;this.vLC=0;this.voC=0;this.vpC=new Array();this.vEC=new Array();this.vqC=com.wiris.editor.formula.UndoState.UNDO_NORMAL;this.vrC=0;this.vdC=null;this.veC=null;},vsC:function(maction,vQA,vRA,vtC){if(this.readOnly)return false;var vuC=com.wiris.e1_W.vvC(this.box,this.vV3);if(vuC==null)return false;this.vs3();try{var vwC=js.Boot.vQ2(vuC[0],com.wiris.e1_W);this.viB(vwC);var v37=js.Boot.vQ2(vuC[1],Int);var v47=js.Boot.vQ2(vuC[2],Int);v47+=vQA;v37+=vRA;if(maction=="insertRow"){var b=vwC.vxC(1,vwC.vyC,this);var s=vwC.vzC(v37,0);this.v0D(s);this.v1D(b,com.wiris.editor.formula.FormulaModel.vpB,0);};if(maction=="insertColumn"){var b=vwC.vxC(vwC.v2D,1,this);var s=vwC.v3D(v47,0);this.v0D(s);this.v1D(b,com.wiris.editor.formula.FormulaModel.vpB,0);};if(maction=="removeRow"){var s=vwC.vzC(v37,1);this.v0D(s);this.deleteSelection();};if(maction=="removeColumn"){var s=vwC.v3D(v47,1);this.v0D(s);this.deleteSelection();};if(maction=="addFrame")vwC.v4D(-1);if(maction=="removeFrame")vwC.v5D();if(maction=="addFrameTop")vwC.v4D(0);if(maction=="addFrameBottom")vwC.v4D(2);if(maction=="addFrameLeft")vwC.v4D(3);if(maction=="addFrameRight")vwC.v4D(1);if(maction=="addLineBelow")vwC.addLineBelow(v37);if(maction=="removeLineBelow")vwC.removeLineBelow(v37);if(maction=="addLineRight")vwC.addLineRight(v47);if(maction=="removeLineRight")vwC.removeLineRight(v47);if(maction=="columnLeftAlign")vwC.v6D(v47,com.wiris.editor.formula.Styles.vB7);if(maction=="columnRightAlign")vwC.v6D(v47,com.wiris.editor.formula.Styles.vC7);if(maction=="columnCenterAlign")vwC.v6D(v47,com.wiris.editor.formula.Styles.vC4);if(maction=="columnDecimalAlign")vwC.v6D(v47,com.wiris.editor.formula.Styles.v7D);if(maction=="columnRelationAlign")vwC.v6D(v47,com.wiris.editor.formula.Styles.v8D);if(maction=="rowTopAlign")vwC.v9D(v37,com.wiris.editor.formula.Styles.vA4);if(maction=="rowBottomAlign")vwC.v9D(v37,com.wiris.editor.formula.Styles.vB4);if(maction=="rowCenterAlign")vwC.v9D(v37,com.wiris.editor.formula.Styles.vC4);if(maction=="rowAxisAlign")vwC.v9D(v37,com.wiris.editor.formula.Styles.vD4);if(maction=="rowBaselineAlign")vwC.v9D(v37,com.wiris.editor.formula.Styles.vE4);if(maction=="equalColWidth")vwC.vAD();if(maction=="equalRowHeight")vwC.vBD();if(maction=="matrixSolidLine"){vwC.vCD();this.v6C();};if(maction=="matrixThickLine"){vwC.vDD();this.v6C();};if(maction=="matrixDashLine"){vwC.vED();this.v6C();};if(maction=="matrixDotLine"){vwC.vFD();this.v6C();};if(v37>=vwC.v2D)v37--;if(v47>=vwC.vyC)v47--;if(vtC){var a=vwC.vGD(v37,v47);var vHD=com.wiris.e1_Q.vID(a,1);this.setCaret(vHD.vJD(),0);}}catch(e){};this.vv3();this.vjB();return true;},vr3:function(vu3,vKD){if(this.readOnly)return;var vuC=com.wiris.e1_W.vvC(this.box,this.vV3);if(vuC==null)return;this.vs3();var vwC=js.Boot.vQ2(vuC[0],com.wiris.e1_W);this.viB(vwC);if(vu3){var v47=js.Boot.vQ2(vuC[2],Int);if(this.box.styles.isFlag(com.wiris.e1_61.v14))--v47;vwC.setColumnSpacing(v47,vKD);}else{var v37=js.Boot.vQ2(vuC[1],Int);vwC.setRowSpacing(v37,vKD);};this.vv3();this.vjB();this.vkB();},removeLineRight:function(){if(this.box.styles.isFlag(com.wiris.e1_61.v14))return this.vsC("removeLineRight",-1,0,false);return this.vsC("removeLineRight",0,0,false);},addLineRight:function(){if(this.box.styles.isFlag(com.wiris.e1_61.v14))return this.vsC("addLineRight",-1,0,false);return this.vsC("addLineRight",0,0,false);},removeLineBelow:function(){return this.vsC("removeLineBelow",0,0,false);},addLineBelow:function(){return this.vsC("addLineBelow",0,0,false);},removeFrame:function(){return this.vsC("removeFrame",0,0,false);},addFrame:function(i){if(i==0)return this.vsC("addFrameTop",0,0,false);if(i==1)return this.vsC("addFrameRight",0,0,false);if(i==2)return this.vsC("addFrameBottom",0,0,false);if(i==3)return this.vsC("addFrameLeft",0,0,false);return this.vsC("addFrame",0,0,false);},removeColumn:function(){return this.vsC("removeColumn",0,0,true);},removeRow:function(){return this.vsC("removeRow",0,0,true);},appendColumn:function(){if(this.box.styles.isFlag(com.wiris.e1_61.v14))return this.vsC("insertColumn",0,0,true);return this.vsC("insertColumn",1,0,true);},prependColumn:function(){if(this.box.styles.isFlag(com.wiris.e1_61.v14))return this.vsC("insertColumn",1,0,true);return this.vsC("insertColumn",0,0,true);},appendRow:function(){return this.vsC("insertRow",0,1,true);},prependRow:function(){return this.vsC("insertRow",0,0,true);},testGetPathsOfBoxes:function(){var a=this.vLD();var i;var ve1=0,vd1=a.length;while(ve1<vd1){var vn8=ve1++;haxe.Log.trace(a[vn8].vmA,{fileName:"FormulaModel.hx",lineNumber:2312,className:"com.wiris.editor.formula.FormulaModel",methodName:"testGetPathsOfBoxes"});}},vLD:function(){return com.wiris.editor.formula.box.BoxUtils.vLD(this.vMD(),this);},vV7:function(){return this.vLC!=0;},vS7:function(){return this.vOB!=null;},vP6:function(){return this.vEC.length>0;},vS6:function(){return this.vpC.length>0;},setStyle:function(b,vk9){if(this.readOnly)return;this.vs3();try{this.viB(this.box);b.vJC(vk9,true,true);this.viA(b);this.vjB();this.veC=null;this.vdC=null;}catch(e){};this.vv3();this.v6C();},vND:function(vk9){this.setStyle(this.box,vk9);},vF9:function(vOD){if(this.vLC!=0){var vT1=this.getCurrentStyles().isFlag(vOD);var b=new com.wiris.e1_61();b.vF9(vOD,!vT1);this.vQ3(b);this.vhC(b);}else{var vT1=this.getCurrentStyles().isFlag(vOD);var b=new com.wiris.e1_61();b.vF9(vOD,!vT1);this.vhC(b);}},vz3:function(){this.vF9(com.wiris.e1_61.vh6);},vy3:function(){if(this.getCurrentStyles().isFlagMask(com.wiris.e1_61.vZ6))this.vF9(com.wiris.e1_61.vPD);else{this.getCurrentStyles().vF9(com.wiris.e1_61.vZ6,true);this.vF9(com.wiris.e1_61.vZ6);}},clearStyles:function(){if(this.vLC!=0){this.vs3();var vlB=this.vQD(true).vnB();if(vlB!=null){this.vRD(vlB);this.voB(vlB,false,this.vZB,com.wiris.editor.formula.FormulaModel.vSD);};this.vv3();}},vW3:function(b){this.vSB=b;},vTD:function(){return this.vSB;},turnToGreek:function(){if(this.vLC!=0){var b=new com.wiris.e1_61();this.vUD(b,"greek");}},turnToLatin:function(){if(this.vLC!=0){var b=new com.wiris.e1_61();this.vUD(b,"latin");}},matrixDotLine:function(){return this.vsC("matrixDotLine",0,0,false);},matrixDashLine:function(){return this.vsC("matrixDashLine",0,0,false);},matrixThickLine:function(){return this.vsC("matrixThickLine",0,0,false);},matrixSolidLine:function(){return this.vsC("matrixSolidLine",0,0,false);},v94:function(vVD){var vk9=com.wiris.e1_61.vO3(this.veC);var s=this.vZ2();var b=s.vY2();var parent=b;while(parent!=null&&!js.Boot.__instanceof(parent,com.wiris.e1_g))parent=parent.getParent();if(parent!=null)this.setStyle(parent,vk9);if(vVD==com.wiris.editor.formula.Styles.vA4)this.vsC("rowTopAlign",0,0,false);else if(vVD==com.wiris.editor.formula.Styles.vB4)this.vsC("rowBottomAlign",0,0,false);else if(vVD==com.wiris.editor.formula.Styles.vC4)this.vsC("rowCenterAlign",0,0,false);else if(vVD==com.wiris.editor.formula.Styles.vD4)this.vsC("rowAxisAlign",0,0,false);else if(vVD==com.wiris.editor.formula.Styles.vE4)this.vsC("rowBaselineAlign",0,0,false);},v24:function(i){var vt6=false;if(i==com.wiris.e1_61.v34)vt6=this.vsC("columnLeftAlign",0,0,false);else if(i==com.wiris.e1_61.v44)vt6=this.vsC("columnRightAlign",0,0,false);else if(i==com.wiris.e1_61.v54)vt6=this.vsC("columnCenterAlign",0,0,false);else if(i==com.wiris.e1_61.v64)vt6=this.vsC("columnDecimalAlign",0,0,false);else if(i==com.wiris.e1_61.v74)vt6=this.vsC("columnRelationAlign",0,0,false);if(vt6){var vWD=this.vZ2().vY2();while(!js.Boot.__instanceof(vWD,com.wiris.e1_W))vWD=vWD.getParent();vWD.vYC();};var vk9=new com.wiris.e1_61();vk9.veB(i);var parent=this.vZ2().vY2();while(parent!=null&&!parent.vnA())parent=parent.getParent();if(parent!=null){var vXD=js.Boot.vQ2(parent,com.wiris.e1_g);if(vXD.isMultiLine())this.setStyle(parent,vk9);}},equalRowHeight:function(){var vk9=com.wiris.e1_61.vO3(this.veC);var s=this.vZ2();var b=s.vY2();var parent=b;while(parent!=null&&!js.Boot.__instanceof(parent,com.wiris.e1_g))parent=parent.getParent();if(parent!=null)this.setStyle(parent,vk9);this.vsC("equalRowHeight",0,0,false);},equalColWidth:function(){var vk9=com.wiris.e1_61.vO3(this.veC);var s=this.vZ2();var b=s.vY2();var parent=b;while(parent!=null&&!js.Boot.__instanceof(parent,com.wiris.e1_g))parent=parent.getParent();if(parent!=null)this.setStyle(parent,vk9);this.vsC("equalColWidth",0,0,false);},setMatrixLineColor:function(str){if(this.readOnly)return;var vuC;vuC=com.wiris.e1_W.vvC(this.box,this.vV3);if(vuC!=null){this.vs3();var vwC=js.Boot.vQ2(vuC[0],com.wiris.e1_W);this.viB(vwC);vwC.vYD(str);this.vv3();this.vjB();}},setClassType:function(str){var b=new com.wiris.e1_61();if(this.vLC!=0){b.setClassType(str);this.vQ3(b);this.vhC(b);}else{b.setClassType(str);this.vhC(b);}},setFontFamily:function(str){var vk9=new com.wiris.e1_61();if(str.toLowerCase()=="inherit")vk9.vF9(com.wiris.e1_61.vZD,false);else vk9.setFontFamily(str);if(this.vTB)this.vND(vk9);else{this.vQ3(vk9);this.vhC(vk9);}},setMaxWidth:function(str){var vk9=new com.wiris.e1_61();vk9.setMaxWidth(str);this.vND(vk9);},setColor:function(str){if(this.vLC!=0){var b=new com.wiris.e1_61();b.setColor(com.wiris.util.css.CSSUtils.vaD(str));this.vQ3(b);this.vhC(b);}else{var b=new com.wiris.e1_61();b.setColor(com.wiris.util.css.CSSUtils.vaD(str));this.vhC(b);}},setFontSize:function(i){var vk9=new com.wiris.e1_61();if(i<0)vk9.vF9(com.wiris.e1_61.vbD,false);else vk9.setFontSize(i);if(this.vTB)this.vND(vk9);else{this.vQ3(vk9);this.vhC(vk9);}},v43:function(rtl){var vk9=new com.wiris.e1_61();vk9.vF9(com.wiris.e1_61.v14,rtl);this.vND(vk9);},v04:function(){this.vF9(com.wiris.e1_61.vc6);},vx3:function(){this.vF9(com.wiris.e1_61.vZ6);},vw3:function(){this.vF9(com.wiris.e1_61.vW6);},isEmpty:function(){return com.wiris.editor.formula.box.BoxUtils.vNC(this.box)==1;},vm3:function(){com.wiris.editor.formula.box.BoxUtils.vm3(this.box);},handleKeyEvent:function(keyCode,shiftKey,ctrlKey,altKey){var vZ3=true;if(keyCode==90&&ctrlKey&&!altKey)this.undo();else if(keyCode==89&&ctrlKey&&!altKey)this.redo();else if(keyCode==67&&ctrlKey&&!altKey)this.copy();else if(keyCode==86&&ctrlKey&&!altKey)this.paste();else if(keyCode==88&&ctrlKey&&!altKey)this.cut();else if(keyCode==39){if(this.vY2().styles.isFlag(com.wiris.e1_61.v14))this.vtC(-1,shiftKey);else this.vtC(1,shiftKey);}else if(keyCode==37){if(this.vY2().styles.isFlag(com.wiris.e1_61.v14))this.vtC(1,shiftKey);else this.vtC(-1,shiftKey);}else if(keyCode==38)this.vcD(true,shiftKey);else if(keyCode==40)this.vcD(false,shiftKey);else if(keyCode==8)this["delete"](-1);else if(keyCode==127)this["delete"](1);else if(keyCode==36)this.vdD(shiftKey);else if(keyCode==35)this.veD(shiftKey);else if(keyCode==10){var s=new StringBuf();s.b+=String.fromCharCode(keyCode);this.insertText(s.b);}else vZ3=false;if(keyCode>=35&&keyCode<=40)this.vSB=false;return vZ3;},vi3:function(){return this.styleChanged;},vg3:function(){return this.clipboardChanged;},vf3:function(){return this.caretPositionChanged;},vh3:function(){return this.contentChanged;},vj3:function(){this.contentChanged=false;this.caretPositionChanged=false;this.clipboardChanged=false;this.styleChanged=false;},v6C:function(){this.styleChanged=true;},vfD:function(){this.clipboardChanged=true;},vjB:function(){this.contentChanged=true;this.vPC=null;},vkB:function(){this.caretPositionChanged=true;this.veC=null;this.vdC=null;},vgD:function(style){this.vs3();try{this.vhD(style);}catch(e){};this.vv3();},vUD:function(style,s){this.vs3();try{this.viD(style,s);}catch(e){};this.vv3();},vQ3:function(style){this.vs3();try{this.vjD(null,com.wiris.editor.formula.FormulaModel.vSD,0,null,style);}catch(e){};this.vv3();},vv3:function(){--this.vgB;},vs3:function(){if(this.vgB==0)this.vkD();++this.vgB;},vlD:function(selector,currentStyle){var vmD=this.vA3.get(selector);if(vmD==null)return currentStyle;return com.wiris.e1_61.join(currentStyle,vmD);},vnD:function(voD,prefix,currentStyle){var i=HxOverrides.iter(voD);while(i.hasNext())currentStyle=this.vlD(prefix+i.next(),currentStyle);return currentStyle;},vjA:function(b){var parent=b.getParent();var tag=com.wiris.editor.formula.box.BoxUtils.vsA(b,this);var vpD=false;var s=this.vXB.vgC();if(parent!=null){var vqD=com.wiris.editor.formula.box.BoxUtils.vsA(parent,this);if(vqD=="mrow"){var vrD=parent.getParent();if(vrD!=null&&com.wiris.editor.formula.box.BoxUtils.vsA(vrD,this)=="p"){s.vF9(com.wiris.e1_61.vc6,true);return s;}}};if(tag=="mrow"&&b.va7()==0){vpD=true;if(this.mode!=com.wiris.editor.formula.FormulaModel.vr2)s.setColor(this.getEmptyBoxColor());};if(tag=="mi"){var vsD=js.Boot.vQ2(b,com.wiris.e1_e);s.vF9(com.wiris.e1_61.vZ6,vsD.vtD()<=1);if(this.forceReservedWords){var vDC=new com.wiris.e1_V(this,this.reservedWords,this.allowInnerNewLines);if(vDC.vuD(vsD.vZ7()))s.setParam("color",this.reservedWordsColor);};s.vF9(com.wiris.e1_61.vW6,false);};if(tag=="mtext"){s.vF9(com.wiris.e1_61.vc6,true);var vk9=null;if(this.vA3!=null)vk9=this.vA3.get("mtext");if(vk9!=null)s.vvD(vk9);};if(tag=="mn"){var vk9=null;if(this.vA3!=null)vk9=this.vA3.get("mn");if(vk9!=null)s.vvD(vk9);};if(tag=="mo"){var vk9=null;if(this.vA3!=null)vk9=this.vA3.get("mo");if(vk9!=null)s.vvD(vk9);var vY7=js.Boot.vQ2(b,com.wiris.e1_e);if(vY7.type==com.wiris.e1_e.vwD&&vY7.vxD(this)){var text=vY7.vZ7();var size=text!=null&&text.length>0&&com.wiris.editor.formula.WCharacter.v18(HxOverrides.cca(text,0))?200:150;s.vYB(size);}};if(tag=="mphantom")s.vF9(com.wiris.e1_61.vbB,true);if(tag=="maction"){var vyD=js.Boot.vQ2(b,com.wiris.e1_O);if(vyD.vzD())s.setColor(this.vQB);};if(parent==null)s.vF9(com.wiris.e1_61.vcB,this.display==com.wiris.editor.formula.FormulaModel.vu2);else{if(parent.vD7!=null)s.vF9(com.wiris.e1_61.vcB,parent.vD7.isFlag(com.wiris.e1_61.vcB));var script=false;tag=com.wiris.editor.formula.box.BoxUtils.vsA(parent,this);if(tag=="sub"||tag=="sup"||tag=="subsup"||tag=="presub"||tag=="presup"||tag=="presubsup")script=true;if(tag=="munder")script=b.v07==1;if(tag=="mover")script=b.v07==0;if(tag=="munderover")script=b.v07==0||b.v07==2;if(tag=="mroot")script=b.v07==0;if(tag=="mfrac"){s.vF9(com.wiris.e1_61.vcB,false);if(parent.vD7!=null&&!parent.vD7.isFlag(com.wiris.e1_61.vcB))script=true;};if(script)s.v0E(1);if(vpD&&script){if(this.mode!=com.wiris.editor.formula.FormulaModel.vr2)s.setColor(this.getEmptyScriptBoxColor());else{var color=s.getColor();var v1E=(color&16711680)>>16;var v2E=(color&65280)>>8;var v3E=color&255;v1E=Math.floor(v1E*0.7);v2E=Math.floor(v2E*0.7);v3E=Math.floor(v3E*0.7);color=(v1E<<16)+(v2E<<8)+v3E;s.setColor(color);}}};var v4E=s.getScriptLevel();var v5E=v4E;if(parent!=null&&parent.vD7!=null){v5E+=parent.vD7.getScriptLevel();s.v0E(v5E);};if(v4E==1){var v6E=1;if(v5E==1)v6E=0.75;else if(v5E==2)v6E=0.625/0.75;else if(v5E==3)v6E=0.8;s.vYB(s.getP()*v6E);};if(this.vA3!=null){var voD=b.styles.getClassType().split(" ");var v7E=false;var vxD=false;var i=0;while(i<voD.length){var className=StringTools.trim(voD[i]);voD[i]=className;s=this.vlD("."+className,s);if(className=="bigOp")v7E=true;++i;};if(b.vX7()){var text=js.Boot.vQ2(b,com.wiris.e1_e);vxD=text.vxD(this);if(text.type==com.wiris.e1_e.v8E){s=this.vlD("mi",s);s=this.vnD(voD,"mi.",s);if(text.vtD()==1&&com.wiris.editor.formula.WCharacter.vO8(HxOverrides.cca(text.vZ7(),0)))s=this.vlD("mi:greek",s);if(s.isFlag(com.wiris.e1_61.vZ6)&&text.styles.isFlagMask(com.wiris.e1_61.vZ6)&&!text.styles.isFlag(com.wiris.e1_61.vZ6))s=this.vlD("mi[mathvariant=\"normal\"]",s);if(text.vtD()>1)s=this.vlD("mi:length(>1)",s);}else if(text.type==com.wiris.e1_e.vwD){s=this.vlD("mo",s);s=this.vnD(voD,"mo.",s);}else if(text.type==com.wiris.e1_e.v9E){s=this.vlD("mn",s);s=this.vnD(voD,"mn.",s);}else if(text.type==com.wiris.e1_e.vAE)s=this.vlD("mtext",s);};if(v4E==1){s=this.vlD(":scriptlevel("+v5E+")",s);if(v7E){var vD3=0;while(vD3<v5E){s=this.vlD(".bigOp:scriptlevel(>"+vD3+")",s);++vD3;};s=this.vlD(".bigOp:scriptlevel("+v5E+")",s);}}else if(v4E==0&&v5E>0&&v7E){var vD3=1;while(vD3<=v5E){s=this.vlD(":scriptlevel("+vD3+") .bigOp",s);++vD3;}};if(vxD||v7E){var vBE=parent;var apply=false;while(vBE!=null&&!apply){var vCE=vBE.styles.getClassType().split(" ");var vD3=0;while(vD3<vCE.length){var className=StringTools.trim(vCE[vD3]);if(className=="bigOp")apply=true;++vD3;};vBE=vBE.getParent();};if(apply){if(vxD)s=this.vlD(".bigOp :largeop",s);if(v7E)s=this.vlD(".bigOp .bigOp",s);}}};return s;},pasteMathML:function(vb2){var xml=com.wiris.util.xml.WXmlUtils.vG2(vb2);var box=this.vDE(xml);this.v1D(box,com.wiris.editor.formula.FormulaModel.vEE,0);},insertMathML:function(vb2,v52){this.vFE(com.wiris.util.xml.WXmlUtils.vG2(vb2),v52);},vFE:function(xml,v52){var box=this.vDE(xml);this.v1D(box,com.wiris.editor.formula.FormulaModel.vpB,v52);},insertText:function(text){var vGE=text.length;var i;var vd1=0;while(vd1<vGE){var vn8=vd1++;this.vHE(com.wiris.e1_51.v22(HxOverrides.cca(text,vn8)));}},vHE:function(character){if(character==" ")character=com.wiris.e1_51.v22(160);character=this.vAC(character);character=this.v8C(character);var vY7=new com.wiris.e1_e();vY7.vIE(character);com.wiris.editor.formula.box.BoxUtils.vJE(vY7,this);if(com.wiris.e1_G.vKE(character))vY7.vLE("false");this.v1D(vY7,com.wiris.editor.formula.FormulaModel.vpB,1);},vo2:function(xml){var b=this.vDE(xml);this.vmC(b);if(this.vPB){var vDC=new com.wiris.e1_V(this,this.reservedWords,this.allowInnerNewLines);vDC.vPB(this.box,true);};if(this.forceReservedWords){var vDC=new com.wiris.e1_V(this,this.reservedWords,this.allowInnerNewLines);vDC.forceReservedWords(this.box,true);};this.viA(b);this.veD(false);},vc3:function(){return this.vMC(this.vY2());},vDE:function(xml){var s=new com.wiris.e1_H(this);s.vME(this);s.setMode(com.wiris.e1_H.vNE);xml=this.vVB.standardToFormula(xml);var b=s.vOE(xml);return b;},vMC:function(b){var s=new com.wiris.e1_H(this);s.vME(this);s.setMode(com.wiris.e1_H.vPE);var vQE=this.display==com.wiris.editor.formula.FormulaModel.vu2;if(b.getParent()!=null)vQE=b.getParent().vD7.isFlag(com.wiris.e1_61.vcB);var xml=s.vRE(b);xml=this.vVB.formulaToStandard(xml,vQE);return xml;},vcD:function(vSE,shift){this.vlC();var p=com.wiris.editor.formula.box.BoxUtils.vcD(this.box,this.vV3,vSE,false);if(p>=0){if(shift){var v8A=this.vV3+this.vLC;this.setCaret(p,v8A-p);}else this.setCaret(p,0);}},getPositionFromPoint:function(x,vQ1){this.vlC();var p=com.wiris.editor.formula.box.BoxUtils.getPositionFromPoint(this.box,false,com.wiris.e1_5.vK6(x,vQ1));return p;},vTE:function(x,vQ1){this.vlC();var p=com.wiris.editor.formula.box.BoxUtils.getPositionFromPoint(this.box,false,com.wiris.e1_5.vK6(x,vQ1));this.setCaret(p,0);},'delete':function(x){if(this.vLC!=0)this.deleteSelection();else{var vX3=this.vV3;this.vtC(x,true);if(vX3==this.vV3)return;this.setCaret(this.vV3+this.vLC,-this.vLC);var selection=this.vZ2();if(selection.vUE()-selection.vVE()!=1)return;this.deleteSelection();}},veD:function(shift){var vWE=com.wiris.editor.formula.box.BoxUtils.vNC(this.box)-1;while(vWE>=0&&!this.vVC(vWE,0).vXE())--vWE;if(vWE>=0){if(shift)this.setCaret(vWE,this.vV3+this.vLC-vWE);else this.setCaret(vWE,0);}},vdD:function(shift){var position=0;var n=com.wiris.editor.formula.box.BoxUtils.vNC(this.box);while(position<n&&!this.vVC(position,0).vXE())++position;if(position<n){if(shift)this.setCaret(position,this.vV3+this.vLC-position);else this.setCaret(position,0);}},cut:function(){this.copy();this.deleteSelection();},paste:function(){if(this.vOB!=null)this.pasteMathML(this.vOB);},copy:function(){if(this.vLC==0)return;this.vOB=this.getSelectionMathML();this.vfD();},redo:function(){if(this.vEC.length==0)return;var vYE=this.vEC.pop();this.vqC=com.wiris.editor.formula.UndoState.UNDO_REDO;this.vs3();try{vYE.vZE(this);}catch(e){};this.vv3();this.vqC=com.wiris.editor.formula.UndoState.UNDO_NORMAL;},undo:function(){if(this.vpC.length==0)return;var vYE=this.vpC.pop();this.vqC=com.wiris.editor.formula.UndoState.UNDO_UNDO;this.vs3();try{vYE.vZE(this);}catch(e){};this.vv3();this.vqC=com.wiris.editor.formula.UndoState.UNDO_NORMAL;},vaE:function(){if(this.vqC==com.wiris.editor.formula.UndoState.UNDO_NORMAL)this.vEC=new Array();if(this.vqC==com.wiris.editor.formula.UndoState.UNDO_UNDO)return this.vEC;return this.vpC;},vkD:function(){this.vrC=this.vaE().length;},viB:function(target){this.vbE(com.wiris.e1_K.vcE(target.vnB()));},vdE:function(i,vD3,mode,b){this.vbE(com.wiris.e1_K.veE(i,vD3,mode,b));},vfE:function(i,vD3,mode){this.vbE(com.wiris.e1_K.vgE(i,vD3,mode));},vbE:function(vYE){var vhE=this.vaE();if(vhE.length>this.vrC){var last=vhE.pop();this.vbE(com.wiris.e1_K.viE(last,vYE));}else this.vaE().push(vYE);},vQD:function(vjE){if(this.readOnly)return null;var s;var b;s=this.vZ2();var box=s.vY2();b=s.vHC(this);if(s.vVE()==s.vUE())return null;if(!s.deleteSelection(vjE))return null;var vkE=s.vVE();var vlE=s.vUE();new com.wiris.e1_V(this,this.reservedWords,this.allowInnerNewLines).vmE(this.vY2(),vkE,vlE,com.wiris.editor.formula.FormulaModel.vnE);this.setCaret(vkE,vlE-vkE);this.vdE(vkE,vlE,s.voE(),b);if(this.vPB){if(box.vX7())box=box.getParent();var vDC=new com.wiris.e1_V(this,this.reservedWords,this.allowInnerNewLines);vDC.vPB(box,false);};if(this.forceReservedWords){var vDC=new com.wiris.e1_V(this,this.reservedWords,this.allowInnerNewLines);vDC.forceReservedWords(box,false);};this.viA(box);this.vjB();return b;},deleteSelection:function(){this.vs3();var b=null;try{b=this.vQD(false);if(b!=null){var s=this.vZ2();var vkE=s.vVE();var vlE=s.vUE();if(!s.vpE())this.setCaret(vkE,0);else if(vlE-vkE==0&&!s.vXE()){this.setCaret(vkE,0);this.vtC(1,false);}else this.setCaret(vkE,vlE-vkE);}}catch(e){};this.vv3();return b;},voB:function(box,vqE,styles,vrE){if(this.readOnly)return;var vDC;var s;var vsE,vtE,vuE;vDC=new com.wiris.e1_V(this,this.reservedWords,this.allowInnerNewLines);s=this.vZ2();vsE=s.vVE();var vvE=box.vnB();s=vDC.v1D(s,this.vY2(),vvE,styles,vrE);if(s==null)return;vtE=s.vVE();vuE=s.vUE();vDC.vmE(this.vY2(),vtE,vuE,vrE);if(this.vPB)vDC.vPB(s.vY2(),false);if(this.forceReservedWords)vDC.forceReservedWords(s.vY2(),false);this.viA(s.vY2());if(vrE!=com.wiris.editor.formula.FormulaModel.vSD&&!s.vpE()){if(vqE)this.setCaret(vuE,0);else this.setCaret(vtE,0);}else if(vqE)this.setCaret(vuE,vtE-vuE);else this.setCaret(vtE,vuE-vtE);var b=vDC.vwE();if(b!=null)this.vdE(vtE,vtE,s.voE(),b);this.vfE(vtE,vuE,s.voE());this.vjB();},vRD:function(box){box.styles=com.wiris.e1_61.vO3(this.vZB);var i=0;while(i<box.va7()){this.vRD(box.getChild(i));++i;}},vhD:function(vxE){var vlB=null;var vqE;vqE=this.vLC<=0;vlB=this.vQD(true);var vvE=vlB.vnB();vvE.styles=this.vjA(vvE);this.vxB(vvE);if(vlB!=null)this.voB(vvE,vqE,vxE,com.wiris.editor.formula.FormulaModel.vSD);},viD:function(vxE,s){var vlB=null;var vqE;vqE=this.vLC<0;vlB=this.vQD(true);var vvE=vlB.vnB();var k;var ve1=0,vd1=vvE.va7();while(ve1<vd1){var vyE=ve1++;if(vvE.getChild(vyE).vX7()){var text=js.Boot.vQ2(vvE.getChild(vyE),com.wiris.e1_e);var t=text.vZ7();var vzE="";var i;if(s=="latin"){var v0F=0,v1F=t.length;while(v0F<v1F){var vn8=v0F++;vzE=vzE+com.wiris.e1_51.v22(com.wiris.editor.formula.WCharacter.vc8(HxOverrides.cca(t,vn8)));};t=vzE;vzE=null;}else if(s=="greek"){var v0F=0,v1F=t.length;while(v0F<v1F){var vn8=v0F++;vzE=vzE+com.wiris.e1_51.v22(com.wiris.editor.formula.WCharacter.vZ8(HxOverrides.cca(t,vn8)));};t=vzE;vzE=null;};text.vIE(t);}};if(vlB!=null)this.voB(vvE,vqE,vxE,com.wiris.editor.formula.FormulaModel.vSD);},vjD:function(box,vrE,v52,styles,vxE){var vlB=null;var vqE;if(vrE==com.wiris.editor.formula.FormulaModel.vSD)vqE=this.vLC<0;else vqE=v52<=0;vlB=this.vQD(true);if(box!=null)this.voB(box,vqE,styles,vrE);if(v52>0)this.vtC(v52,false);if(vlB!=null&&(vrE==com.wiris.editor.formula.FormulaModel.vSD||vrE==com.wiris.editor.formula.FormulaModel.vpB&&com.wiris.editor.formula.box.BoxUtils.vNC(box)>=1))this.voB(vlB,vqE,vxE,vrE);},v1D:function(box,vrE,v52){this.vs3();try{this.vjD(box,vrE,v52,this.getCurrentStyles(),null);}catch(e){};this.vv3();},getSelectionRectangles:function(){var va3=null;if(this.vLC!=0){var s;s=this.vZ2();this.vlC();va3=s.vQC(false);};return va3;},getInverseCaretRectangle:function(){var v2F=this.v3F(this.vV3,true);if(v2F==null)return this.v3F(0,true);return v2F;},getCaretRectangle:function(){var v2F=this.v3F(this.vV3,false);if(v2F==null)return this.v3F(0,false);return v2F;},v3F:function(n,vt9){var s;s=this.vVC(n,0);this.vlC();var r=s.vQC(vt9)[0];if(r.width>1)r=com.wiris.e1_6.vL6(r.x+js.Boot.vQ2(Math.round(r.width/2.0),Int),r.vQ1,1,r.height);return r;},v0D:function(s){var vW9=s.vVE();this.v4F(vW9,s.vUE()-vW9,s.voE());},vZ2:function(){var s=this.vVC(this.vV3,this.vLC);s.setMode(this.voC);return s;},vVC:function(v5F,length){if(length>0)return com.wiris.editor.formula.box.BoxUtils.select(this.box,v5F,length);else return com.wiris.editor.formula.box.BoxUtils.select(this.box,v5F+length,-length);},vMD:function(){if(this.vLC!=0)return null;var vHD=com.wiris.editor.formula.box.BoxUtils.v6F(this.vY2(),this.vV3);return vHD.b;},selectWord:function(position){var vHD=com.wiris.editor.formula.box.BoxUtils.v6F(this.vY2(),position);var vs6=vHD.b;},vXE:function(vW9,selection){var vHD=com.wiris.editor.formula.box.BoxUtils.v6F(this.box,vW9);return vHD.b.v7F(vHD.x,selection);},v8F:function(pos,v9F,vo8,selection){pos=com.wiris.common.WInteger.min(com.wiris.common.WInteger.max(pos,0),v9F-1);var vAF=false;while(!this.vXE(pos,selection)){pos+=vo8;if(pos<0||pos>=v9F){if(vAF){pos=this.vV3;break;}else{vo8=-vo8;pos=this.vV3+pos;pos=com.wiris.common.WInteger.min(com.wiris.common.WInteger.max(pos,0),v9F-1);vAF=true;}}};return pos;},vtC:function(pos,shift){if(pos==0)return;if(!shift){var n=com.wiris.editor.formula.box.BoxUtils.vNC(this.box);var vo8=pos>=0?1:-1;var vBF=this.vV3+pos;vBF=com.wiris.common.WInteger.min(com.wiris.common.WInteger.max(vBF,0),n-1);var vAF=false;while(!this.vVC(vBF,0).vXE()){vBF+=vo8;if(vBF<0||vBF>=n){if(vAF){vBF=this.vV3;break;}else{vo8=-vo8;vBF=this.vV3+pos;vBF=com.wiris.common.WInteger.min(com.wiris.common.WInteger.max(vBF,0),n-1);vAF=true;}}};vBF=this.v8F(vBF,n,vo8,shift);this.setCaret(vBF,0);return;}else{var n=com.wiris.editor.formula.box.BoxUtils.vNC(this.box);var vo8=pos>=0?1:-1;var vBF=this.vV3+pos;var vCF=this.vV3+this.vLC;vCF=this.v8F(vCF,n,-vo8,shift);var vDF=false;var vEF=false;var s=this.vZ2();var vFF=s.vUE()-s.vVE();var vGF=-1;do{vBF=this.v8F(vBF,n,vo8,shift);if(vBF==this.vV3)break;s=this.vVC(vBF,vCF-vBF);var vHF=s.vUE()-s.vVE();if(!vDF&&vHF!=vFF){vDF=true;vGF=vHF;};if(vDF&&vHF!=vGF)vEF=true;if(vDF&&!vEF)this.setCaret(vBF,vCF-vBF);vBF+=vo8;}while(!vEF);}},v4F:function(vV3,length,mode){this.vV3=vV3;this.vLC=length;this.voC=mode;this.vkB();},setCaret:function(vV3,length){this.v4F(vV3,length,0);if(com.wiris.editor.formula.FormulaModel.vIF==com.wiris.editor.formula.FormulaModel.vJF){var vX3=this.getCaret();var vKF=com.wiris.editor.formula.box.BoxUtils.v6F(this.vY2(),vX3);var vs6=vKF.b;if(vs6.vnA()&&vKF.x>0)vs6=vKF.b.getChild(vKF.b.vLF(vKF.x,-1));if(vs6!=this.vLB){if(this.vLB!=null){var vMF=this.vLB.vNF();if(vMF!=null&&vMF.vOF){vMF.vOF=false;vMF.vPF();}};if(vs6!=null){var vQF=vs6.vNF();if(vQF!=null&&vQF.vRF&&this.mode==com.wiris.editor.formula.FormulaModel.vs2){vQF.vOF=true;vQF.vPF();}};this.vLB=vs6;}else if(this.mode==com.wiris.editor.formula.FormulaModel.vp2){var vQF=vs6.vNF();if(vQF!=null&&vQF.vOF){vQF.vOF=false;vQF.vPF();}}}},getCaretLength:function(){return this.vLC;},getCaret:function(){return this.vV3;},getBaseline:function(){this.vlC();return this.box.baseline;},getHeight:function(){this.vlC();return this.box.height;},getWidth:function(){this.vlC();return this.box.width;},vSF:function(b,vTF){var n;var i;var vUF;if(b.vVF)return;b.vVF=true;if(b.vWF||vTF){var parent=b.getParent();if(parent!=null){var vXF=b.styles.getClassType();var vYF=b.styles.isFlag(com.wiris.e1_61.vdB);var vZF=b.styles.isFlagMask(com.wiris.e1_61.vcB);b.styles=com.wiris.e1_61.join(parent.styles,b.styles);b.styles.setClassType(vXF);b.styles.vF9(com.wiris.e1_61.vdB,vYF);if(!vZF)b.styles.vaF(com.wiris.e1_61.vcB);};b.vbF();b.vD7=this.vcF(b.styles,b,b.getParent());};n=b.va7();var vd1=0;while(vd1<n){var vn8=vd1++;vUF=b.getChild(vn8);this.vSF(vUF,b.vWF||vTF);};b.vWF=false;},viA:function(b){if(b.vVF)return;while(b.getParent()!=null)b=b.getParent();this.vSF(b,false);},vdF:function(b,reset){if(this.readOnly)return;if(reset)this.vnC();else{this.vs3();this.viB(this.box);};if(!b.veF()){var vsD;vsD=new com.wiris.e1_h();vsD.v1D(0,b);this.vdF(vsD,reset);}else{b.vfF();this.box=b;};this.viA(this.box);if(!reset)this.vv3();this.vjB();this.vkB();},vmC:function(b){this.vdF(b,true);},vY2:function(){return this.box;},vcF:function(styles,b,parent){var vgF=this.vjA(b);var vhF=com.wiris.e1_61.join(vgF,styles);if(b.styles.isFlag(com.wiris.e1_61.vdB))vhF.vYB(100);if(parent!=null&&!b.styles.isFlag(com.wiris.e1_61.vdB))vhF.vYB(parent.vD7.getP()*vhF.getP()/100);return vhF;},viF:function(b,vJ9){if(!b.vkC){var n=b.va7();if(!b.vjF)this.vkF(b);var i;var vd1=0;while(vd1<n){var vn8=vd1++;this.viF(b.getChild(vn8),vJ9);};vJ9.setStyle(b.vD7);if(this.mode==com.wiris.editor.formula.FormulaModel.vs2&&com.wiris.editor.formula.FormulaModel.vIF==com.wiris.editor.formula.FormulaModel.vlF){var vmF=b.vNF();if(vmF!=null&&vmF.vRF)vmF.vOF=true;};b.vnF(vJ9,this.mode);b.vkC=true;if(!b.vjF&&this.vkF(b)){var vd1=0;while(vd1<n){var vn8=vd1++;this.viF(b.getChild(vn8),vJ9);};vJ9.setStyle(b.vD7);b.voF(vJ9);};if(b.styles.isFlag(com.wiris.e1_61.v14)){var vd1=0;while(vd1<n){var vn8=vd1++;var vpA=b.getChild(vn8);vpA.x=b.width-vpA.x-vpA.width;}}}},vkF:function(b){var vpF=false;var n=b.va7();var i;var c;var vd1=0;while(vd1<n){var vn8=vd1++;c=b.getChild(vn8);if(c.vjF){c.vkC=false;vpF=true;this.vkF(c);}};return vpF;},recalcClient:function(vY3){var vJ9=new com.wiris.e1_A(vY3);this.recalc(vJ9);},recalc:function(vY3){vY3.setStyle(this.getDefaultStyles());vY3.setFormat(this);this.vqF(this.vY2(),vY3);},paintClient:function(vY3){var vJ9=new com.wiris.e1_A(vY3);this.paint(vJ9);},paint:function(vY3){vY3.setStyle(this.getDefaultStyles());vY3.setFormat(this);this.vrF(this.vY2(),vY3);},vqF:function(b,vJ9){this.viF(b,vJ9);this.vZC();this.vlC();},vsF:function(vmF,vJ9){var vm6=vJ9.getColor();vJ9.setColor(com.wiris.editor.formula.FormulaModel.vtF);com.wiris.editor.formula.box.BoxUtils.vuF(vJ9,vmF,0,0,0,0,false,false);vJ9.setColor(vm6);},vrF:function(b,vJ9){if(b.vD7.isFlag(com.wiris.e1_61.vbB))return;var n;var i;var vUF;n=b.va7();vJ9.setStyle(b.vD7);vJ9.beginTranslate(b.x,b.vQ1,b.width,b.height);var vmF=b.vNF();if(vmF!=null&&vmF.vOF)this.vsF(vmF,vJ9);b.vvF(vJ9,this.mode);var vd1=0;while(vd1<n){var vn8=vd1++;vUF=b.getChild(vn8);this.vrF(vUF,vJ9);};vJ9.endTranslate(b.x,b.vQ1,b.width,b.height);},vTB:null,vSB:null,vUB:null,vA3:null,vWB:null,allowInnerNewLines:null,vj6:null,readOnly:null,vQB:null,reservedWordsColor:null,vPB:null,forceReservedWords:null,reservedWords:null,vPC:null,vLB:null,vWC:null,vXC:null,vdC:null,veC:null,vZB:null,vXB:null,vVB:null,styleChanged:null,clipboardChanged:null,caretPositionChanged:null,contentChanged:null,vOB:null,vqC:null,vrC:null,vEC:null,vpC:null,vgB:null,display:null,mode:null,voC:null,vLC:null,vV3:null,box:null,__class__:com.wiris.editor.formula.FormulaModel};com.wiris.e1_E=v91["com.wiris.e1_E"]=function(editorModel,formulaModel){this.editorModel=editorModel;this.formulaModel=formulaModel;};com.wiris.e1_E.__name__=["com","wiris","e1_E"];com.wiris.e1_E.__interfaces__=[com.wiris.e1_3];com.wiris.e1_E.prototype={vwF:function(parameters,vc2){if(this.vb2==parameters.get("input")){var error=this.vxF(vc2);if(error!=null){var vyF=this.vzF(this.vb2,error[0]);var v0G=this.vzF(this.vb2,error[1]);var vwA=this.v1G(vyF,this.v2G,false);var v3G=this.v1G(v0G,this.v2G,true);var v4G=this.v5G(this.s,this.formulaModel.vY2(),vwA);var v5F=this.v6G(v4G);var v7G=this.v5G(this.s,this.formulaModel.vY2(),v3G);var end=this.v8G(v7G);this.formulaModel.vSC(v5F,end);}else this.formulaModel.vRC();this.editorModel.notifyTransformation(vc2);}},urlAnswerReceived:function(url,parameters,vc2){this.vwF(parameters,vc2);},serviceAnswerReceived:function(serviceName,parameters,vc2){this.vwF(parameters,vc2);},v1G:function(n,v9G,forward){var m;while((m=v9G[n])==-1){n+=forward?1:-1;if(n>=v9G.length||n<0)return 1;};return m;},vzF:function(s,n){var c=0;var p=0;do{p=s.indexOf("<",p);if(p==-1)break;if(!(HxOverrides.substr(s,p,2)=="</"))c++;p++;}while(p<n);return c-1;},vAG:function(x,v9G){if(x.nodeType==Xml.Element){var number=x.get(com.wiris.e1_E.vBG);if(number!=null){v9G.push(Std.parseInt(number));x.remove(com.wiris.e1_E.vBG);}else v9G.push(-1);var i=x.iterator();while(i.hasNext())this.vAG(i.next(),v9G);}else if(x.nodeType==Xml.Document)this.vAG(x.firstChild(),v9G);},vCG:function(x){var v9G=new Array();this.vAG(x,v9G);return v9G;},vDG:function(x,n){if(x.nodeType==Xml.Element){x.set(com.wiris.e1_E.vBG,""+n++);var i=x.iterator();while(i.hasNext())n=this.vDG(i.next(),n);}else if(x.nodeType==Xml.Document)return this.vDG(x.firstChild(),n);return n;},vEG:function(x){this.vDG(x,0);},vFG:function(t,l,c){var n=-1;var i;var ve1=0,vd1=l-1;while(ve1<vd1){var vn8=ve1++;n=t.indexOf("\n",n+1);};n+=c;return n;},vxF:function(t){var e=new EReg("Syntax error from line ([0-9]+) column ([0-9]+) to line ([0-9]+) column ([0-9]+).","");if(e.match(t)){var vGG=Std.parseInt(e.matched(1));var vHG=Std.parseInt(e.matched(2));var vIG=Std.parseInt(e.matched(3));var vJG=Std.parseInt(e.matched(4));var vKG=this.vFG(t,vGG,vHG);var vLG=this.vFG(t,vIG,vJG);return[vKG,vLG];}else return null;},v5G:function(s,top,n){s.setMode(com.wiris.e1_H.vMG);s.vNG(n);top.vJB(s);return s.v5G();},v8G:function(b){var p=b.parent;var n;if(p==null)n=com.wiris.editor.formula.box.BoxUtils.vNC(b)-1;else if(b.v07+1==p.va7())n=com.wiris.editor.formula.box.BoxUtils.vOG(p)+com.wiris.editor.formula.box.BoxUtils.vNC(p)-1;else n=com.wiris.editor.formula.box.BoxUtils.vOG(p.getChild(b.v07+1));return n;},v6G:function(b){var n=com.wiris.editor.formula.box.BoxUtils.vOG(b)-1;if(n==-1)return 0;return n;},getTransformation:function(url,grammar){this.formulaModel.vRC();this.s=new com.wiris.e1_H(this.formulaModel);this.s.vME(this.formulaModel);this.s.setMode(com.wiris.e1_H.vPE);var xml=this.s.vRE(this.formulaModel.vY2());this.vEG(xml);var vPG=new com.wiris.e1_I();vPG.formulaToStandard(xml,this.formulaModel.vOC()==com.wiris.editor.formula.FormulaModel.vu2);this.v2G=this.vCG(xml);this.vb2=com.wiris.util.xml.WXmlUtils.vb3(xml);var parameters=new HaxeHash();parameters.set("input",this.vb2);if(grammar!=null)parameters.set("grammar",grammar);if(url==null)com.wiris.system.ServiceProvider.vU3("mathml2content",parameters,this);else com.wiris.system.ServiceProvider.vQG(url,parameters,this);},s:null,v2G:null,vb2:null,formulaModel:null,editorModel:null,__class__:com.wiris.e1_E};com.wiris.editor.formula.IntegerTools=v91["com.wiris.editor.formula.IntegerTools"]=function(){};com.wiris.editor.formula.IntegerTools.__name__=["com","wiris","editor","formula","IntegerTools"];com.wiris.editor.formula.IntegerTools.max=function(x,vQ1){if(x>vQ1)return x;return vQ1;};com.wiris.editor.formula.IntegerTools.min=function(x,vQ1){if(x<vQ1)return x;return vQ1;};com.wiris.e1_F=v91["com.wiris.e1_F"]=function(copy){if(copy==null){this.form=0;this.accent=false;this.vRG=false;this.largeop=false;this.vSG=0;this.vTG=false;this.vUG=false;this.stretchy=false;this.vVG=true;this.lspace=com.wiris.e1_F.vWG;this.rspace=com.wiris.e1_F.vWG;}else{this.form=copy.form;this.accent=copy.accent;this.vRG=copy.vRG;this.largeop=copy.largeop;this.vSG=copy.vSG;this.vTG=copy.vTG;this.vUG=copy.vUG;this.stretchy=copy.stretchy;this.vVG=copy.vVG;this.lspace=copy.lspace;this.rspace=copy.rspace;}};com.wiris.e1_F.__name__=["com","wiris","e1_F"];com.wiris.e1_F.prototype={vXG:function(v){this.accent=v=="true";},vYG:function(){if(this.accent)return"true";else return"false";},vZG:function(v){this.largeop=v=="true";},vaG:function(){if(this.largeop)return"true";else return"false";},vbG:function(v){this.stretchy=v=="true";},vcG:function(){if(this.stretchy)return"true";else return"false";},merge:function(vdG,veG){if(vdG.form!=veG.form)this.form=veG.form;if(vdG.accent!=veG.accent)this.accent=veG.accent;if(vdG.vRG!=veG.vRG)this.vRG=veG.vRG;if(vdG.largeop!=veG.largeop)this.largeop=veG.largeop;if(vdG.vSG!=veG.vSG)this.vSG=veG.vSG;if(vdG.vTG!=veG.vTG)this.vTG=veG.vTG;if(vdG.vUG!=veG.vUG)this.vUG=veG.vUG;if(vdG.stretchy!=veG.stretchy)this.stretchy=veG.stretchy;if(vdG.vVG!=veG.vVG)this.vVG=veG.vVG;if(vdG.lspace!=veG.lspace)this.lspace=veG.lspace;if(vdG.rspace!=veG.rspace)this.rspace=veG.rspace;},vfG:function(rspace){this.rspace=this.vgG(rspace);},vhG:function(lspace){this.lspace=this.vgG(lspace);},vgG:function(viG){if(viG==com.wiris.e1_F.vjG)return com.wiris.e1_F.vkG;if(viG==com.wiris.e1_F.vlG)return com.wiris.e1_F.vmG;if(viG==com.wiris.e1_F.vnG)return com.wiris.e1_F.voG;if(viG==com.wiris.e1_F.vpG)return com.wiris.e1_F.vqG;if(viG==com.wiris.e1_F.vrG)return com.wiris.e1_F.vWG;if(viG==com.wiris.e1_F.vsG)return com.wiris.e1_F.vtG;if(viG==com.wiris.e1_F.vuG)return com.wiris.e1_F.vvG;return 0;},vwG:function(viG){switch(viG){case com.wiris.e1_F.vkG:return com.wiris.e1_F.vjG;case com.wiris.e1_F.vmG:return com.wiris.e1_F.vlG;case com.wiris.e1_F.voG:return com.wiris.e1_F.vnG;case com.wiris.e1_F.vqG:return com.wiris.e1_F.vpG;case com.wiris.e1_F.vWG:return com.wiris.e1_F.vrG;case com.wiris.e1_F.vtG:return com.wiris.e1_F.vsG;case com.wiris.e1_F.vvG:return com.wiris.e1_F.vuG;default:return"0";}},vxG:function(){return this.vwG(this.rspace);},vyG:function(){return this.vwG(this.lspace);},rspace:null,lspace:null,vVG:null,stretchy:null,vUG:null,vTG:null,vSG:null,largeop:null,vRG:null,accent:null,form:null,__class__:com.wiris.e1_F};com.wiris.e1_G=v91["com.wiris.e1_G"]=function(vzG){if(vzG!=null)this.vUB=vzG.vgA();else this.vUB=false;};com.wiris.e1_G.__name__=["com","wiris","e1_G"];com.wiris.e1_G.v99=null;com.wiris.e1_G.v0H=null;com.wiris.e1_G.v1H=function(v2H,v3H,form){com.wiris.e1_G.v4H();var v5H=[[0,2,1],[1,2,0],[2,0,1]];var i;var vd1=0;while(vd1<3){var vn8=vd1++;var vJ1=v2H+"@"+v5H[form][vn8];var v6H=com.wiris.e1_G.v99.get(vJ1);if(v6H!=null){if(v3H){var v7H=com.wiris.e1_G.v0H.get(vJ1);if(v7H!=null&&v7H.stretchy!=v6H.stretchy){var v8H=new com.wiris.e1_F(v6H);v8H.stretchy=v7H.stretchy;return v8H;}};return v6H;}};return new com.wiris.e1_F(null);};com.wiris.e1_G.v4H=function(){if(com.wiris.e1_G.v99==null){com.wiris.e1_G.v99=new HaxeHash();com.wiris.e1_G.v9H(com.wiris.e1_G.v99,com.wiris.e1_G.vAH+com.wiris.e1_G.vBH);com.wiris.e1_G.v0H=new HaxeHash();com.wiris.e1_G.v9H(com.wiris.e1_G.v0H,com.wiris.e1_G.vAH);}};com.wiris.e1_G.v9H=function(vCH,e){var start=0;var v78;while((v78=e.indexOf("@",start))!=-1){var v6H=HxOverrides.substr(e,start,v78-start);v78++;start=e.indexOf("@",v78);if(start==-1)break;var value=HxOverrides.substr(e,v78,start-v78);start++;v6H=com.wiris.util.xml.WXmlUtils.htmlUnescape(v6H);var attributes=com.wiris.e1_G.vDH(value);var vEH=v6H+"@"+attributes.form;vCH.set(vEH,attributes);}};com.wiris.e1_G.vFH=function(v2H,form){return com.wiris.e1_G.v1H(v2H,true,form).stretchy;};com.wiris.e1_G.vKE=function(v2H){if(com.wiris.e1_G.vFH(v2H,0))return!com.wiris.e1_G.v1H(v2H,false,0).stretchy;return false;};com.wiris.e1_G.vDH=function(value){var v6H=new com.wiris.e1_F(null);v6H.form=Std.parseInt(HxOverrides.substr(value,0,1));v6H.lspace=Std.parseInt(HxOverrides.substr(value,1,1));v6H.rspace=Std.parseInt(HxOverrides.substr(value,2,1));var n=Std.parseInt("0x"+HxOverrides.substr(value,3,null));v6H.accent=(n&com.wiris.e1_G.vGH)!=0;v6H.vRG=(n&com.wiris.e1_G.vHH)!=0;v6H.largeop=(n&com.wiris.e1_G.vIH)!=0;v6H.vSG=(n&com.wiris.e1_G.vJH)!=0?com.wiris.e1_F.vKH:com.wiris.e1_F.vLH;v6H.vTG=(n&com.wiris.e1_G.vMH)!=0;v6H.vUG=(n&com.wiris.e1_G.vNH)!=0;v6H.stretchy=(n&com.wiris.e1_G.vOH)!=0;v6H.vVG=(n&com.wiris.e1_G.vPH)!=0;return v6H;};com.wiris.e1_G.prototype={getAttributes:function(v2H,form){return com.wiris.e1_G.v1H(v2H,this.vUB,form);},vUB:null,__class__:com.wiris.e1_G};com.wiris.e1_H=v91["com.wiris.e1_H"]=function(vXB){this.vQH=new Array();this.vRH=new Array();this.styles=new Array();this.currentStyle=new com.wiris.e1_61();this.mode=com.wiris.e1_H.vIB;this.veF=true;this.vXB=vXB;};com.wiris.e1_H.__name__=["com","wiris","e1_H"];com.wiris.e1_H.split=function(s){if(s==null)return
